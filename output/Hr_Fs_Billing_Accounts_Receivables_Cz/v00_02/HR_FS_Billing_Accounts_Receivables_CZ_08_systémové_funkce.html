<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syst√©mov√© funkce - Hr Fs Billing Accounts Receivables Cz</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        :root {
            --pico-font-size: 16px;
            --pico-line-height: 1.5;
        }

        /* Layout Structure */
        body {
            margin: 0;
            padding: 0;
            padding-top: 60px; /* Space for floating header */
        }

        /* Floating Top Bar */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--pico-background-color);
            border-bottom: 1px solid var(--pico-muted-border-color);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 1rem;
            gap: 1rem;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .top-bar.hidden {
            transform: translateY(-100%);
        }

        .top-bar .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .top-bar .nav-buttons button {
            margin: 0;
            padding: 0.5rem 1rem;
        }

        .top-bar .title {
            flex: 1;
            font-weight: 600;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .top-bar .controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .top-bar .controls label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0;
            white-space: nowrap;
        }

        .top-bar .controls select,
        .top-bar .controls input[type="checkbox"] {
            margin: 0;
        }

        /* Main Layout */
        .layout {
            display: flex;
            min-height: calc(100vh - 60px);
        }

        /* Left Sidebar - Modern 2025 Design */
        .sidebar {
            width: 280px;
            background: var(--pico-background-color);
            border-right: 1px solid var(--pico-muted-border-color);
            height: calc(100vh - 60px);
            position: sticky;
            top: 60px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Search Section */
        .sidebar-search {
            padding: 1rem;
            border-bottom: 1px solid var(--pico-muted-border-color);
            background: var(--pico-card-background-color);
        }

        .sidebar-search input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            background: var(--pico-background-color);
            color: var(--pico-color);
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .sidebar-search input:focus {
            outline: none;
            border-color: var(--pico-primary);
            box-shadow: 0 0 0 2px var(--pico-primary-background);
        }

        .sidebar-search input::placeholder {
            color: var(--pico-muted-color);
        }

        /* Navigation Header */
        .sidebar-header {
            padding: 1rem 1rem 0.5rem;
            background: var(--pico-card-background-color);
        }

        .sidebar-header h4 {
            margin: 0;
            color: var(--pico-color);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Scrollable Navigation Area */
        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem 1rem 1rem;
            background: var(--pico-card-background-color);
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar nav li {
            margin: 0;
        }

        /* Modern Tree Navigation Item */
        .nav-item {
            margin: 2px 0;
            border-radius: var(--pico-border-radius);
            overflow: hidden;
        }

        .nav-item-header {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 0;
            margin: 0;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: var(--pico-border-radius);
            transition: all 0.2s ease;
        }

        .nav-item-header:hover {
            background: var(--pico-secondary-background);
        }

        .nav-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            margin-right: 0.5rem;
            color: var(--pico-muted-color);
            font-size: 12px;
            border-radius: 3px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .nav-toggle:hover {
            background: var(--pico-muted-border-color);
            color: var(--pico-color);
        }

        .nav-toggle.expanded {
            transform: rotate(90deg);
        }

        .nav-link {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem 0.5rem 0;
            text-decoration: none;
            color: var(--pico-color);
            font-size: 0.875rem;
            line-height: 1.4;
            border-radius: var(--pico-border-radius);
            transition: all 0.2s ease;
            min-height: 32px;
        }

        .nav-link:hover {
            color: var(--pico-primary);
            text-decoration: none;
        }

        .nav-link.active {
            color: var(--pico-primary);
            font-weight: 500;
            background: var(--pico-primary-background);
        }

        /* Hierarchy Levels */
        .nav-link.h1 {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .nav-link.h2 {
            font-size: 0.85rem;
            margin-left: 1.5rem;
            color: var(--pico-muted-color);
        }

        .nav-link.h3 {
            font-size: 0.8rem;
            margin-left: 2.5rem;
            color: var(--pico-muted-color);
        }

        /* Children Container */
        .nav-children {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin-left: 24px;
        }

        .nav-children.expanded {
            max-height: 1000px;
        }

        /* No Results State */
        .nav-no-results {
            padding: 1rem;
            text-align: center;
            color: var(--pico-muted-color);
            font-size: 0.875rem;
            font-style: italic;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: none;
            transition: max-width 0.3s ease;
        }

        .main-content.narrow { max-width: 800px; margin: 0 auto; }
        .main-content.wide { max-width: 1400px; margin: 0 auto; }
        .main-content.standard { max-width: 1200px; margin: 0 auto; }

        /* Right Sidebar - Modern Minimap */
        .minimap {
            width: 80px;
            background: var(--pico-card-background-color);
            border-left: 1px solid var(--pico-muted-border-color);
            height: calc(100vh - 60px);
            position: sticky;
            top: 60px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .minimap-header {
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid var(--pico-muted-border-color);
            background: var(--pico-background-color);
        }

        .minimap h4 {
            font-size: 0.7rem;
            margin: 0;
            text-align: center;
            color: var(--pico-muted-color);
            font-weight: 500;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .minimap-content {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: var(--pico-background-color);
        }

        .minimap-viewport {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 123, 255, 0.1);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 2px;
            min-height: 20px;
            transition: all 0.1s ease;
        }

        [data-theme="dark"] .minimap-viewport {
            background: rgba(100, 200, 255, 0.15);
            border-color: rgba(100, 200, 255, 0.4);
        }

        /* Change Indicator Bar - Integrated with Minimap */
        .change-indicator {
            position: absolute;
            top: 0;
            left: 4px;
            right: 4px;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
        }

        .change-mark {
            position: absolute;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 1.5px;
            cursor: pointer;
            transition: all 0.2s ease;
            pointer-events: all;
        }

        .change-mark.added {
            background: #22c55e;
            box-shadow: 0 0 4px rgba(34, 197, 94, 0.4);
        }

        .change-mark.modified {
            background: #f59e0b;
            box-shadow: 0 0 4px rgba(245, 158, 11, 0.4);
        }

        .change-mark.removed {
            background: #ef4444;
            box-shadow: 0 0 4px rgba(239, 68, 68, 0.4);
        }

        .change-mark:hover {
            height: 5px;
            box-shadow: 0 0 8px currentColor;
        }

        /* Modern Line-by-Line Diff Highlighting */
        .diff-line-added {
            background: rgba(34, 197, 94, 0.15) !important;
            border-left: 3px solid #22c55e;
            padding-left: 1rem !important;
            margin: 2px 0;
        }

        .diff-line-removed {
            background: rgba(239, 68, 68, 0.15) !important;
            border-left: 3px solid #ef4444;
            padding-left: 1rem !important;
            margin: 2px 0;
            text-decoration: line-through;
            opacity: 0.8;
        }

        .diff-line-modified {
            background: rgba(245, 158, 11, 0.15) !important;
            border-left: 3px solid #f59e0b;
            padding-left: 1rem !important;
            margin: 2px 0;
        }

        /* Dark theme adjustments */
        [data-theme="dark"] .diff-line-added {
            background: rgba(34, 197, 94, 0.2) !important;
        }

        [data-theme="dark"] .diff-line-removed {
            background: rgba(239, 68, 68, 0.2) !important;
        }

        [data-theme="dark"] .diff-line-modified {
            background: rgba(245, 158, 11, 0.2) !important;
        }

        /* Enhanced Table Styling */
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 2rem 0;
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            overflow: hidden;
            box-shadow: var(--pico-card-box-shadow);
        }

        table th, table td { 
            border: 1px solid var(--pico-muted-border-color);
            padding: 0.75rem;
            text-align: left;
            vertical-align: top;
        }

        table td {
            background-color: var(--pico-card-background-color);
        }

        table th { 
            background: var(--pico-contrast);
            color: var(--pico-contrast-inverse);
            font-weight: 600;
            border-bottom: 2px solid var(--pico-muted-border-color);
            position: relative;
        }

        /* High contrast table headers for both themes */
        [data-theme="dark"] table th {
            background: #2a2a2a;
            color: #ffffff;
            border-color: #404040;
        }

        [data-theme="light"] table th {
            background: #f8f9fa;
            color: #212529;
            border-color: #dee2e6;
        }

        table caption { 
            caption-side: top; 
            padding: 1rem; 
            font-weight: 600; 
            text-align: left;
            color: var(--pico-muted-color);
        }

        /* Diff Styling - Light and Dark Mode Aware */
        .diff-added { 
            background: var(--pico-ins-color) !important; 
            color: var(--pico-contrast-color); 
            border: 2px solid #28a745 !important;
        }

        .diff-removed { 
            background: var(--pico-del-color) !important; 
            color: var(--pico-contrast-color); 
            text-decoration: line-through; 
            border: 2px solid #dc3545 !important;
        }

        .diff-modified {
            background: var(--pico-mark-background-color) !important;
            color: var(--pico-mark-color) !important;
            border: 2px solid #ffc107 !important;
        }

        /* Custom theme-aware variables */
        :root {
            --diff-added-bg: #d4f6d4;
            --diff-added-color: #0d5016;
            --diff-removed-bg: #f8d7da;
            --diff-removed-color: #721c24;
            --diff-modified-bg: #fff3cd;
            --diff-modified-color: #856404;
        }

        [data-theme="dark"] {
            --diff-added-bg: #1a3d1a;
            --diff-added-color: #90ee90;
            --diff-removed-bg: #3d1a1a;
            --diff-removed-color: #ffb3b3;
            --diff-modified-bg: #3d3d1a;
            --diff-modified-color: #ffeb99;
        }

        .diff-added { 
            background: var(--diff-added-bg) !important; 
            color: var(--diff-added-color) !important; 
            border: 2px solid #28a745 !important;
        }

        .diff-removed { 
            background: var(--diff-removed-bg) !important; 
            color: var(--diff-removed-color) !important; 
            text-decoration: line-through; 
            border: 2px solid #dc3545 !important;
        }

        .diff-modified {
            background: var(--diff-modified-bg) !important;
            color: var(--diff-modified-color) !important;
            border: 2px solid #ffc107 !important;
        }

        /* Improved dark mode colors */
        [data-theme="dark"] {
            --pico-muted-color: #b3b3b3;
            --pico-color: #e0e0e0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .top-bar .title {
                font-size: 0.9rem;
            }
            
            .top-bar .controls {
                gap: 0.5rem;
            }
            
            .top-bar .controls label {
                font-size: 0.8rem;
            }
            
            .change-indicator {
                right: 10px;
                width: 8px;
            }
        }

        /* Dark mode enhancements */
        @media (prefers-color-scheme: dark) {
            .change-indicator {
                background: rgba(255,255,255,0.1);
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/diff@5.1.0/dist/diff.min.js"></script>
</head>
<body>
    <!-- Floating Top Bar -->
    <header class="top-bar" id="topBar">
        <div class="nav-buttons">
            <button onclick="goBack()">‚Üê Back</button>
            <button onclick="goToIndex()">üìã Index</button>
        </div>
        
        <h1 class="title">Hr Fs Billing Accounts Receivables Cz - Syst√©mov√© funkce</h1>
        
        <div class="controls">
            <label>
                <input type="checkbox" id="showChanges" onchange="toggleDiff()" role="switch">
                Show changes
            </label>
            
            <label>
                Version:
                <select id="versionSelect" onchange="loadVersionForComparison()">
                    <option value="v00_03_2025_08_26" >v00_03_2025_08_26</option>

                </select>
            </label>
            
            <label>
                Width:
                <select id="widthSelect" onchange="changeWidth()">
                    <option value="standard">Standard</option>
                    <option value="narrow">Narrow</option>
                    <option value="wide">Wide</option>
                    <option value="full">Full</option>
                </select>
            </label>
            
            <button id="themeToggle" onclick="toggleTheme()" title="Toggle theme" style="background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 0.5rem;">
                üåô
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="layout">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <!-- Search Section -->
            <div class="sidebar-search">
                <input type="text" id="navSearch" placeholder="Search headings..." autocomplete="off">
            </div>
            
            <!-- Navigation Header -->
            <div class="sidebar-header">
                <h4>Contents</h4>
            </div>
            
            <!-- Scrollable Navigation Area -->
            <div class="sidebar-nav">
                <nav>
                    <ul id="sectionNav">
                        <!-- Will be populated by JavaScript -->
                    </ul>
                    <div id="navNoResults" class="nav-no-results" style="display: none;">
                        No matching headings found
                    </div>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content standard" id="mainContent">
            <h1 id="syst√©mov√©-funkce">Syst√©mov√© funkce</h1>


<p> Sloupec <strong>Realizace</strong> urƒçuje zp≈Øsob implementace
p≈ô√≠slu≈°n√©ho UC:</p>


<ul>
<li><p>New ‚Äì nov√Ω UC jen pro dan√Ω projekt</p></li>
<li><p>Upd ‚Äì UC upraven√Ω (customizovan√Ω) pro dan√Ω projekt</p></li>
<li><p>AsIs ‚Äì UC beze zmƒõny</p></li>
<li><p>N/A ‚Äì nebude pou≈æ√≠v√°n</p></li>
</ul>


<table>
<caption><p>Tabulka : Seznam syst√©mov√Ωch funkc√≠</p></caption>
<colgroup>
<col style="width: 23%"/>
<col style="width: 52%"/>
<col style="width: 9%"/>
<col style="width: 13%"/>
</colgroup>
<thead>
<tr>
<th><strong>Funkƒçn√≠ oblast</strong></th>
<th><strong>P≈ô√≠pad u≈æit√≠</strong></th>
<th><strong>Realizace</strong></th>
<th><strong>Akt√©r</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="22">Fakturace</td>
<td>Vytvo≈ô pravideln√© faktury za m√Ωtn√© (SYS.BAR.0.1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô pravideln√© faktury za m√Ωtn√© (SYS.BAR.0.1.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô pravideln√© faktury za m√Ωtn√© (SYS.BAR.0.1.VO2)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô pravideln√© faktury za m√Ωtn√© (SYS.BAR.0.1.HR)</td>
<td><em>Upd</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô pravideln√© faktury za slu≈æby (SYS.BAR.0.2)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô pravideln√© v√Ωzvy na √∫hradu za platby tankovac√≠ kartou
(SYS.BAR.0.3)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô jednor√°zovou fakturu za slu≈æby (SYS.BAR.0.4.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô jednor√°zovou fakturu za slu≈æby (SYS.BAR.0.4.HR)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Na√∫ƒçtuj transakƒçn√≠ poplatek za m√Ωtn√© (SYS.BAR.0.5)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô fakturaƒçn√≠ d√°vku (SYS.BAR.0.6)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô fakturaƒçn√≠ d√°vku (SYS.BAR.0.6.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô fakturaƒçn√≠ d√°vku (SYS.BAR.0.6.VO2)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô fakturaƒçn√≠ d√°vku (SYS.BAR.0.6.HR)</td>
<td><em>Upd</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Na√∫ƒçtuj jednor√°zov√Ω poplatek (SYS.BAR.0.7)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô jednor√°zov√Ω dobropis za slu≈æby (SYS.BAR.0.8)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô jednor√°zov√Ω dobropis za slu≈æby (SYS.BAR.0.8.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Zagreguj platby tankovac√≠ kartou do FCI RfP (SYS.BAR.0.9).</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Importuj EETS EMS faktury (SYS.BAR.0.10.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Importuj jednor√°zovou ENF fakturu (SYS.BAR.0.11.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Zagreguj ocenƒõn√© ud√°losti do fakturaƒçn√≠ d√°vky (SYS.BAR.0.12.HR)</td>
<td><em>New</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô v√Ωzvy na √∫hradu za p≈ôestupky (SYS.BAR.0.13.HR)</td>
<td><em>New</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô jednor√°zovou fakturu za m√Ωto (SYS.BAR.0.14.HR)</td>
<td><em>New</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td rowspan="13">Zpracov√°n√≠ m√Ωtn√Ωch transakc√≠</td>
<td>Zpracuj billing details (SYS.BAR.1.1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Zpracuj billing details (SYS.BAR.1.1.VO2)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô souhrn ocenƒõn√Ωch ud√°lost√≠ pro VTK (SYS.BAR.1.2)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô souhrn fakturaƒçn√≠ch detail≈Ø pro PL (SYS.BAR.1.3)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô platebn√≠ ozn√°men√≠ pro PL (SYS.BAR.1.4)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Zpracuj n√°rok na platbu pro BG (SYS.BAR.1.5)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô souhrn m√Ωtn√Ωch transakc√≠ pro VTK (TT) (SYS.BAR.1.6)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Zpracuj ocenƒõnou ud√°lost zpoplatnƒõn√≠ (SYS.BAR.1.7.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Ulo≈æ ocenƒõnou m√Ωtnou transakci (SYS.BAR.1.8.HR)</td>
<td><em>New</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô billing details (SYS.BAR.1.9.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô billing details (SYS.BAR.1.9.HR)</td>
<td><em>Upd</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Zapla≈• m√Ωtnou transakci tokenem (SYS.BAR.1.10.HR)</td>
<td><em>New</em></td>
<td><em>Syst√©m</em></td>
</tr>
<tr>
<td>Vytvo≈ô P≈ôestupek (SYS.BAR.1.11.HR)</td>
<td><em>New</em></td>
<td><em>Syst√©m</em></td>
</tr>
<tr>
<td rowspan="16">Operace s¬†platbami</td>
<td>Vytvo≈ô platbu bankovn√≠m p≈ôevodem (SYS.BAR.2.1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Proveƒè p√°rov√°n√≠ (SYS.BAR.2.2)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Z√∫ƒçtuj z√°vazky a pohled√°vky (SYS.BAR.2.3)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Z√∫ƒçtuj z√°vazky a pohled√°vky (SYS.BAR.2.3.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td><mark>Vra≈• depozit na tankovac√≠ kartu (SYS.BAR.2.4)</mark></td>
<td><em>N/A</em></td>
<td><mark>Syst√©m</mark></td>
</tr>
<tr>
<td><mark>Vytvo≈ô souhrn debetn√≠ch plateb pro VTK
(SYS.BAR.2.5)</mark></td>
<td><em>N/A</em></td>
<td><mark>Syst√©m</mark></td>
</tr>
<tr>
<td>Rezervuj depozit z p≈ôedplacen√©ho kreditu (SYS.BAR.2.6)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Zru≈° rezervaci depozitu z p≈ôedplacen√©ho kreditu (SYS.BAR.2.7)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Z√∫ƒçtuj z√°vazky a pohled√°vky pro EETS Provider (SYS.BAR.2.8.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Zpracuj bankovn√≠ v√Ωpis (SYS.BAR.2.9.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Rozpoznej polo≈æky bankovn√≠ho v√Ωpisu (SYS.BAR.2.10.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vra≈• platbu (SYS.BAR.2.11.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td><mark>Vra≈• automaticky platbu (SYS.BAR.2.12.VO1)</mark></td>
<td><em><mark>N/A</mark></em></td>
<td><mark>Syst√©m</mark></td>
</tr>
<tr>
<td>Vytvo≈ô polo≈æku platebn√≠ho p≈ô√≠kazu (SYS.BAR.2.13.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Aplikuj centov√© vyrovn√°n√≠ (SYS.BAR.2.14.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Zapla≈• ud√°lost online p≈ôes platebn√≠ br√°nu (SYS.BAR.2.15.HR)</td>
<td><em>New</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td rowspan="4">Pomocn√© operace</td>
<td>St√°hni kurzovn√≠ l√≠stek Erste Bank (SYS.BAR.3.0)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>St√°hni kurzovn√≠ l√≠stek Tatrabanky (SYS.BAR.3.1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Spoƒç√≠tej minim√°ln√≠ ƒç√°stku top-up (SYS.BAR.3.2)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td>Vytvo≈ô finanƒçn√≠ transakci (SYS.BAR.3.3.VO1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Spr√°va slev</td>
<td>Importuj n√°rok na slevu v dom√©nƒõ CZ (SYS.BAR.4.1)</td>
<td><em>N/A</em></td>
<td>Syst√©m</td>
</tr>
</tbody>
</table>


<h2 id="fakturace">Fakturace</h2>


<h3 id="vytvo≈ô-pravideln√©-faktury-za-m√Ωtn√©-sys.bar.0.1.hr">Vytvo≈ô
pravideln√© faktury za m√Ωtn√© (SYS.BAR.0.1.HR)</h3>


<h4 id="c√≠l-2">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je vygenerov√°n√≠ pravideln√Ωch faktur za
m√Ωtn√©.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-2">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>P≈ô√≠pad je spu≈°tƒõn syst√©movou √∫lohou BE_CloseBillSessionsBySystem</p>


<h4 id="popis">Popis</h4>


<p>Norm√°ln√≠ typ fakturaƒçn√≠ d√°vky¬†obsahuj√≠c√≠ m√Ωto</p>


<p>Syst√©m dohled√° v≈°echny Bill session s:</p>


<ul>
<li><p>Bill session status = Open,</p></li>
<li><p>Bill session end date &lt; aktu√°ln√≠ datum,</p></li>
<li><p>Bill session aggregation type = <mark>Pre-paid</mark>, Post-paid
card, <mark>Post-paid invoice,</mark> Exemption partner, <mark>Fleet
card issuer</mark> a EETS Provider,</p></li>
<li><p>Bill session content type = Toll,</p></li>
<li><p>Bill session type = Normal</p></li>
</ul>


<p>a pro ka≈ædou Bill session vykon√° nasleduj√≠c√≠ postup:</p>


<p>Syst√©m zmƒõn√≠ <strong>Bill session status na Closing</strong> a
postupnƒõ prov√°d√≠ n√°sleduj√≠c√≠ fakturaƒçn√≠ kroky:</p>


<ul>
<li><p>Syst√©m vytvo≈ô√≠ da≈àov√Ω bill item pro ka≈ædou sazbu danƒõ vyskytuj√≠c√≠
se v¬†bill items pat≈ô√≠c√≠ do dan√© bill session a k¬†dan√©mu bill:</p>
<ul>
<li><p>Bill item category = Tax</p></li>
<li><p>Bill item type =</p>
<ul>
<li><p>Corrective bill item credit, pokud souƒçet bill item s danou
sazbou danƒõ byl &lt; 0,</p></li>
<li><p>jinak Regular bill item</p></li>
</ul></li>
<li><p>Price amount = celkov√° da≈à za bill itemy s danou tax rate (Tax
base * Tax rate a n√°sledn√© zaokrouhlen√≠ podle BillRounding pro danou
mƒõnu)</p></li>
<li><p>Unit price = null</p></li>
<li><p>Number of units = null</p></li>
<li><p>Metric unit = null</p></li>
<li><p>Tax rate = tax rate pro kterou se bill item vytv√°≈ô√≠</p></li>
<li><p>Tax base = celkov√° ƒç√°stka bez danƒõ s danou tax rate (suma Price
amount p≈ô√≠slu≈°n√Ωch neda≈àov√Ωch bill items s ohledem na jejich Bill item
type a n√°sledn√© zaokrouhlen√≠ podle BillRounding)</p></li>
</ul></li>
<li></li>
<li><p>Syst√©m zaokrouhl√≠ bill item.price amount podle
BillRounding.</p></li>
<li><p>Syst√©m pro ka≈ædou da≈àovou bill item zjist√≠, zda nen√≠ pot≈ôeba
vytvo≈ôit bill item pro Rounding adjustment:</p>
<ul>
<li><p>pokud rozd√≠l mezi (Tax base da≈àov√© bill itemy) a (absolutn√≠
hodnoty souƒçtu Price amount neda≈àov√Ωch bill item se shodnou tax rate a s
ohledem na jejich Bill item type) = 0, rounding adjustment nen√≠ pot≈ôeba
pro danou da≈àovou bill item.</p></li>
<li><p>jinak Syst√©m vytvo≈ô√≠ korekƒçn√≠ bill item s parametry:</p>
<ul>
<li><p>Bill item category = Rounding adjustment</p></li>
<li><p>Product type = null</p></li>
<li><p>Bill item type =</p></li>
</ul>
<ul>
<li><p>Pokud souƒçet Tax base v≈°ech da≈àov√Ωch Bill item a Price amount
v≈°ech da≈àov√Ωch Bill items &gt;= 0,</p>
<ul>
<li><p>a pokud vypoƒçten√Ω rozd√≠l je men≈°√≠ ne≈æ nula, pak Corrective bill
item ‚Äì credit,</p></li>
<li><p>jinak Corrective bill item ‚Äì debit</p></li>
</ul></li>
<li><p>Pokud souƒçet Tax base v≈°ech da≈àov√Ωch Bill item a Price amount
v≈°ech da≈àov√Ωch Bill items &lt; 0,</p>
<ul>
<li><p>A pokud vypoƒçten√Ω rozd√≠l je vƒõt≈°√≠ ne≈æ nula, pak Corrective bill
item ‚Äì credit,</p></li>
<li><p>jinak Corrective bill item ‚Äì debit</p>
<ul>
<li><p>Unit price = Price amount</p></li>
<li><p>Unit price definition method = None</p></li>
<li><p>Number of units = 1</p></li>
<li><p>Metric unit = Piece</p></li>
<li><p>Tax rate = null</p></li>
<li><p>Price amount = absolutn√≠ hodnota vypoƒçten√©ho rozd√≠lu</p></li>
<li><p>Price amount VAT = Price amount</p></li>
<li><p>Billing service = Syst√©m zjist√≠ billing service z PCRE na z√°kladƒõ
Billing service.abbreviation = ADJ-ROUNDING</p></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>Syst√©m vypoƒç√≠t√° z√°klad danƒõ faktury (Bill amount) tak, ≈æe seƒçte
Tax base v≈°ech da≈àov√Ωch Bill item.</p></li>
<li><p>Syst√©m vypoƒç√≠t√° da≈à faktury (Tax amount) tak, ≈æe seƒçte Price
amount v≈°ech da≈àov√Ωch Bill items.</p></li>
<li><p>Syst√©m vypoƒç√≠t√° celkovou ƒç√°stku faktury (Total amount) tak, ≈æe
seƒçte Bill amount a Tax amount.</p></li>
<li><p>Pokud vypoƒçten√° hodnota Total amount je &lt; 0, Syst√©m nastav√≠
bill.Bill issue type = Corrective bill ‚Äì credit, jinak na bill.Bill
issue type = Regular bill.</p></li>
<li><p>Pokud vypoƒçten√° hodnota Total amount je = 0, Syst√©m nastav√≠
bill.Bill payment status = Payment not needed.</p></li>
<li><p>Do bill.Total amount, bill.Bill amount a bill.Tax amount se ulo≈æ√≠
absolutn√≠ hodnota vypoƒçten√Ωch ƒç√°stek.</p></li>
<li><p>Syst√©m updatuje dal≈°√≠ bill atributy:</p>
<ul>
<li><p>Bill number = pou≈æij√≠ se pravidla ƒå√≠slov√°n√≠ faktur na z√°kladƒõ
Bill issue type</p></li>
<li><p>Fiscal verification number = vygeneruje se Fisk√°ln√≠ verifikaƒçn√≠
ƒç√≠slo ze sekvence pro ƒç√≠slov√°n√≠ faktur (BNF77) s Business Premises BO,
urƒçen√Ωm podle user profile</p></li>
<li><p>ZKI = vypln√≠ se Ochrann√Ω k√≥d vystavitele faktury (Issuer's
Protection Code)</p></li>
<li><p>Bill type =</p>
<ul>
<li><p>Customer bill pokud Bill session aggregation type =
<mark>Pre-paid,</mark> Post-paid card, <mark>Postpaid
invoice</mark>,</p></li>
<li><p>EETS Provider bill, pokud Bill session aggregation type = EETS
Provider</p></li>
<li><p>Exemption partner bill, pokud Bill session aggregation type =
Exemption partner</p></li>
<li><p><mark>Fleet card issuer bill, pokud Bill session aggregation type
= Fleet card issuer</mark></p></li>
</ul></li>
<li><p>Date of issue = syst√©mov√© datum</p></li>
<li><p>Date of beginning = Bill session.Bill period start</p></li>
<li><p>Date of end = Bill session.Bill period end</p></li>
<li><p>Matched amount = 0</p></li>
</ul></li>
<li></li>
<li><p><mark>Syst√©m vypoƒç√≠t√° term√≠ny splatnosti (Bill Due
date)</mark></p>
<ul>
<li><p><mark>pro fakturu a vrubopis tak, ≈æe k¬†Bill Date of issue p≈ôiƒçte
hodnotu Maturity period z¬†p≈ô√≠slu≈°n√©ho √öƒçtu, p≈ô√≠padnƒõ</mark>
<mark>p≈ô√≠slu≈°n√© specializace Business partnera.</mark></p></li>
<li><p><mark>pro EETS dobropis tak, ≈æe k¬†Bill Date of issue p≈ôiƒçte
hodnotu Maturity period for credit note z¬†p≈ô√≠slu≈°n√©ho Poskytovatele
m√Ωtn√Ωch slu≈æeb,</mark></p></li>
<li><p><mark>pro jin√Ω dobropis tak, ≈æe k¬†Bill Date of issue p≈ôiƒçte
hodnotu z konfiguraƒçn√≠ho kl√≠ƒçe BE_Maturity period for customer credit
note.</mark></p></li>
</ul></li>
<li></li>
<li><p>Syst√©m vytvo≈ô√≠ statistiku fakturaƒçn√≠ d√°vky.</p></li>
</ul>


<p>Syst√©m nastav√≠ Bill status na <strong>Waiting for print</strong> a
postupnƒõ prov√°d√≠ n√°sleduj√≠c√≠ fakturaƒçn√≠ kroky:</p>


<ul>
<li><p>Syst√©m informace o faktu≈ôe v ePorezna form√°tu (XML) ode≈°le do
ePorezna na fiskalizaci (Rozhran√≠ ePorezna (fiskalizace)
(INT.BAR.31.HR).¬†</p></li>
<li><p>Syst√©m prop√≠≈°e Unique invoice identifier (JIR) z ePorezna
odpovƒõdi do Bill.JIR atributu.</p></li>
<li><p><mark>Syst√©m zjist√≠</mark> <mark>preferovan√Ω</mark> <mark>jazyk
faktury √öƒçtu nebo</mark> <mark>p≈ô√≠slu≈°n√© specializace Business
partnera</mark> <mark>(nap≈ô.</mark> <mark>Poskytovatele EETS</mark>
<mark>nebo FCI nebo Exemption partnera)</mark> <mark>(tj. ze
Account.Preferred document language nebo</mark> <mark>Business
partner.Preferred document language).</mark></p></li>
<li><p>Syst√©m vygeneruje podle bill type, bill issue type a bill
category v≈°echny dokumenty faktur, vrubopis≈Ø p≈ô√≠padnƒõ dobropis≈Ø
s¬†ohledem <mark>na zji≈°tƒõn√Ω preferovan√Ω jazyk</mark> v¬†pdf form√°tu za
vyu≈æit√≠ syst√©move√© funkce Vytvo≈ô a ulo≈æ dokument (SYS.DFRP.1.1):</p>
<ul>
<li><p>Faktura za m√Ωtn√© (DOC.BE.10.HR)</p></li>
<li><p>Vrubopis za m√Ωtn√© (DOC.BE.13.HR)</p></li>
<li><p>Dobropis za m√Ωtn√© (DOC.BE.14.HR),</p></li>
</ul></li>
<li><p>Syst√©m updatuje Bill.Bill document = identifik√°tor vygenerovan√©ho
PDF dokumentu faktury.</p></li>
<li><p>Syst√©m pro <mark>ka≈æd√Ω</mark> Customer bill za m√Ωto p≈ôiprav√≠ a
vygeneruje souhrnn√Ω detailn√≠ v√Ωpis (Detailn√≠ v√Ωpis m√Ωtn√Ωch transakc√≠
k¬†faktu≈ôe (DOC.BE.11.HR)) jako povinnou souƒç√°st vytvo≈ôen√©
faktury.</p></li>
<li><p>Syst√©m zjist√≠, zda se m√° faktura vygenerovat tak√© v xml form√°tu
jako elektronick√° faktura (tj. pokud CM.Account.Preferred electronic
invoice format = FINA, nebo ECM.EETS Provider.Preferred electronic
invoice format = FINA, nebo CM.Exemption partner.Preferred electronic
invoice format = FINA).</p></li>
<li><p>V p≈ô√≠padƒõ po≈æadovan√©ho elektronick√©ho form√°tu (XML) faktury:</p>
<ul>
<li><p>Syst√©m nav√≠c vygeneruje eFakturu (DOC.BE.21.HR). Syst√©m dokument
ulo≈æ√≠ s vyu≈æit√≠m p≈ô√≠padu u≈æit√≠ Ulo≈æ extern√≠ dokument
(SYS.DFRP.1.4).</p></li>
<li><p>Syst√©m updatuje Bill.E-Bill document = identifik√°tor vytvo≈ôen√©ho
XML dokumentu faktury.</p></li>
</ul></li>
<li><p>Syst√©m ode≈°le v≈°echny pdf a p≈ô√≠padnƒõ i XML verze faktur,
vrubopis≈Ø, dobropis≈Ø a info o Detailn√≠m v√Ωpisu v¬†csv form√°tu na
z√°kazn√≠k≈Øv/EETS Provider/Exemption partner email (pokud je vyplnƒõn)
spoleƒçnƒõ s¬†notifikac√≠ Ozn√°men√≠ o vystaven√≠ faktury
(NTF.DF.01.HR).</p></li>
<li><p>Syst√©m p≈ô√≠padnƒõ ode≈°le XML verzi faktury p≈ôes eFINA p≈ôes Rozhran√≠
eFINA (elektronick√° faktura) (INT.BAR.32.HR).</p></li>
<li><p>Syst√©m zmƒõn√≠ stav Bill.Bill issue status na Issued.</p></li>
</ul>


<p>Syst√©m dokonƒç√≠ proces vytv√°≈ôen√≠ pravideln√Ωch faktur a nastav√≠ stav
<strong>Bill session na Closed,</strong> pokud se v≈°echny Bills dostaly
do stavu Issued. Syst√©m postupnƒõ prov√°d√≠ n√°sleduj√≠c√≠ fakturaƒçn√≠
kroky:</p>


<ul>
<li></li>
</ul>


<p>Postup konƒç√≠</p>


<h4 id="alternativn√≠-postupy-2">Alternativn√≠ postupy</h4>


<p>Fakturaƒçn√≠ d√°vka opo≈ædƒõn√Ωch ud√°lost√≠</p>


<p>Syst√©m zpracuje opo≈ædƒõn√© m√Ωtn√© ud√°losti, kter√© vznikly v¬†ji≈æ
vyfakturovan√©m obdob√≠, kter√© p≈ôi≈°ly do Syst√©mu a≈æ po uz√°vƒõrce fakturaƒçn√≠
d√°vky, do kter√© pat≈ô√≠ podle data m√Ωtn√© transakce.</p>


<p>Syst√©m vybere bill session type = Delayed (Syst√©m automaticky spust√≠
proces uzav√≠r√°n√≠ pravideln√© fakturaƒçn√≠ d√°vky typu Delayed pouze u
zpracov√°v√°n√≠ norm√°ln√≠ho typu pravideln√© fakturaƒçn√≠ d√°vky).</p>


<p>Postup pokraƒçuje kroky jako u norm√°ln√≠ho typu fakturaƒçn√≠ d√°vky s¬†t√≠m
rozd√≠lem, ≈æe:</p>


<ul>
<li><p>Pokud p≈ôi vytv√°≈ôen√≠ tax bill itemy je souƒçet bill item s danou
sazbou danƒõ</p>
<ul>
<li><p>&lt; 0, pak Bill item type = Corrective bill item
credit,</p></li>
<li><p>&gt;=0 a z√°rove≈à neexistuj√≠ Corrective bill items debit a souƒçet
Corrective bill items credit je 0, pak Bill item type = Regular bill
item,</p></li>
<li><p>jinak Bill item type = Corrective bill item debit</p></li>
</ul></li>
<li><p>Pokud vypoƒçten√° hodnota bill.Total amount je &lt; 0, Syst√©m
nastav√≠ bill.Bill issue type = Corrective bill ‚Äì credit, jinak na
bill.Bill issue type = Corrective bill ‚Äì debit.</p></li>
<li><p>Detailn√≠ v√Ωpis m√Ωtn√Ωch transakc√≠ se vytvo≈ô√≠ v¬†p≈ô√≠padƒõ opo≈ædƒõn√Ωch
m√Ωtn√Ωch transakc√≠ jen v¬†d≈Øsledku vyd√°n√≠ vrubopisu) pro Customer
bills.</p></li>
</ul>


<p>Fakturaƒçn√≠ d√°vka znovuocenƒõn√Ωch ud√°lost√≠</p>


<p>Syst√©m zpracuje opƒõtovnƒõ ocenƒõn√© m√Ωtn√© ud√°losti.</p>


<p>Syst√©m vybere bill session type = Rerated (Syst√©m automaticky spust√≠
proces uzav√≠r√°n√≠ pravideln√© fakturaƒçn√≠ d√°vky typu Rerated pouze u
zpracov√°v√°n√≠ norm√°ln√≠ho typu pravideln√© fakturaƒçn√≠ d√°vky).</p>


<p>Postup pokraƒçuje kroky jako u norm√°ln√≠ho typu fakturaƒçn√≠ d√°vky s¬†t√≠m
rozd√≠lem, ≈æe:</p>


<ul>
<li><p>Pokud p≈ôi vytv√°≈ôen√≠ tax bill itemy je souƒçet bill item s danou
sazbou danƒõ</p>
<ul>
<li><p>&lt; 0, pak Bill item type = Corrective bill item
credit,</p></li>
<li><p>&gt;= 0, pak Bill item type = Corrective bill item debit</p></li>
</ul></li>
<li><p>Pokud vypoƒçten√° hodnota bill.Total amount je &lt; 0, Syst√©m
nastav√≠ bill.Bill issue type = Corrective bill ‚Äì credit, jinak na
bill.Bill issue type = Corrective bill ‚Äì debit. Do bill.Total amount se
ulo≈æ√≠ absolutn√≠ hodnota vypoƒçten√© ƒç√°stky.</p></li>
<li><p>Detailn√≠ v√Ωpis m√Ωtn√Ωch transakc√≠ se nevytvo≈ô√≠.</p></li>
<li></li>
</ul>


<h4 id="chybov√©-postupy-2">Chybov√© postupy</h4>


<p>Bill - Print failed</p>


<p>Pokud se nepoda≈ôilo vygenerovat v≈°echny dokumenty billu (tj.
nedokonƒçil se nƒõkter√Ω z n√°sleduj√≠c√≠ch krok≈Ø), Syst√©m u takov√Ωchto faktur
nastav√≠ jejich stav Bill.Bill issue status na Print failed:</p>


<ul>
<li><p>ePorezna package ‚Äì nepovedlo se mapov√°n√≠ / v√Ωroba
xml/json</p></li>
<li><p>odesl√°n√≠ do ePorezna ‚Äì skonƒçilo jako business error</p></li>
<li><p>tvorba document xml -chyba v naƒç√≠t√°n√≠ dat z¬†CM nebo chyba p≈ôi
tvorbƒõ XML</p></li>
<li><p>zasl√°n√≠ xml do DF: GenerateDocument ‚Äì skonƒçilo s error
result</p></li>
<li><p>tvorba eBill - chyba naƒç√≠t√°n√≠ dat z¬†CM</p></li>
<li><p>ulo≈æen√≠ eBill do DF: StoreExternalDocument - skonƒçilo s error
result</p></li>
<li><p>detailn√≠ v√Ωpis - chyba naƒç√≠t√°n√≠ dat z¬†CM nebo chyba p≈ôi tvorbƒõ
XML</p></li>
<li><p>ulo≈æen√≠ detailn√≠ho v√Ωpisu do DF: StoreExternalDocument - skonƒçilo
s error result</p></li>
<li><p>odesl√°n√≠ faktur p≈ôes DF: SendDocument - skonƒçilo s error
result</p></li>
<li><p>odesl√°n√≠ eBill z DF: SendToEfina - skonƒçilo s error
result</p></li>
</ul>


<p>Bill session - Closed with error</p>


<p>Syst√©m dokonƒç√≠ proces vytv√°≈ôen√≠ pravideln√Ωch faktur a nastav√≠ stav
<strong>Bill session na Closed with error</strong>, pokud nƒõkter√Ω z
Bills se dostal do stavu Print failed (tzn. nejsou v≈°echny ve stavu
Issued).</p>


<p>Na z√°kladƒõ manu√°lnƒõ spu≈°tƒõn√©ho dokonƒçovac√≠ho jobu, Syst√©m pro ka≈ædou
Bill session (tj. normal, delayed, rerated) ve stavu Closed with error
se pokus√≠ pro Bills ve stavu Print failed znovu vygenerovat pot≈ôebn√©
dokumenty.</p>


<p>Pokud bylo generov√°n√≠ dokument≈Ø √∫spƒõ≈°n√©, Syst√©m nastav√≠ Bill.Bill
issue status na Issued, jinak ponech√° stav Print failed.</p>


<p>Po zprocesov√°n√≠ v≈°ech problematick√Ωch Bills, Syst√©m nastav√≠ stav Bill
session na Closed, pokud v≈°echny Bill jsou ji≈æ Issued, jinak ponech√°
stav Closed with error a proces se opakuje.</p>


<h4 id="pozn√°mky-1">Pozn√°mky</h4>


<p>Pro Customer bills Detailn√≠ v√Ωpis m√Ωtn√Ωch transakc√≠ se vytvo≈ô√≠ pouze
v¬†p≈ô√≠padƒõ, ≈æe existuje alespo≈à jeden ocenƒõn√Ω z√°znam pro dan√Ω √∫ƒçet.</p>


<p>Pro Customer bills Detailn√≠ v√Ωpis m√Ωtn√Ωch transakc√≠ se d√°le vytvo≈ô√≠
v¬†p≈ô√≠padƒõ opo≈ædƒõn√Ωch m√Ωtn√Ωch ud√°lost√≠ (v d≈Øsledku vyd√°n√≠ vrubopisu).</p>


<h3 id="vytvo≈ô-jednor√°zovou-fakturu-za-slu≈æby-sys.bar.0.4.hr">Vytvo≈ô
jednor√°zovou fakturu za slu≈æby (SYS.BAR.0.4.HR)</h3>


<h4 id="c√≠l-3">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je vygenerov√°n√≠ jednor√°zov√© faktury za
na√∫ƒçtovan√© jednor√°zov√© poplatky nebo za proveden√Ω Top-up.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-3">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>P≈ô√≠pad u≈æit√≠ je vlo≈æenou souƒç√°st√≠ p≈ô√≠pad≈Ø u≈æit√≠:</p>


<ul>
<li><p>Top-up</p>
<ul>
<li><p>Zapla≈• p≈ôedplacen√Ω kredit ‚Äì Pre-paid in single domain
(UC.BAR.0.1.HR)</p></li>
</ul></li>
<li><p><mark>OBU,</mark> <mark>Products</mark></p>
<ul>
<li><p><mark>TBD</mark></p></li>
</ul></li>
<li><p><mark>Z√°porn√Ω kredit</mark></p>
<ul>
<li><p><mark>Ukonƒçi p≈ôedplacen√Ω √∫ƒçet (UC.CM.4.15)</mark></p></li>
</ul></li>
</ul>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-2">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Pro dan√Ω Account, pro kter√© je pot≈ôeba vystavit fakturu, je na
vstupu:</p>


<ul>
<li><p>identifikace Accountu</p></li>
<li><p>ocenƒõn√° ud√°lost (vƒçetn√© poƒçtu jednotek),</p></li>
<li><p>Bill issuer,</p></li>
<li><p>info o POS (pokud je to relevantn√≠)</p></li>
<li><p>informace o platbƒõ (pokud je informace o platbƒõ pr√°zdn√°, jde o
vystaven√≠ Proforma faktury)</p></li>
</ul>


<ul>
<li><p>pokud se jedn√° o Top-up, je zn√°ma ƒç√°stka platby</p></li>
<li><p>pokud se jedn√° o prodej OBU, jsou <mark>zn√°my</mark> <mark>ƒç√≠sla
prodan√Ωch OBU</mark> <mark>(OBU Serial number).</mark></p></li>
</ul>


<p>Pozn√°mka: Pro FCI, EETS Provider a Exemption partner nen√≠ aktu√°lnƒõ UC
pot≈ôeba realizovat.</p>


<h4 id="norm√°ln√≠-postup-2">Norm√°ln√≠ postup</h4>


<p>Syst√©m zjist√≠ BIBA:</p>


<ul>
<li><p>pro Top-up z¬†Payment.BIBA (tj. na z√°kladƒõ Bill issuer a Reason =
Top-up)</p></li>
<li><p>jinak na z√°kladƒõ Bill issuer a Reason = Services.</p></li>
</ul>


<p>Syst√©m, pokud jde o Top-up, vytvo≈ô√≠ Rated Service Event pro
top-up:</p>


<ul>
<li><p>Event time = sysdate</p></li>
<li><p>Product type = PCRE.product type (Top-Up)</p></li>
<li><p>Type = Rating</p></li>
<li><p>Basic unit price = Price amount</p></li>
<li><p>Basic unit price definition method = PCRE.product type.unit price
definition method (none)</p></li>
<li><p>Unit price = Price amount</p></li>
<li><p>Unit price VAT = Price amount VAT</p></li>
<li><p>Number of units = 1</p></li>
<li><p>Metric unit = piece</p></li>
<li><p>Tax rate = PCRE.tax rate rate</p></li>
<li><p>Price amount = ƒç√°stka top-up platby/(1+tax rate)</p></li>
<li><p>Price amount VAT = ƒç√°stka platby</p></li>
<li><p>Billing service = PCRE.billing service</p></li>
<li><p>Number of units corrected = null</p></li>
<li><p>Cancellable = True</p></li>
<li><p>Subject type = Account, pokud na vstupu je identifikace
Account</p></li>
<li><p>Subject number = ze vstupu</p></li>
<li><p>Bill issuer = ze vstupu</p></li>
<li><p><mark>FCI partner = FCI karty</mark> <mark>v¬†p≈ô√≠padƒõ
platby</mark> <mark>tankovac√≠</mark> <mark>kartou</mark></p></li>
<li><p><mark>Fleet Card Number = ƒå√≠slo tankovac√≠ karty v¬†p≈ô√≠padƒõ
platby</mark> <mark>tankovac√≠</mark> <mark>kartou</mark></p></li>
<li><p><mark>Fleet Card Id = Id tankovac√≠ karty v¬†p≈ô√≠padƒõ platby</mark>
<mark>tankovac√≠</mark> <mark>kartou</mark></p></li>
</ul>


<p>Pokud nejde o Top-up, Syst√©m na z√°kladƒõ ka≈æd√© ocenƒõn√© ud√°losti ze
vstupu na√∫ƒçtuje jednor√°zov√Ω poplatek za pou≈æit√≠ syst√©mov√© funkce Na√∫ƒçtuj
jednor√°zov√Ω poplatek (SYS.BAR.0.7.HR).</p>


<p>Syst√©m seskup√≠ ocenƒõn√© ud√°losti podle atribut≈Ø Rated service
events:</p>


<ul>
<li><p>Subject number (tj. Account nebo null),</p></li>
<li><p>Billing service,</p></li>
<li><p>Unit price VAT,</p></li>
<li><p>Unit price,</p></li>
<li><p>Tax rate,</p></li>
<li><p>Product type,</p></li>
<li><p>Basic unit price definition method,</p></li>
<li><p>Card number (pokud je na vstupu)</p></li>
<li><p>Discount rate.</p></li>
</ul>


<p>a pro ka≈ædou kombinaci vytvo≈ô√≠ Bill Item s¬†parametry:</p>


<ul>
<li><p>Bill item category =</p>
<ul>
<li><p>Top-up event, pokud Product type = Top-up</p></li>
<li><p>OBU event, pokud Product type = OBU</p></li>
<li><p>jinak Service event</p></li>
</ul></li>
<li><p>Bill item type = Regular bill item</p></li>
<li><p>Unit price = Unit price z¬†RSE</p></li>
<li><p>Unit price VAT = Unit price VAT z¬†RSE</p></li>
<li><p>Number of units = souƒçet z¬†Number of units RSE</p></li>
<li><p>Metric unit = Piece</p></li>
<li><p>Tax rate = Tax rate z¬†RSE</p></li>
<li><p>Price amount = ƒç√°stka poplatk≈Ø bez danƒõ,</p></li>
<li><p>Price amount VAT = ƒç√°stka poplatk≈Ø s¬†dan√≠</p></li>
<li><p>Billing service = Billing service z¬†RSE</p></li>
</ul>


<p>Syst√©m pro ka≈ædou sazbu tax rate vytvo≈ô√≠ tax bill item:</p>


<ul>
<li><p>Bill item category = Tax</p></li>
<li><p>Bill item type = Regular bill item</p></li>
<li><p>Number of units = null</p></li>
<li><p>Metric unit = null</p></li>
<li><p>Tax rate = sazba danƒõ (v procentech)</p></li>
<li><p>Price amount = celkov√° da≈à za bill itemy s¬†danou tax rate (Tax
base * Tax rate a zaokrouhlen√≠ na dvƒõ desetinn√° m√≠sta)</p></li>
<li><p>Tax base = celkov√° ƒç√°stka bez danƒõ s¬†danou tax rate (suma Price
amount p≈ô√≠slu≈°n√Ωch neda≈àov√Ωch bill items a zaokrouhlen√≠ na dvƒõ desetinn√°
m√≠sta)</p></li>
</ul>


<p>Syst√©m zjist√≠ pro ka≈ædou sazbu danƒõ, zda nen√≠ pot≈ôeba Rounding
adjustment:</p>


<ul>
<li><p>Pokud rozd√≠l, da≈àov√© bill item.tax base a absolutn√≠ hodnoty
souƒçtu neda≈àov√Ωch bill item.price amount, nen√≠ roven nule, Rounding
adjustment bill item se vytvo≈ô√≠ s¬†v√Ωsledkem rozd√≠lu jako bill item.price
amount</p></li>
<li><p>Pokud rozd√≠l, (souƒçtu da≈àov√© bill item.tax base a da≈àov√© bill
item.price amount) a souƒçtu neda≈àov√Ωch bill item.price amount VAT, nen√≠
roven nule, Rounding adjustment bill iem se vytvo≈ô√≠, s¬†v√Ωsledkem rozd√≠lu
jako bill item.price amount VAT</p>
<ul>
<li><p>Syst√©m vytvo≈ô√≠ korekƒçn√≠ bill item s¬†parametry:</p></li>
<li><p>Bill item category = Rounding adjustment</p></li>
<li><p>Product type = null</p></li>
<li><p>Bill item type =</p>
<ul>
<li><p>pokud vypoƒçten√Ω rozd√≠l je vƒõt≈°√≠ ne≈æ 0, pak Corrective bill item ‚Äì
credit,</p></li>
<li><p>jinak Corrective bill item ‚Äì debit</p></li>
</ul></li>
<li><p>Unit price = Price amount</p></li>
<li><p>Unit price VAT = Price amount VAT</p></li>
<li><p>Number of units = 1</p></li>
<li><p>Metric unit = Piece</p></li>
<li><p>Tax rate = null</p></li>
<li><p>Price amount = podle v√Ωsledku v√Ωpoƒçtu, buƒè absolutn√≠ hodnota
rozd√≠lu, jinak null</p></li>
<li><p>Price amount VAT = podle v√Ωsledku v√Ωpoƒçtu, buƒè absolutn√≠ hodnota
rozd√≠lu, jinak null</p></li>
<li><p>Billing service = Syst√©m zjist√≠ billing service z PCRE na z√°kladƒõ
Billing service.abbreviation = ADJ-ROUNDING</p></li>
</ul></li>
</ul>


<p>Syst√©m vytvo≈ô√≠ vytvo≈ô√≠ Bill s¬†parametry:</p>


<ul>
<li><p>Bill number = Unik√°tn√≠ ƒç√≠slo faktury podle sch√©matu z ƒå√≠slov√°n√≠
faktur v z√°vislosti na Bill type, Bill issue type, Bill category a Bill
issuer.</p></li>
<li><p>Fiscal verification number = vygeneruje se Fisk√°ln√≠ verifikaƒçn√≠
ƒç√≠slo ze sekvence pro ƒç√≠slov√°n√≠ faktur (BNF77) s Business Premises BO,
urƒçen√Ωm podle user profile</p></li>
<li><p>ZKI = vypln√≠ se Ochrann√Ω k√≥d vystavitele faktury (Issuer's
Protection Code)</p></li>
<li><p>Bill type =</p>
<ul>
<li><p>Pokud jde o subject type = Account, pak Customer bill</p></li>
<li></li>
<li><p><mark>pokud jde o Fleet card issuer, pak FCI bill</mark></p></li>
<li><p><mark>pokud jde o Exemption partner, pak Exemption partner
bill</mark></p></li>
<li><p><mark>pokud jde o</mark> <mark>subjecte type =</mark> <mark>EETS
Provider, pak EETS Provider bill</mark></p></li>
</ul></li>
<li><p>Bill category =</p>
<ul>
<li><p>OBU, pokud Bill item category = OBU event,</p></li>
<li><p>Services, pokud Bill item category = Service Event,</p></li>
<li><p>Top-up, pokud Bill item category = Top-up event.</p></li>
</ul></li>
<li><p>Bill issue type =</p>
<ul>
<li><p>Proforma bill, pokud neexistuje platba pro danou
operaci,</p></li>
<li><p>Advance bill, pokud Bill category = Top-up,</p></li>
<li><p>else Regular bill.</p></li>
</ul></li>
<li><p>Bill recurrence type = One-time bill</p></li>
<li><p>Bill issue status = Issued</p></li>
<li><p>Bill payment status = Unpaid</p></li>
<li><p>Comment = null</p></li>
<li><p>Bill amount = souƒçet da≈àov√Ωch bill items.tax base</p></li>
<li><p>Tax amount = souƒçet da≈àov√Ωch bill items.price amount</p></li>
<li><p>Total amount = souƒçet Bill amount a Tax amount</p></li>
<li><p>Date of issue = aktu√°ln√≠ datum</p></li>
<li><p>Due date = se vypoƒçte tak, ≈æe k¬†Bill Date of issue se p≈ôiƒçte
hodnota Maturity period z¬†p≈ô√≠slu≈°n√©ho √öƒçtu, <mark>p≈ô√≠padnƒõ</mark>
<mark>z</mark> <mark>Provider EETS, p≈ô√≠padnƒõ</mark> <mark>z</mark>
<mark>Exemption partner, p≈ô√≠padnƒõ</mark> <mark>z</mark>
<mark>FCI</mark>.</p></li>
<li><p>Date of beginning = aktu√°ln√≠ datum</p></li>
<li><p>Date of end = aktu√°ln√≠ datum</p></li>
<li><p>Matched amount = 0</p></li>
<li><p>Subject type = Subject type z RSE</p></li>
<li><p>Subject number = Subject number z RSE</p></li>
<li><p>Bill issuer bank account = zji≈°tƒõn√© ƒç√≠slo bankovn√≠ho √∫ƒçtu Bill
issuera (BIBA)</p></li>
<li><p>Bill issuer = Bill issuer ze vstupu</p></li>
</ul>


<p>Pokud se nejedn√° o Proforma bill, Syst√©m informace o faktu≈ôe v¬†XML
form√°tu ode≈°le do ePorezna na fiskalizaci (Rozhran√≠ ePorezna
(fiskalizace) (INT.BAR.31.HR).¬†</p>


<p>Syst√©m prop√≠≈°e Unique Invoice Identifier (JIR) z ePorezna odpovƒõdi do
Bill.JIR atributu.</p>


<p><mark>Syst√©m zjist√≠ jazyk faktury √öƒçtu nebo Poskytovatele EETS (tj.
ze Account.Preferred document language nebo EETS Provider.Preferred
document language).</mark></p>


<p>Pokud se p≈ô√≠pad u≈æit√≠ spustil na POS (MEV, Kiosk, POS),</p>


<p>Syst√©m zjist√≠, zda se m√° dokument generovat ve variantƒõ (DOC.BE.x)
v¬†p≈ô√≠padƒõ A4 form√°tu nebo (DOC.BE.x<strong>B</strong>) v¬†p≈ô√≠padƒõ thermo
tisku na POS (podle POS.Printer type).</p>


<p>Syst√©m, s¬†ohledem na <mark>zji≈°tƒõn√Ω preferovan√Ω jazyk,</mark> na
zji≈°tƒõnou variantu dokumentu, vygeneruje dokument faktury v¬†pdf
form√°tu:</p>


<ul>
<li><p>Pokud jde o bill category = Top-up, pak Z√°lohov√° faktura za
top-up (DOC.BE.1.HR) v¬†p≈ô√≠padƒõ A4 form√°tu, nebo (DOC.BE.1B.HR) v¬†p≈ô√≠padƒõ
thermo tisku</p></li>
<li><p>pokud jde o bill issue type = Proforma bill, pak Proforma faktura
(DOC.BE.24.HR),</p></li>
<li><p>jinak (Faktura za slu≈æby (DOC.BE.16.HR),</p></li>
</ul>


<p>s vyu≈æit√≠m p≈ô√≠padu u≈æit√≠ Vytvo≈ô a ulo≈æ dokument (SYS.DFRP.1.1).</p>


<p>Syst√©m zjist√≠, zda se m√° faktura vygenerovat tak√© v xml form√°tu jako
elektronick√° faktura (tj. pokud CM.Account.Preferred electronic invoice
format = FINA, <mark>nebo ECM.EETS Provider.Preferred electronic invoice
format = FINA, nebo CM.Exemption partner.Preferred electronic invoice
format = FINA)</mark>.</p>


<p>V p≈ô√≠padƒõ po≈æadovan√©ho XML form√°tu, Syst√©m nav√≠c vygeneruje eFakturu
(DOC.BE.21.HR). Syst√©m dokument ulo≈æ√≠ s vyu≈æit√≠m p≈ô√≠padu u≈æit√≠ Ulo≈æ
extern√≠ dokument (SYS.DFRP.1.4).</p>


<p>Syst√©m updatuje na Bill.Bill document = identifik√°tor vygenerovan√©ho
PDF dokumentu faktury.</p>


<p>Syst√©m p≈ô√≠padnƒõ updatuje Bill.E-Bill document = identifik√°tor
vytvo≈ôen√©ho XML dokumentu faktury.</p>


<p><mark>Pokud vygenerov√°n√≠ faktury probƒõhlo na ≈æ√°dost DU, Syst√©m ode≈°le
do DU identifikaci vznikl√© faktury.</mark></p>


<p>Pokud vygenerov√°n√≠ faktury probƒõhlo pro POS (MEV, Kiosk, POS), Syst√©m
dokument nab√≠dne ke sta≈æen√≠.</p>


<p>Syst√©m ode≈°le pdf a p≈ô√≠padnƒõ XML verzi faktury na z√°kazn√≠k≈Øv email
<mark>p≈ô√≠padnƒõ email Poskytovatele m√Ωtn√Ωch slu≈æeb</mark> spoleƒçnƒõ
s¬†notifikac√≠:</p>


<ul>
<li><p>Ozn√°men√≠ o vystaven√≠ faktury za p≈ôedplacen√≠ kreditu
(NTF.BAR.01.HR), pokud jde o Top-up</p></li>
<li><p>jinak Ozn√°men√≠ o vystaven√≠ faktury (NTF.BAR.21.HR).</p></li>
</ul>


<p>Syst√©m p≈ô√≠padnƒõ ode≈°le XML verzi faktury p≈ôes eFINA p≈ôes Rozhran√≠
eFINA (elektronick√° faktura) (INT.BAR.32.HR).</p>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-3">Alternativn√≠ postupy</h4>


<p>Nejsou</p>


<h4 id="chybov√©-postupy-3">Chybov√© postupy</h4>


<p>Nejsou</p>


<h4 id="pozn√°mky-2">Pozn√°mky</h4>


<p>Nejsou</p>


<h3 id="vytvo≈ô-fakturaƒçn√≠-d√°vku-sys.bar.0.6.hr">Vytvo≈ô fakturaƒçn√≠ d√°vku
(SYS.BAR.0.6.HR) </h3>


<h4 id="c√≠l-4">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je otev≈ôen√≠ nov√© Bill session.</p>


<p>Budou se vytv√°≈ôet Bill sessions podle nastaven√Ωch Bill cycles platn√©
pro jednotliv√© Bill session aggregation typy, Bill session content typy
a norm√°ln√≠ Bill session type.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-4">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>Na z√°kladƒõ napl√°novan√© operace BEm.CreateBillSessions.</p>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-3">Podm√≠nky spu≈°tƒõn√≠</h4>


<h4 id="popis-1">Popis</h4>


<p>Syst√©m vytvo≈ô√≠ novou Bill Session na z√°kladƒõ hodnot bill session
aggregation type, Bill session content type a Bill cycle:</p>


<ul>
<li><p>Bill session number = ƒå√≠slo fakturaƒçn√≠ d√°vky ve form√°tu
RRMMDDXXXX</p></li>
<li><p>Bill session aggregation type = Post-paid card, <mark>Post-paid
invoice</mark>, EETS Provider, Exemption partner, <mark>Fleet card
issuer, Pre-paid</mark></p></li>
<li><p>Bill session content type = Toll</p></li>
<li><p>Bill session type = Normal</p></li>
<li><p>Bill session status = Open</p></li>
<li><p>Bill period start = navazuj√≠c√≠ na Bill period end p≈ôedchoz√≠ Bill
session</p></li>
<li><p>Bill period end = Bill period start posunut√Ω o Bill
cycle</p></li>
<li><p>Bill cycle = Month, 15-days</p></li>
<li></li>
</ul>


<p>Nastaven√≠ p≈ôi instalaci:</p>


<p>pro EETS Provider a Toll</p>


<ul>
<li><p>Bill session aggregation type = EETS Provider</p></li>
<li><p>Bill session content type = Toll</p></li>
<li><p>Bill cycle = 15-days, Month (agregace podle hodnoty atributu Bill
cycle na EETS Provider)</p></li>
</ul>


<p><mark>pro Post-paid Invoice a</mark> <mark>Toll</mark></p>


<ul>
<li><p><mark>Bill session aggregation type = Post-paid
Invoice</mark></p></li>
<li><p><mark>Bill session content type = Toll</mark></p></li>
<li><p><mark>Bill cycle = Month (agregace podle hodnoty atributu Bill
cycle na Account)</mark></p></li>
</ul>


<p>pro Post-paid Card a Toll</p>


<ul>
<li><p>Bill session aggregation type = Post-paid Card</p></li>
<li><p>Bill session content type = Toll</p></li>
<li><p>Bill cycle = Month (agregace podle hodnoty atributu Bill cycle na
Account)</p></li>
</ul>


<p>pro Exemption partner a Toll</p>


<ul>
<li><p>Bill session aggregation type = Exemption partner</p></li>
<li><p>Bill session content type = Toll</p></li>
<li><p>Bill cycle = 15-days, Month (agregace podle hodnoty atributu Bill
cycle na VCM.Exemption partner)</p></li>
</ul>


<p><mark>pro FC payments</mark></p>


<ul>
<li><p><mark>Bill session content type = FC payments (agregace podle
typu bill itemy)</mark></p></li>
<li><p><mark>Bill cycle = 15-days, Month (agregace podle hodnoty
atributu Bill cycle na FCI)</mark></p></li>
</ul>


<p><mark>pro</mark> <mark>Fleet card issuer a</mark>
<mark>Toll</mark></p>


<ul>
<li><p><mark>Bill session aggregation type = Exemption
partner</mark></p></li>
<li><p><mark>Bill session content type = Toll</mark></p></li>
<li><p><mark>Bill cycle = 15-days, Month (agregace podle hodnoty
atributu Bill cycle na VCM.Exemption partner)</mark></p></li>
</ul>


<p><mark>pro Pre-paid</mark> <mark>a</mark> <mark>Toll</mark></p>


<ul>
<li><p><mark>Bill session aggregation type =</mark>
<mark>Pre-paid</mark></p></li>
<li><p><mark>Bill session content type = Toll</mark></p></li>
<li><p><mark>Bill cycle = Month (agregace podle hodnoty atributu Bill
cycle na Account)</mark></p></li>
</ul>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-4">Alternativn√≠ postupy</h4>


<p>Nejsou</p>


<h4 id="chybov√©-postupy-4">Chybov√© postupy</h4>


<p>Nejsou</p>


<h4 id="pozn√°mky-3">Pozn√°mky</h4>


<p>Nejsou</p>


<h3 id="na√∫ƒçtuj-jednor√°zov√Ω-poplatek-sys.bar.0.7.hr">Na√∫ƒçtuj jednor√°zov√Ω
poplatek (SYS.BAR.0.7.HR)</h3>


<h4 id="c√≠l-5">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je vygenerov√°n√≠ jednor√°zov√©ho poplatku na
≈æ√°dost r≈Øzn√Ωch proces≈Ø.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-5">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>P≈ô√≠pad u≈æit√≠ je vlo≈æenou souƒç√°st√≠ p≈ô√≠pad≈Ø u≈æit√≠:</p>


<ul>
<li><p>UCs vy≈æaduj√≠c√≠ Administrativn√≠ poplatek za P≈ôestupek
(Offence)</p>
<ul>
<li><p>Vytvo≈ô v√Ωzvy na √∫hradu za p≈ôestupky (SYS.BAR.0.13.HR)</p></li>
<li><p>Vytvo≈ô jednor√°zovou fakturu za m√Ωto (SYS.BAR.14.HR)</p></li>
</ul></li>
<li><p><mark>UC vy≈æaduj√≠c√≠ Poplatek za odesl√°n√≠ OBU po≈°tou</mark></p>
<ul>
<li><p><mark>Zjisti poƒçty z√°silek pro na√∫ƒçtov√°n√≠ poplatk≈Ø za zasl√°n√≠ OBU
(SYS.CM.7.38)</mark></p></li>
<li></li>
</ul></li>
</ul>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-4">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Je zn√°m Bill issuer, typ poplatku <mark>nebo poplatk≈Ø</mark>, kter√Ω
je pot≈ôeba vygenerovat (tj. Product type a odpov√≠daj√≠c√≠ hodnotu Event
attribute type), poƒçet jednotek a subjekt (p≈ô√≠padnƒõ subjekt type):</p>


<ul>
<li><p>Administrative fee za Offence:</p>
<ul>
<li><p>Product type = DF (Dunning fee) + hodnota event atributu type =
Chargeable service ze vstupu (i.e. Offence fee<mark>, MEV
fee</mark>),</p></li>
<li><p>Poƒçet jednotek</p></li>
<li><p>Info o subjektu</p></li>
<li><p>Bill issuer</p></li>
</ul></li>
<li><p><mark>OBU:</mark></p>
<ul>
<li><p><mark>Product type =</mark> <mark>OBU</mark> <mark>+ pro event
atribut type</mark> <mark>= Chargeable service, jeho hodnota =
OBU</mark> <mark>fee,</mark></p></li>
<li><p><mark>Poƒçet jednotek</mark></p></li>
<li><p><mark>Info o subjektu</mark></p></li>
<li><p><mark>p≈ô√≠padnƒõ info o Fleet card, pokud jde o platbu</mark>
<mark>fleet card</mark></p></li>
<li><p><mark>Bill issuer</mark></p></li>
</ul></li>
<li><p><mark>OBU sending:</mark></p>
<ul>
<li><p><mark>Product type =</mark> <mark>OBU nebo ?Chargeable services +
pro event atribut type</mark> <mark>= Chargeable service, jeho hodnota =
OBU</mark> <mark>sending</mark> <mark>fee,</mark></p></li>
<li><p><mark>je zn√°m vypoƒç√≠tan√Ω poƒçet z√°silek</mark></p></li>
<li><p><mark>Info o subjektu</mark></p></li>
<li><p><mark>p≈ô√≠padnƒõ info o Fleet card, pokud jde o platbu fleet
card</mark></p></li>
<li><p><mark>Bill issuer</mark></p></li>
</ul></li>
</ul>


<p>Poplatky v¬†jednom vol√°n√≠ mohou vych√°zet jen z jednoho Product
type.</p>


<p>Pozn√°mka: Pro FCI, EETS Provider a Exemption partner nen√≠ aktu√°lnƒõ UC
pot≈ôeba realizovat.</p>


<h4 id="norm√°ln√≠-postup-3">Norm√°ln√≠ postup</h4>


<p><mark>Syst√©m</mark> <mark>zjist√≠ BIBA na z√°kladƒõ Bill issuera ze
vstupu</mark> <mark>a Reason = Services.</mark></p>


<ul>
<li></li>
</ul>


<p>Administrativn√≠ poplatek za Offence</p>


<p>Syst√©m pro po≈æadovan√Ω typ poplatku, zjist√≠ jeho ƒç√°stku na z√°kladƒõ
kombinace atribut≈Ø</p>


<ul>
<li><p>Bill issuer, <mark>Bill issuer currency, Bill issuer VAT
registration country,</mark></p></li>
<li><p><mark>VAT registration country z√°kazn√≠ka, VAT registration
country z√°kazn√≠ka</mark>,</p></li>
<li><p>Product type = Dunning fee + hodnota event atributu typu =
Chargeable service ze vstupu (i.e. Offence fee nebo MEV fee),</p></li>
</ul>


<p>za pou≈æit√≠ syst√©mov√© funkce Oce≈à produkt (SYS.PCRE.1.4.HR).</p>


<p>Postup pokraƒçuje krokem <strong>Spoleƒçn√Ω postup pro v≈°echny
poplatky</strong> s Number of units = poƒçet Offences dan√©ho Bill
issuer.</p>


<p><mark>Poplatek za zasl√°n√≠ OBU</mark></p>


<p><mark>Syst√©m pro po≈æadovan√Ω typ poplatku, zjist√≠ jeho ƒç√°stku na
z√°kladƒõ kombinace atribut≈Ø</mark></p>


<ul>
<li><p><mark>Bill issuer, Bill issuer currency, Bill issuer VAT
registration country,</mark></p></li>
<li><p><mark>VAT registration country z√°kazn√≠ka, VAT registration
country z√°kazn√≠ka,</mark></p></li>
<li><p><mark>Product type =</mark> <mark>Chargeable service</mark>
<mark>+ hodnota event atributu typu = Chargeable service ze vstupu
(i.e.</mark> <mark>OBU sending fee),</mark></p></li>
</ul>


<p><mark>za pou≈æit√≠ p≈ô√≠padu u≈æit√≠ Oce≈à produkt
(SYS.PCRE.1.4).</mark></p>


<p><mark>Postup pokraƒçuje krokem <strong>Spoleƒçn√Ω postup pro v≈°echny
poplatky</strong></mark> <mark>s</mark> <mark>Number of units =
spoƒç√≠tan√Ω poƒçet z√°silek.</mark></p>


<p>Spoleƒçn√Ω postup pro v≈°echny poplatky</p>


<p>Pokud je poplatek = 0 a konfiguraƒçn√≠ kl√≠ƒç
BE_AggregateZeroServiceTransactions = no, postup pro dan√Ω poplatek konƒç√≠
(nevytvo≈ô√≠ se RSE a bill item pro tento poplatek).</p>


<p>Syst√©m vytvo≈ô√≠ Rated service event pro ka≈æd√Ω typ poplatku ze
vstupu:</p>


<ul>
<li><p>Event time = sysdate</p></li>
<li><p>Type = Rating</p></li>
<li><p>Product type = ze vstupu (PCRE.Product type)</p></li>
<li><p>Basic unit price = z PCRE Basic unit price</p></li>
<li><p>Unit price = z PCRE Unit price</p></li>
<li><p>Unit price VAT= z PCRE Unit price VAT</p></li>
<li><p>Basic unit price definition method = z PCRE.product type.basic
unit price definition method</p></li>
<li><p>Number of units = poƒçet jednotek ze vstupu</p></li>
<li><p>Metric unit = Piece</p></li>
<li><p>Tax rate = z PCRE.tax rate</p></li>
<li><p>Price amount = ƒç√°stka poplatku bez danƒõ = z PCRE Price amount *
Number of units</p></li>
<li><p>Price amount VAT = ƒç√°stka poplatku s dan√≠ = z PCRE Price amount
VAT * Number of units</p></li>
<li><p>Billing service = z PCRE.billing service</p></li>
<li><p>Subject type =</p>
<ul>
<li><p>Account, pokud na vstupu Account info,</p></li>
<li><p>jinak No subject</p></li>
</ul></li>
<li><p>Subject number =</p>
<ul>
<li><p>ze vstupu VCM.account, pokud Subject type = Account,</p></li>
<li><p>jinak Null</p></li>
</ul></li>
<li><p>Cancellable = true</p></li>
<li><p>Number of units corrected = 0</p></li>
<li><p>FCI partner = FCI karty v p≈ô√≠padƒõ platby tankovac√≠
kartou</p></li>
<li><p>Fleet Card Number = ƒå√≠slo tankovac√≠ karty v p≈ô√≠padƒõ platby
tankovac√≠ kartou</p></li>
<li><p>Fleet Card Id = Id tankovac√≠ karty v p≈ô√≠padƒõ platby tankovac√≠
kartou</p></li>
</ul>


<p>Postup konƒç√≠</p>


<h4 id="alternativn√≠-postupy-5">Alternativn√≠ postupy</h4>


<p>≈Ω√°dn√©</p>


<h4 id="chybov√©-postupy-5">Chybov√© postupy</h4>


<p>≈Ω√°dn√©</p>


<h4 id="pozn√°mky-4">Pozn√°mky</h4>


<p>≈Ω√°dn√©</p>


<h3 id="zagreguj-ocenƒõn√©-ud√°losti-do-fakturaƒçn√≠-d√°vky-sys.bar.0.12.hr">Zagreguj
ocenƒõn√© ud√°losti do fakturaƒçn√≠ d√°vky (SYS.BAR.0.12.HR) </h3>


<h4 id="c√≠l-6">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je zagregovat vytvo≈ôen√© Ocenƒõn√© m√Ωtn√©
ud√°losti (Rated Toll Events) do Fakturaƒçn√≠ d√°vky (Bill Sesssion).</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-6">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<blockquote>
<p>Je vlo≈æenou souƒç√°st√≠ p≈ô√≠padu u≈æit√≠:</p>
</blockquote>


<ul>
<li><p>Ulo≈æ ocenƒõnou m√Ωtnou transakci (SYS.BAR.1.8.HR)</p></li>
<li><p>Zapla≈• m√Ωtnou transakci tokenem (SYS.BAR.1.10.HR)</p></li>
</ul>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-5">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Jde o Toll Transaction s Registration type = EETS, Exempted, Exempted
not compliant nebo Exempted trip, nebo jde o Post-paid card registration
type po √∫spƒõ≈°n√© platbƒõ kartou</p>


<p>Rated toll event je≈°tƒõ nen√≠ agregov√°n do Bill session.</p>


<h4 id="popis-2">Popis</h4>


<p>Syst√©m na z√°kladƒõ nastaven√≠ VCM.Exemption partner, VCM.Account nebo
ECM.EETS Provider, vyhled√° Bill session, kter√° odpov√≠d√° podm√≠nk√°m:</p>


<ul>
<li><p>Pro Subject type = Account a Registration type = Post-paid
invoice:</p>
<ul>
<li><p>Toll transaction.event time spad√° do intervalu Bill
session</p></li>
<li><p>Bill session.bill session aggregation type = Post-paid
invoice</p></li>
<li><p>VCM.Account.bill cycle platn√Ω v dobƒõ event time = Bill
session.bill cycle</p></li>
<li><p>Bill session content type = Toll</p></li>
</ul></li>
<li><p>Pro Subject type = Account a Registration type = Post-paid card
(po √∫spƒõ≈°n√© platbƒõ):</p>
<ul>
<li><p>Toll transaction.event time spad√° do intervalu Bill
session</p></li>
<li><p>Bill session.bill session aggregation type = Post-paid
card</p></li>
<li><p>VCM.Account.bill cycle platn√Ω v dobƒõ event time = Bill
session.bill cycle</p></li>
<li><p>Bill session content type = Toll</p></li>
</ul></li>
<li><p>Pro Subject type = EETS Provider:</p>
<ul>
<li><p>Toll transaction.event time spad√° do intervalu Bill
session</p></li>
<li><p>Bill session.bill session aggregation type = EETS
Provider</p></li>
<li><p>ECM.EETS Provider.bill cycle platn√Ω v dobƒõ event time = Bill
session.bill cycle</p></li>
<li><p>Bill session content type= Toll</p></li>
</ul></li>
<li><p>Pro Subject type = Exemption partner:</p>
<ul>
<li><p>Toll transaction.event time spad√° do intervalu Bill
session</p></li>
<li><p>Bill session.bill session aggregation type = Exemption
partner</p></li>
<li><p>VCM.Exemption partner.bill cycle platn√Ω v dobƒõ event time = Bill
session.bill cycle</p></li>
<li><p>Bill session content type= Toll</p></li>
</ul></li>
<li></li>
</ul>


<p>Pokud Bill session neexistuje, Syst√©m odpov√≠daj√≠c√≠ session s¬†content
type = Toll vytvo≈ô√≠ a nastav√≠ jej√≠ platnost (nap≈ô. podle p≈Øvodn√≠ bill
session, do kter√© opo≈æden√° nebo opravn√° polo≈æka pat≈ôila) tak aby :</p>


<ul>
<li><p>Pro opo≈ædƒõn√© ocenƒõn√© m√Ωtn√© ud√°losti (ud√°losti vznikl√© v ji≈æ
vyfakturovan√©m obdob√≠, kter√© p≈ôi≈°ly do Syst√©mu a≈æ po uz√°vƒõrce fakturaƒçn√≠
d√°vky do kter√© pat≈ô√≠ podle data m√Ωtn√© transakce) Syst√©m vytvo≈ô√≠ novou
pravidelnou fakturaƒçn√≠ d√°vku s typem = Delayed.</p></li>
<li><p>Opƒõtovnƒõ ocenƒõn√© nebo ru≈°en√© m√Ωtn√© ud√°losti (rerating chybnƒõ
ocenƒõn√Ωch ud√°lost√≠), Syst√©m vytvo≈ô√≠ novou pravidelnou fakturaƒçn√≠ d√°vku s
typem = Rerated.</p></li>
</ul>


<p>Syst√©m updatuje atributy na Toll Transaction:</p>


<ul>
<li><p>Agregation time = sysdate time</p></li>
</ul>


<p>Syst√©m p≈ôi≈ôad√≠ ocenƒõn√© m√Ωtn√© ud√°losti k Bill ve stavu Bill issue
status = In progress podle:</p>


<ul>
<li><p>Bill issuer,</p></li>
<li><p>Account nebo EETS Provider nebo Exemption partner,</p></li>
<li><p>a Bill Session.</p></li>
</ul>


<p>Pokud Bill neexistuje, Syst√©m vytvo≈ô√≠ nov√Ω Bill:</p>


<ul>
<li><p>Bill type =</p>
<ul>
<li><p>Customer bill, pokud Bill session.bill session aggregation type =
Post-paid card nebo Post-paid invoice</p></li>
<li><p>EETS Provider bill, pokud Subjekt type = EETS Provider</p></li>
<li><p>Exemption partner bill, pokud Subjekt type = Exemption
partner</p></li>
</ul></li>
<li><p>Bill recurrence type = Periodical bill</p></li>
<li><p>Bill category = Toll</p></li>
<li><p>Bill issue status = In progress</p></li>
<li><p>Bill payment status =</p>
<ul>
<li><p>Payment not needed, pokud jde o Bill session.bill session
aggregation type = Post-paid card (tj. po √∫spƒõ≈°n√© platbƒõ kartou
(SYS.BAR.1.10.HR)</p></li>
<li><p>jinak Unpaid</p></li>
</ul></li>
<li><p>Subject type = Toll transaction.Subject type</p></li>
<li><p>Subject number = Toll transaction.Subject type</p></li>
<li><p>Bill issuer bank account = null</p></li>
<li><p>Bill issuer = Toll transaction.Bill issuer</p></li>
</ul>


<p>Syst√©m seskup√≠ ocenƒõn√© m√Ωtn√© ud√°losti podle:</p>


<ul>
<li><p>Subject number (tj. Account nebo Exemption partner nebo EETS
Provider),</p></li>
<li><p>Bill id</p></li>
<li><p>Billing service,</p></li>
<li><p>Unit price VAT,</p></li>
<li><p>Unit price,</p></li>
<li><p>Tax rate,</p></li>
<li><p>Discount rate,</p></li>
<li><p>Card number (jen pro Bill session.bill session aggregation type =
Post-paid card),</p></li>
<li><p>Charge type,</p></li>
<li><p>a Bill Session.</p></li>
</ul>


<p>Syst√©m pro ka≈ædou skupinu z¬†p≈ôedchoz√≠ho kroku aktualizuje
odpov√≠daj√≠c√≠ Bill item:</p>


<ul>
<li><p>Price amount nav√Ω≈°√≠ o sumu v≈°ech Price amount z¬†jednotliv√Ωch
seskupen√Ωch Rated toll event,</p></li>
<li><p>Price amount VAT nav√Ω≈°√≠ o sumu v≈°ech Price amount VAT
z¬†jednotliv√Ωch seskupen√Ωch Rated toll event,</p></li>
<li><p>Discount amount nav√Ω≈°√≠ o sumu v≈°ech Discount amount
z¬†jednotliv√Ωch seskupen√Ωch Rated toll event</p></li>
<li><p>Discount amount VAT nav√Ω≈°√≠ o sumu v≈°ech Discount amount
z¬†jednotliv√Ωch seskupen√Ωch Rated toll event</p></li>
<li><p>Number of units nav√Ω≈°√≠ o sumu v≈°ech Number of units
z¬†jednotliv√Ωch seskupen√Ωch Rated Toll Events.</p></li>
</ul>


<ul>
<li><p>Pokud Bill item neexistuje, Syst√©m ho vytvo≈ô√≠:</p>
<ul>
<li><p>Bill item category = Toll event.</p></li>
<li><p>Product type = podle hodnoty z PCRE</p></li>
<li><p>Bill item type = podle Toll transaction type, pokud</p>
<ul>
<li><p>je Toll transaction type = Rating</p>
<ul>
<li><p>a pokud je v aktu√°ln√≠ session, pak Regular bill item,</p></li>
<li><p>a pokud nen√≠ v aktu√°ln√≠ session a Price amount &gt;=0, pak
Corrective bill item ‚Äì credit,</p></li>
<li><p>a pokud nen√≠ v aktu√°ln√≠ session a Price amount &lt; 0, pak
Corrective bill item ‚Äì debit</p></li>
</ul></li>
<li><p>je Toll transaction type = Cancelling, pak Corrective bill item ‚Äì
credit</p></li>
<li><p>je Toll transaction type = ReRating a pokud Price amount &gt;=0,
pak Corrective bill item - debit, jinak Corrective bill item ‚Äì
credit</p></li>
</ul></li>
<li><p>Price amount = podle RTE.price amount</p></li>
<li><p>Price amount VAT = podle RTE.price amount VAT</p></li>
<li><p>Unit price = podle RTE.unit price</p></li>
<li><p>Unit price VAT = podle RTE.unit price VAT</p></li>
<li><p>Number of units = podle RTE.number of units</p></li>
<li><p>Metric unit = podle RTE.metric unit</p></li>
<li><p>Discount amount = podle RTE.discount amount</p></li>
<li><p>Discount amount VAT= podle RTE.discount amount VAT</p></li>
<li><p>Discount rate = podle RTE.discount rate</p></li>
<li><p>Tax rate = podle RTE.tax rate</p></li>
<li><p>Billing service = podle RTE.billing service</p></li>
</ul></li>
</ul>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-6">Alternativn√≠ postupy</h4>


<p>Nejsou</p>


<h4 id="chybov√©-postupy-6">Chybov√© postupy</h4>


<p>Pokud Syst√©m nena≈°el Bill session a nejde o opo≈ædenou nebo opƒõtovnƒõ
ocenƒõnou nebo ru≈°enou m√Ωtnou ud√°lost, Syst√©m <mark>zaloguje chybu
a</mark> nastav√≠ stav Toll transaction na Rejected.</p>


<h4 id="pozn√°mky-5">Pozn√°mky</h4>


<p>Nejsou</p>


<h3 id="vytvo≈ô-v√Ωzvy-na-√∫hradu-za-p≈ôestupky-sys.bar.0.13.hr">Vytvo≈ô
v√Ωzvy na √∫hradu za p≈ôestupky (SYS.BAR.0.13.HR)</h3>


<h4 id="c√≠l-7">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je vygenerov√°n√≠ v√Ωzev na √∫hradu za m√Ωtn√©
transakce, od jejich≈æ zprocesov√°n√≠ ubƒõhlo d√©le ne≈æ urƒçit√° doba.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-7">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>V pravideln√Ωch intervalech na z√°kladƒõ napl√°novan√© operace
BEm.OffenceRfP.</p>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-6">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Nejsou.</p>


<h4 id="norm√°ln√≠-postup-4">Norm√°ln√≠ postup</h4>


<p>Syst√©m vyhled√° p≈ôestupky, od jejich≈æ p≈ôepnut√≠ do stavu Offence ubƒõhlo
d√©le ne≈æ je ƒçasov√© obdob√≠ nakonfigurovan√© v¬†dan√©m konfiguraƒçn√≠m kl√≠ƒçi
(tj. (Unpaid Toll Transactions, kter√© jsou ve stavu Offence, kdy rozd√≠l
dn≈Ø mezi Sysdate a UTT.Offence time &gt;=
BE_DaysPriorOffencesRfPCreation).</p>


<p>Syst√©m seskup√≠ nalezen√© nezaplacen√© m√Ωtn√© transakce podle:</p>


<ul>
<li><p>Registration number,</p></li>
<li><p>Registration country,</p></li>
<li><p>Account (pokud je zn√°m, jinak null).</p></li>
</ul>


<p>V p≈ô√≠padƒõ, ≈æe je skupina UTT bez √∫ƒçtu (tj. pat≈ô√≠ neregistrovan√©mu
provozovateli vozidla; tj. Subject type = Not registered), nebo ≈æe je
skupina UTT s¬†√∫ƒçtem, ale pat≈ô√≠c√≠ anonymn√≠mu z√°kazn√≠ku (tj.
VCM.Customer.anonymous registration = true), Syst√©m se pokus√≠ z√≠skat
kontaktn√≠ adresu provozovatele vozidla z ve≈ôejn√Ωch rejst≈ô√≠k≈Ø na z√°kladƒõ
registraƒçn√≠ znaƒçky vozidla a zemƒõ registrace, za pou≈æit√≠ syst√©mov√©
funkce Z√≠skej data z¬†EUCARIS (SYS.TDP.9.1):</p>


<ul>
<li><p>V p≈ô√≠padƒõ, ≈æe nebyla nalezena ≈æ√°dn√° kontaktn√≠ adresa, Syst√©m
takov√©to nezaplacen√© m√Ωtn√© transakce odfiltruje a tento proces
generov√°n√≠ Offence RfP pro nƒõ, pro tento bƒõh, konƒç√≠.</p></li>
<li><p>V¬†p≈ô√≠padƒõ, ≈æe byla nalezena kontaktn√≠ adresa, Syst√©m ji pou≈æije
pro vygenerov√°n√≠ Offence RfP jako fakturaƒçn√≠ adresu.</p></li>
</ul>


<p>Syst√©m rozdƒõl√≠ seskupen√© UTT podle Bill isser a zjist√≠ poƒçet
p≈ôestupk≈Ø.</p>


<p>Syst√©m vygeneruje RfP (HR business naz√Ωv√° Formal Notice) pro ka≈ædou
skupinu Unpaid Toll Transactions (tj. pokud m√° √∫ƒçet vozidlo se 3
neuhrazen√Ωmi m√Ωtn√Ωmi transakcemi, z nich≈æ ka≈æd√° pat≈ô√≠ jin√©mu Bill
issuer, vygeneruj√≠ se 3 Offence RfPs ‚Äì jedno pro ka≈æd√©ho Bill issuer,
p≈ôiƒçem≈æ ka≈æd√© obsahuje odpov√≠daj√≠c√≠ UTT a odpov√≠daj√≠c√≠ administrativn√≠
poplatek):</p>


<ul>
<li><p>Syst√©m zjist√≠ BIBA na z√°kladƒõ Bill issuer a Reason =
Offence.</p></li>
<li><p>Syst√©m na√∫ƒçtuje administrativn√≠ poplatek za ka≈ædou nezaplacenou
m√Ωtnou transakci Bill issuera, za pou≈æit√≠ syst√©mov√© funkce u≈æit√≠ Na√∫ƒçtuj
jednor√°zov√Ω poplatek (SYS.BAR.0.7.HR).</p></li>
<li><p>Syst√©m seskup√≠ ocenƒõn√© ud√°losti za administrativn√≠ poplatek podle
atribut≈Ø Rated Service Events:</p>
<ul>
<li><p>Subject number (tj. Account nebo null),</p></li>
<li><p>Billing service,</p></li>
<li><p>Unit price VAT,</p></li>
<li><p>Unit price,</p></li>
<li><p>Tax rate,</p></li>
<li><p>Product type,</p></li>
<li><p>Basic unit price definition method,</p></li>
<li><p>Discount rate.</p></li>
</ul></li>
<li><p>A pro ka≈ædou kombinaci vytvo≈ô√≠ Bill Item s¬†parametry:</p>
<ul>
<li><p>Bill item category = Dunning fee</p></li>
<li><p>Bill item type = Regular bill item</p></li>
<li><p>Unit price = Unit price z¬†RSE</p></li>
<li><p>Unit price VAT = Unit price VAT z¬†RSE</p></li>
<li><p>Number of units = souƒçet z¬†Number of units RSE</p></li>
<li><p>Metric unit = Piece</p></li>
<li><p>Tax rate = Tax rate z¬†RSE</p></li>
<li><p>Price amount = ƒç√°stka poplatk≈Ø bez danƒõ, tj. souƒçet z¬†Price
amount z RSE</p></li>
<li><p>Price amount VAT = ƒç√°stka poplatk≈Ø s¬†dan√≠, tj. souƒçet z¬†Price
amount VAT z RSE</p></li>
<li><p>Billing service = Billing service z¬†RSE</p></li>
</ul></li>
<li><p>Syst√©m pro ka≈ædou skupinu Unpaid Toll Transactions a jejich Rated
Toll Events vytvo≈ô√≠ Bill Items:</p>
<ul>
<li><p>Syst√©m seskup√≠ ocenƒõn√© m√Ωtn√© ud√°losti podle:</p>
<ul>
<li><p>Subject number (tj. Account nebo null),</p></li>
<li><p>Billing service,</p></li>
<li><p>Unit price VAT,</p></li>
<li><p>Unit price,</p></li>
<li><p>Tax rate,</p></li>
<li><p>Discount rate,</p></li>
<li><p>Basic unit price definition method,</p></li>
<li><p>Charge type,</p></li>
</ul></li>
<li><p>Syst√©m pro ka≈ædou skupinu vytvo≈ô√≠ Bill item s¬†atributy:</p>
<ul>
<li><p>Bill item category = Toll event</p></li>
<li><p>Product type = Toll</p></li>
<li><p>Bill item type = Regular</p></li>
<li><p>Price amount = souƒçet seskupen√Ωch RTE.price amount</p></li>
<li><p>Price amount VAT = souƒçet seskupen√Ωch RTE.price amount
VAT</p></li>
<li><p>Unit price = podle RTE.unit price</p></li>
<li><p>Unit price VAT = podle RTE.unit price VAT</p></li>
<li><p>Number of units = souƒçet seskupen√Ωch RTE.number of units</p></li>
<li><p>Metric unit = podle RTE.metric unit</p></li>
<li><p>Discount amount = souƒçet seskupen√Ωch RTE.discount amount</p></li>
<li><p>Discount amount VAT= souƒçet seskupen√Ωch RTE.discount amount
VAT</p></li>
<li><p>Discount rate = podle RTE.discount rate</p></li>
<li><p>Tax rate = podle RTE.tax rate</p></li>
<li><p>Billing service = podle RTE.billing service</p></li>
</ul></li>
</ul></li>
</ul>


<p>Syst√©m vytvo≈ô√≠ vytvo≈ô√≠ Bill s¬†parametry:</p>


<ul>
<li><p>Bill number = Unik√°tn√≠ ƒç√≠slo faktury podle sch√©matu z ƒå√≠slov√°n√≠
faktur v z√°vislosti na Bill type, Bill issue type, Bill category a Bill
issuer.</p></li>
<li><p>Bill type = Request for payment (Offence RfP)</p></li>
<li><p>Bill issue type = Regular bill</p></li>
<li><p>Bill recurrence type = One-time bill</p></li>
<li><p>Bill category = Offence</p></li>
<li><p>Bill issue status = Issued</p></li>
<li><p>Bill payment status = Unpaid</p></li>
<li><p>Comment = null</p></li>
<li><p>Bill amount = souƒçet bill items.price amount VAT</p></li>
<li><p>Tax amount = null</p></li>
<li><p>Total amount = souƒçet bill items.price amount VAT</p></li>
<li><p>Date of issue = aktu√°ln√≠ datum</p></li>
<li><p>Due date = sysdate</p></li>
<li><p><mark>Date of beginning = aktu√°ln√≠ datum</mark></p></li>
<li><p><mark>Date of end = aktu√°ln√≠ datum</mark></p></li>
<li><p>Matched amount = 0</p></li>
<li><p>Subject type = Toll transaction.Subject type</p></li>
<li><p>Subject number = Toll transaction.Subject number</p></li>
<li><p>Bill issuer bank account = zji≈°tƒõn√° BIBA</p></li>
<li><p>Bill issuer = Toll transaction.Bill issuer</p></li>
</ul>


<p><mark>Syst√©m zjist√≠ jazyk faktury √öƒçtu (tj. ze Account.Preferred
document language nebo EETS Provider.Preferred document
language).</mark></p>


<p>Syst√©m, s¬†ohledem na <mark>zji≈°tƒõn√Ω preferovan√Ω jazyk,</mark>
vygeneruje dokument faktury v¬†pdf form√°tu V√Ωzva k¬†√∫hradƒõ za p≈ôestupky
(DOC.BE.22.HR), s vyu≈æit√≠m p≈ô√≠padu u≈æit√≠ Vytvo≈ô a ulo≈æ dokument
(SYS.DFRP.1.1).</p>


<p>Syst√©m updatuje na Bill.Bill document = identifik√°tor vygenerovan√©ho
PDF dokumentu faktury.</p>


<p>Syst√©m zmƒõn√≠ stav Unpaid Toll Transactions, kter√© byly zahrnuty do
Form√°ln√≠ho ozn√°men√≠, na ‚ÄûRfP generated‚Äú (nebudou se ji≈æ samostatnƒõ
zobrazovat na Offence port√°lu jako samostatn√© Offences.</p>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-7">Alternativn√≠ postupy</h4>


<p>Nejsou</p>


<h4 id="chybov√©-postupy-7">Chybov√© postupy</h4>


<p>Nejsou</p>


<h4 id="pozn√°mky-6">Pozn√°mky</h4>


<p>Nejsou</p>


<h3 id="vytvo≈ô-jednor√°zovou-fakturu-za-m√Ωto-sys.bar.0.14.hr">Vytvo≈ô
jednor√°zovou fakturu za m√Ωto (SYS.BAR.0.14.HR)</h3>


<h4 id="c√≠l-8">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je vygenerov√°n√≠ jednor√°zov√© faktury za
zaplacen√© P≈ôestupky nebo V√Ωzvy za zaplacen√≠ za p≈ôestupky.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-8">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>P≈ô√≠pad u≈æit√≠ je vlo≈æenou souƒç√°st√≠ p≈ô√≠pad≈Ø u≈æit√≠:</p>


<ul>
<li><p>Offence</p>
<ul>
<li><p>Uhraƒè p≈ôestupek (UC.BAR.0.20.HR)</p></li>
</ul></li>
</ul>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-7">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Je zn√°m v√Ωƒçet zaplacen√Ωch Toll Transactions, jejich Rated Toll Events
a p≈ô√≠padnƒõ v√Ωƒçet Request for Payments (a tud√≠≈æ v√Ωƒçet jejich zaplacen√Ωch
Toll Transactions a jejich Rated Toll Events).</p>


<p>Je zn√°m Account nebo Registraƒçn√≠ znaƒçka vozidla, p≈ô√≠padnƒõ POS a
informace o platbƒõ.</p>


<h4 id="norm√°ln√≠-postup-5">Norm√°ln√≠ postup</h4>


<p>Syst√©m zjist√≠ BIBA na z√°kladƒõ Bill issuer a Reason = Offence.</p>


<p>Syst√©m dohled√° Rated Toll Events zaplacen√Ωch Toll Transactions a Toll
Transactions ze zaplacen√Ωch Offence RfPs:</p>


<ul>
<li><p>Syst√©m vytvo≈ô√≠ kopie Rated Toll Events z Offence RfPs a vypln√≠ na
nich referenci na p≈Øvodni RTE.</p></li>
<li><p>Syst√©m na p≈Øvodn√≠ch Rated Toll Events nastav√≠ p≈ô√≠znak Replaced =
true, aby bylo z≈ôejm√© ≈æe jejich vazba na Toll Transaction je ji≈æ
neplatn√°.</p></li>
<li><p>Syst√©m seskup√≠ dohledan√© ocenƒõn√© m√Ωtn√© ud√°losti ze zaplacen√Ωch TT
a zkop√≠rovan√© ocenƒõn√© m√Ωtn√© ud√°losti podle:</p>
<ul>
<li><p>Subject number (tj. Account nebo null),</p></li>
<li><p>Billing service,</p></li>
<li><p>Unit price VAT,</p></li>
<li><p>Unit price,</p></li>
<li><p>Tax rate,</p></li>
<li><p>Discount rate,</p></li>
<li><p>Basic unit price definition method,</p></li>
<li><p>Charge type.</p></li>
</ul></li>
<li><p>Syst√©m pro ka≈ædou skupinu vytvo≈ô√≠ Bill item s¬†atributy:</p>
<ul>
<li><p>Bill item category = Toll event</p></li>
<li><p>Product type = Toll</p></li>
<li><p>Bill item type = Regular</p></li>
<li><p>Price amount = souƒçet seskupen√Ωch RTE.price amount</p></li>
<li><p>Price amount VAT = souƒçet seskupen√Ωch RTE.price amount
VAT</p></li>
<li><p>Unit price = podle RTE.unit price</p></li>
<li><p>Unit price VAT = podle RTE.unit price VAT</p></li>
<li><p>Number of units = souƒçet seskupen√Ωch RTE.number of units</p></li>
<li><p>Metric unit = podle RTE.metric unit</p></li>
<li><p>Discount amount = souƒçet seskupen√Ωch RTE.discount amount</p></li>
<li><p>Discount amount VAT= souƒçet seskupen√Ωch RTE.discount amount
VAT</p></li>
<li><p>Discount rate = podle RTE.discount rate</p></li>
<li><p>Tax rate = podle RTE.tax rate</p></li>
<li><p>Billing service = podle RTE.billing service</p></li>
<li><p><mark>Card number = maskovan√© ƒç√≠slo platebn√≠ karty pou≈æit√© pro
platbu (pokud je na vstupu)</mark></p></li>
</ul></li>
</ul>


<p>Pokud jde o zaplacen√≠ Offence RfPs s¬†na√∫ƒçtovan√Ωmi administrativn√≠mi
poplatky:</p>


<ul>
<li><p>Syst√©m zkop√≠ruje Rated Service Events z Offence RfPs a vypln√≠ na
nov√Ωch RSE referenci na p≈Øvodni RSE.</p></li>
<li><p>Syst√©m seskup√≠ ocenƒõn√© ud√°losti podle:</p>
<ul>
<li><p>Subject number (tj. Account nebo null),</p></li>
<li><p>Billing service,</p></li>
<li><p>Unit price VAT,</p></li>
<li><p>Unit price,</p></li>
<li><p>Tax rate,</p></li>
<li><p>Product type,</p></li>
<li><p>Basic unit price definition method,</p></li>
<li><p>Discount rate,</p></li>
</ul></li>
<li><p>Syst√©m pro ka≈ædou skupinu vytvo≈ô√≠ Bill item s¬†atributy:</p>
<ul>
<li><p>Bill item category = Dunning fee.</p></li>
<li><p>Product type = podle RSE</p></li>
<li><p>Bill item type = Regular</p></li>
<li><p>Price amount = souƒçet seskupen√Ωch RSE.price amount</p></li>
<li><p>Price amount VAT = souƒçet seskupen√Ωch RSE.price amount
VAT</p></li>
<li><p>Unit price = podle RSE.unit price</p></li>
<li><p>Unit price VAT = podle RSE.unit price VAT</p></li>
<li><p>Number of units = souƒçet seskupen√Ωch RSE.number of units</p></li>
<li><p>Metric unit = podle RSE.metric unit</p></li>
<li><p>Discount amount = souƒçet seskupen√Ωch RSE.discount amount</p></li>
<li><p>Discount amount VAT= souƒçet seskupen√Ωch RSE.discount amount
VAT</p></li>
<li><p>Discount rate = podle RSE.discount rate</p></li>
<li><p>Tax rate = podle RSE.tax rate</p></li>
<li><p>Billing service = podle RSE.billing service</p></li>
<li><p><mark>Card number = maskovan√© ƒç√≠slo platebn√≠ karty pou≈æit√© pro
platbu (pokud je na vstupu)</mark></p></li>
</ul></li>
</ul>


<p>Syst√©m pro ka≈ædou tax rate vytvo≈ô√≠ tax bill item:</p>


<ul>
<li><p>Bill item category = Tax</p></li>
<li><p>Bill item type = Regular bill item</p></li>
<li><p>Number of units = null</p></li>
<li><p>Metric unit = null</p></li>
<li><p>Tax rate = sazba danƒõ (v procentech)</p></li>
<li><p><mark>Price amount = celkov√° da≈à za bill itemy s¬†danou tax rate
(Tax base * Tax rate a zaokrouhlen√≠ na dvƒõ desetinn√°
m√≠sta)</mark></p></li>
<li><p><mark>Tax base = celkov√° ƒç√°stka bez danƒõ s¬†danou tax rate (suma
Price amount p≈ô√≠slu≈°n√Ωch neda≈àov√Ωch bill items a zaokrouhlen√≠ na dvƒõ
desetinn√° m√≠sta)</mark></p></li>
</ul>


<p>Syst√©m zjist√≠ pro ka≈ædou sazbu danƒõ, zda nen√≠ pot≈ôeba Rounding
adjustment:</p>


<ul>
<li><p>Pokud rozd√≠l, da≈àov√© bill item.tax base a absolutn√≠ hodnoty
souƒçtu neda≈àov√Ωch bill item.price amount, nen√≠ roven nule, Rounding
adjustment bill iem se vytvo≈ô√≠ s¬†v√Ωsledkem rozd√≠lu jako bill item.price
amount</p></li>
<li><p>Pokud rozd√≠l, (souƒçtu da≈àov√© bill item.tax base a da≈àov√© bill
item.price amount) a souƒçtu neda≈àov√Ωch bill item.price amount VAT, nen√≠
roven nule, Rounding adjustment bill iem se vytvo≈ô√≠, s¬†v√Ωsledkem rozd√≠lu
jako bill item.price amount VAT</p>
<ul>
<li><p>Syst√©m vytvo≈ô√≠ korekƒçn√≠ bill item s¬†parametry:</p>
<ul>
<li><p>Bill item category = Rounding adjustment</p></li>
<li><p>Product type = null</p></li>
<li><p>Bill item type =</p>
<ul>
<li><p>pokud vypoƒçten√Ω rozd√≠l je vƒõt≈°√≠ ne≈æ 0, pak Corrective bill item ‚Äì
credit,</p></li>
<li><p>jinak Corrective bill item ‚Äì debit</p></li>
</ul></li>
<li><p>Basic unit price = absolutn√≠ hodnota vypoƒçten√©ho rozd√≠lu</p></li>
<li><p>Basic unit price definition method = None</p></li>
<li><p>Unit price = Price amount</p></li>
<li><p>Unit price VAT = Price amount VAT</p></li>
<li><p>Number of units = 1</p></li>
<li><p>Metric unit = Piece</p></li>
<li><p>Tax rate = null</p></li>
<li><p>Price amount = podle v√Ωsledku v√Ωpoƒçtu, buƒè absolutn√≠ hodnota
rozd√≠lu, jinak null</p></li>
<li><p>Price amount VAT = podle v√Ωsledku v√Ωpoƒçtu, buƒè absolutn√≠ hodnota
rozd√≠lu, jinak null</p></li>
<li><p>Billing service = Syst√©m zjist√≠ billing service z PCRE na z√°kladƒõ
Billing service.abbreviation = ADJ-ROUNDING</p></li>
</ul></li>
</ul></li>
</ul>


<p>V p≈ô√≠padƒõ, ≈æe se jedn√° o zaplacen√≠ skupiny UTT nebo Offence RfP,
kter√© v≈°echny jsou bez √∫ƒçtu (tj. pat≈ô√≠ neregistrovan√©mu provozovateli
vozidla; tj. Subject type = Not registered), nebo pat≈ô√≠c√≠ anonymn√≠mu
z√°kazn√≠ku (tj. VCM.Customer.anonymous registration = true), Syst√©m se
pokus√≠ z√≠skat kontaktn√≠ adresu provozovatele vozidla z ve≈ôejn√Ωch
rejst≈ô√≠k≈Ø na z√°kladƒõ registraƒçn√≠ znaƒçky vozidla a zemƒõ registrace, za
pou≈æit√≠ syst√©mov√© funkce Z√≠skej data z¬†EUCARIS (SYS.TDP.9.1):</p>


<ul>
<li><p>Pokud se poda≈ôily kontaktn√≠ √∫daje z√≠skat, pou≈æij√≠ se pro
generov√°n√≠ dokumentu faktury.</p></li>
<li><p>Pokud se nepoda≈ôily z√≠skat, Syst√©m vygeneruje zjednodu≈°enou
fakturu bez kontaktn√≠ch √∫daj≈Ø.</p></li>
</ul>


<p>Syst√©m vytvo≈ô√≠ vytvo≈ô√≠ Bill s¬†parametry:</p>


<ul>
<li><p>Bill number = Unik√°tn√≠ ƒç√≠slo faktury podle sch√©matu z ƒå√≠slov√°n√≠
faktur v z√°vislosti na Bill type, Bill issue type, Bill category a Bill
issuer.</p></li>
<li><p>Fiscal verification number = vygeneruje se Fisk√°ln√≠ verifikaƒçn√≠
ƒç√≠slo ze sekvence pro ƒç√≠slov√°n√≠ faktur (BNF77) s Business Premises BO,
urƒçen√Ωm podle user profile</p></li>
<li><p>ZKI = vypln√≠ se Ochrann√Ω k√≥d vystavitele faktury (Issuer's
Protection Code)</p></li>
<li><p>Bill type = Customer bill</p></li>
<li><p>Bill issue type =</p>
<ul>
<li><p>Regular bill, pokud je zn√°ma adresa pro fakturaci</p></li>
<li><p><mark>jinak Simplified bill</mark></p></li>
</ul></li>
<li><p>Bill recurrence type = One-time bill</p></li>
<li><p>Bill category =</p>
<ul>
<li><p>Offence, pokud faktura obsahuje RTE a RSE,</p></li>
<li><p>jinak Toll</p></li>
</ul></li>
<li><p>Bill issue status = Issued</p></li>
<li><p>Bill payment status = Unpaid</p></li>
<li><p>Comment = null</p></li>
<li><p>Bill amount = souƒçet da≈àov√Ωch bill items.tax base</p></li>
<li><p>Tax amount = souƒçet da≈àov√Ωch bill items.price amount</p></li>
<li><p>Total amount = souƒçet Bill amount a Tax amount (mƒõlo by se rovnat
souƒçtu plateb, pou≈æit√Ωch na √∫hradu)</p></li>
<li><p>Date of issue = aktu√°ln√≠ datum</p></li>
<li><p>Due date = sysdate</p></li>
<li><p><mark>Date of beginning = aktu√°ln√≠ datum</mark></p></li>
<li><p><mark>Date of end = aktu√°ln√≠ datum</mark></p></li>
<li><p>Matched amount = 0</p></li>
<li><p>Subject type = Toll transaction.Subject type (pokud alespo≈à jedno
TT m√° subject type Account, pou≈æije se jako subject faktury)</p></li>
<li><p>Subject number = Toll transaction.Subject number (pokud alespo≈à
jedno TT m√° subject type Account, pou≈æije se jako subject
faktury)</p></li>
<li><p>Bill issuer bank account = zji≈°tƒõn√° BIBA</p></li>
<li><p>Bill issuer = Toll transaction.Bill issuer</p></li>
</ul>


<p>Pokud jde o zaplacen√≠ RfPs</p>


<p>:</p>


<p>Syst√©m p≈ôenastav√≠ na zaplacen√Ωch V√Ωzv√°ch na √∫hradu:</p>


<ul>
<li><p>Bill issue status = Replaced</p></li>
<li><p>Replaced by bill = reference na novou fakturu.</p></li>
</ul>


<p>Syst√©m informace o faktu≈ôe v¬†XML form√°tu ode≈°le do ePorezna na
fiskalizaci (Rozhran√≠ ePorezna (fiskalizace) (INT.BAR.31.HR).¬†</p>


<p>Syst√©m prop√≠≈°e Unique Invoice Identifier (JIR) z ePorezna odpovƒõdi do
Bill.JIR atributu.</p>


<p><mark>Syst√©m zjist√≠ jazyk faktury √öƒçtu nebo Poskytovatele EETS (tj.
ze Account.Preferred document language nebo EETS Provider.Preferred
document language).</mark></p>


<p>Pokud se p≈ô√≠pad u≈æit√≠ spustil na POS (MEV, Kiosk, POS), Syst√©m
zjist√≠, zda se m√° dokument generovat ve variantƒõ (DOC.BE.x) v¬†p≈ô√≠padƒõ A4
form√°tu nebo (DOC.BE.x<strong>B</strong>) v¬†p≈ô√≠padƒõ thermo tisku na POS
(podle POS.Printer type).</p>


<p>Syst√©m, s¬†ohledem na <mark>zji≈°tƒõn√Ω preferovan√Ω jazyk,</mark> na
zji≈°tƒõnou variantu dokumentu, vygeneruje dokument faktury v¬†pdf form√°tu
Faktura za m√Ωtn√© (DOC.BE.10.HR) v¬†p≈ô√≠padƒõ A4 form√°tu nebo
(DOC.BE.10B.HR) v¬†p≈ô√≠padƒõ thermo tisku, s vyu≈æit√≠m p≈ô√≠padu u≈æit√≠ Vytvo≈ô
a ulo≈æ dokument (SYS.DFRP.1.1).</p>


<p>Syst√©m zjist√≠, zda se m√° faktura vygenerovat tak√© v xml form√°tu jako
elektronick√° faktura (tj. pokud CM.Account.Preferred electronic invoice
format = FINA).</p>


<p>V p≈ô√≠padƒõ po≈æadovan√©ho XML form√°tu, Syst√©m nav√≠c vygeneruje eFakturu
(DOC.BE.21.HR). Syst√©m dokument ulo≈æ√≠ s vyu≈æit√≠m p≈ô√≠padu u≈æit√≠ Ulo≈æ
extern√≠ dokument (SYS.DFRP.1.4).</p>


<p>Syst√©m updatuje na Bill.Bill document = identifik√°tor vygenerovan√©ho
PDF dokumentu faktury.</p>


<p>Syst√©m p≈ô√≠padnƒõ updatuje Bill.E-Bill document = identifik√°tor
vytvo≈ôen√©ho XML dokumentu faktury.</p>


<p>Pokud vygenerov√°n√≠ faktury probƒõhlo na POS (MEV, Kiosk, POS), Syst√©m
pdf dokument nab√≠dne ke sta≈æen√≠.</p>


<p>Syst√©m ode≈°le pdf a p≈ô√≠padnƒõ XML verzi faktury na z√°kazn√≠k≈Øv email
spoleƒçnƒõ s¬† notifikac√≠ Ozn√°men√≠ o vystaven√≠ faktury (NTF.BAR.21.HR).</p>


<p>Syst√©m p≈ô√≠padnƒõ ode≈°le XML verzi faktury p≈ôes eFINA p≈ôes Rozhran√≠
eFINA (elektronick√° faktura) (INT.BAR.32.HR).</p>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-8">Alternativn√≠ postupy</h4>


<p>Nejsou</p>


<h4 id="chybov√©-postupy-8">Chybov√© postupy</h4>


<p>Nejsou</p>


<h4 id="pozn√°mky-7">Pozn√°mky</h4>


<p>Nejsou</p>


<h2 id="zpracov√°n√≠-m√Ωtn√Ωch-transakc√≠">Zpracov√°n√≠ m√Ωtn√Ωch transakc√≠</h2>


<h3 id="ulo≈æ-ocenƒõnou-m√Ωtnou-transakci-sys.bar.1.8.hr">Ulo≈æ ocenƒõnou
m√Ωtnou transakci (SYS.BAR.1.8.HR) </h3>


<h4 id="c√≠l-9">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je pro ocenƒõn√Ω pr≈Øjezd m√Ωtnou trasou
vytvo≈ôit m√Ωtnou transakci (unpaid Toll Transaction nebo Toll
Transaction), odpov√≠daj√≠c√≠ ocenƒõnou m√Ωtnou ud√°lost (Rated toll event) a
p≈ô√≠padnƒõ je zagregovat do Bill session.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-9">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>P≈ô√≠pad u≈æit√≠ je vlo≈æenou souƒç√°st√≠ n√°sleduj√≠c√≠ch p≈ô√≠pad≈Ø u≈æit√≠:</p>


<ul>
<li><p>Ode≈°li ocenƒõnou m√Ωtnou transakci (SYS.VTP.2.5)</p></li>
</ul>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-8">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Toll Trip Record byl ocenƒõn.</p>


<p>Pro ocenƒõn√Ω Toll Trip Record s Registration type &lt;&gt; Not
registered, v≈ædy na vstupu bude buƒè identifikace VCM.Account nebo
ECM.EETS Provider nebo VCM.Exemption partner <mark>nebo VCM.Fleet card
issuer</mark>.</p>


<p>Pozn√°mka: U Toll Trip Record s¬†Exempted trip registration type, bude
na vstupu buƒè jedna transakce nebo dvƒõ transakce, pokud byla zji≈°tƒõna
jin√° kategorie vozidla ne≈æ na kterou se vztahuje osvobozen√≠. V¬†p≈ô√≠padƒõ
dvou transakc√≠, obƒõ budou odkazovat na jeden VTP.Toll Trip Record:</p>


<ul>
<li><p>v≈ædy se po≈°le na ulo≈æen√≠ transakce s¬†Exempted trip registration
type,</p></li>
<li><p>p≈ô√≠padnƒõ tak√© transakce s¬†registration type urƒçenou podle vozidla
(tj. EETS, Pre-paid, Post-paid invoice, Post-paid card, Not registered)
na ƒç√°stku nad r√°mec ƒç√°stky osvobozen√©ho pr≈Øjezdu.</p></li>
</ul>


<h4 id="popis-3">Popis</h4>


<p>Pre-paid registration type</p>


<p>U Toll Trip Record s¬†Pre-paid registration type, v≈ædy na vstupu bude
informace (Toll Trip Record.is covered by Pre-paid balance), zda byla
celkov√° ƒç√°stka za pr≈Øjezd str≈æena z¬†Pre-paid balance nebo bylo zji≈°tƒõno,
≈æe z≈Østatek nen√≠ dostateƒçn√Ω.</p>


<p>Pokud byla celkov√° ƒç√°stka za pr≈Øjezd str≈æena z¬†Pre-paid balance (tj.
Toll Trip Record.is covered by Pre-paid balance = true), Syst√©m vytvo≈ô√≠
Toll transaction a odpov√≠daj√≠c√≠ Rated toll event a postup konƒç√≠.</p>


<p>Pokud nebyla celkov√° ƒç√°stka za pr≈Øjezd str≈æena z¬†Pre-paid balance,
proto≈æe z≈Østatek nebyl dostateƒçn√Ω (tj. Toll Trip Record.is covered by
Pre-paid balance =false),</p>


<ul>
<li><p>Syst√©m vytvo≈ô√≠ Unpaid Toll Transaction ve stavu Offence a
odpov√≠daj√≠c√≠ Rated Toll Event.</p></li>
<li><p>Syst√©m informuje z√°kazn√≠ka o ne√∫spƒõ≈°n√©m zaplacen√≠ m√Ωtn√© transakce
pomoc√≠ notifikace (<strong>NTF.</strong>BAR<strong>.</strong>13.HR nebo
<strong>NTF.</strong>BAR<strong>.</strong>14.HR) a postup
konƒç√≠.</p></li>
<li><p>Syst√©m p≈ôid√° vozidlo na Alert list</p></li>
<li><p><mark>Agregace/DI to ERP?</mark></p></li>
</ul>


<p>Post-paid card registration type</p>


<p>Syst√©m vytvo≈ô√≠ Unpaid Toll Transaction ve stavu Ready for processing,
odpov√≠daj√≠c√≠ Rated Toll Event a odpov√≠daj√≠c√≠ Card Payment Request, a
postup konƒç√≠.</p>


<p>Pozn√°mka: N√°slednƒõ proces pokraƒçuje zaplacen√≠m m√Ωtn√© transakce za
u≈æit√≠ syst√©mov√© funkce Zapla≈• m√Ωtnou transakci (SYS.BAR.1.10.HR)</p>


<p>Post-paid invoice registration type</p>


<p>Syst√©m vytvo≈ô√≠ Toll transaction a odpov√≠daj√≠c√≠ Rated toll event.</p>


<p>Syst√©m zagreguje Rated toll event do Bill session pro Post-paid, kdy
Bill bude s Bill payment status = Unpaid za pou≈æit√≠ syst√©mov√© funkce
Zagreguj ocenƒõn√© ud√°losti do fakturaƒçn√≠ d√°vky (SYS.BAR.0.12.HR) a postup
konƒç√≠.</p>


<p>EETS registration type</p>


<p>Syst√©m vytvo≈ô√≠ Toll transaction a odpov√≠daj√≠c√≠ Rated toll event.</p>


<p>Syst√©m zagreguje Rated toll event do Bill session pro EETS za pou≈æit√≠
syst√©mov√© funkce Zagreguj ocenƒõn√© ud√°losti do fakturaƒçn√≠ d√°vky
(SYS.BAR.0.12.HR) a postup konƒç√≠.</p>


<p>Pozn√°mka: N√°slednƒõ proces pokraƒçuje vytvo≈ôen√≠m Billing details za
u≈æit√≠ syst√©mov√© funkce Vytvo≈ô billing details (SYS.BAR.1.9.HR).</p>


<p>Not registered registration type</p>


<p>Syst√©m vytvo≈ô√≠ Unpaid Toll Transaction ve stavu Offence a
odpov√≠daj√≠c√≠ Rated Toll Event a postup konƒç√≠.</p>


<p>Exempted registration type</p>


<p>Syst√©m vytvo≈ô√≠ Toll transaction a odpov√≠daj√≠c√≠ Rated toll event.</p>


<p>Syst√©m zagreguje Ratel toll event do Bill session pro Exemption
partner se subjektem = Exemption partner odpov√≠daj√≠c√≠ dan√© kategorii
osvobozen√≠ za pou≈æit√≠ syst√©mov√© funkce Zagreguj ocenƒõn√© ud√°losti do
fakturaƒçn√≠ d√°vky (SYS.BAR.0.12.HR).</p>


<p>Pozn√°mka 1: Pokud ≈æ√°dn√Ω VCM.Exemption partner nebude definov√°n pro
dan√© osvobozen√≠, pak nikdo osvobozen√≠ nebude kompenzovat a takov√©to
ocenƒõn√© Toll TripRecords se do BAR ani nepo≈°lou.</p>


<p>Pozn√°mka 2: Subjektem Toll Transaction bude Exemption partner, ale
bude vyplnƒõna reference na Vehicle nebo EETS Vehicle, aby bylo z≈ôejm√©,
kdo m√Ωtnou trasu projel.</p>


<p>Exempted <strong>trip</strong> registration type</p>


<p>Syst√©m vytvo≈ô√≠ Toll Transaction a odpov√≠daj√≠c√≠ Rated Toll Event.</p>


<p>System zagreguje Rated Toll Event do Bill session pro Exemption
partner se subjektem = Exemption partner odpov√≠daj√≠c√≠ dan√© kategorii
osvobozen√≠ za pou≈æit√≠ syst√©mov√© funkce Zagreguj ocenƒõn√© ud√°losti do
fakturaƒçn√≠ d√°vky (SYS.BAR.0.12.HR) a postup konƒç√≠.</p>


<p>Pozn√°mka: Subjektem Toll Transaction bude Exemption partner, ale bude
vyplnƒõna reference na Vehicle nebo EETS Vehicle, aby bylo z≈ôejm√©, kdo
m√Ωtnou trasu projel.</p>


<ul>
<li></li>
</ul>


<p><mark>Exempted not compliant registration type</mark></p>


<p><mark>Syst√©m vytvo≈ô√≠ Toll transaction a odpov√≠daj√≠c√≠ Rated toll
event.</mark></p>


<p><mark>Syst√©m zagreguje Ratel toll event do Bill session pro Exemption
partner se subjektem = Exemption partner odpov√≠daj√≠c√≠ dan√© kategorii
osvobozen√≠, nebo do Bill session pro Post-paid se subjektem = Account
(tj.</mark> <mark>podle p≈ô√≠slu≈°nosti vozidla) za pou≈æit√≠ syst√©mov√©
funkce Zagreguj ocenƒõn√© ud√°losti do fakturaƒçn√≠ d√°vky
(SYS.BAR.0.12.HR).</mark></p>


<p><mark>Pozn√°mka: Subjektem Toll Transaction bude Exemption partner,
ale bude vyplnƒõna reference na Vehicle nebo EETS Vehicle, aby bylo
z≈ôejm√©, kdo m√Ωtnou trasu projel.</mark></p>


<ul>
<li></li>
</ul>


<p>-----------------------------------------------------------------------------------------------------------------------</p>


<p>Vytvo≈ôen√≠ Unpaid Toll Transaction a Rated Toll Event,</p>


<p>pokud jde o Registration type = Post-paid card, Pre-paid (v p≈ô√≠padƒõ
nedostateƒçn√©ho z≈Østatku) nebo Not registered:</p>


<p>Syst√©m na z√°kladƒõ √∫daj≈Ø ze vstupu vytvo≈ô√≠ Unpaid Toll
Transaction:</p>


<ul>
<li><p>Toll transaction type = ze vstupu</p>
<ul>
<li><p>0 = Rating (send)</p></li>
<li><p><mark>1 = Cancelling (revoke)</mark></p></li>
<li><p><mark>3 = Rerating (adjust)</mark></p></li>
</ul></li>
<li><p>Unpaid toll transaction status =</p>
<ul>
<li><p>Ready for processing, v¬†p≈ô√≠padƒõ ≈æe jde o Post-paid card
registration type</p></li>
<li><p>Offence, v¬†p≈ô√≠padƒõ ≈æe jde o Pre-paid bez dostateƒçn√©ho z≈Østatku,
nebo Not registered registration type</p></li>
</ul></li>
<li><p>Vehicle category = ze vstupu</p></li>
<li><p>Emission class = ze vstupu</p></li>
<li><p>Emission class CO2= ze vstupu</p></li>
<li><p>Registration number = ze vstupu</p></li>
<li><p>Registration country = ze vstupu</p></li>
<li><p>OBU serial number = ze vstupu</p></li>
<li><p>OBU assignment status = ze vstupu</p></li>
<li><p>Event time = ze vstupu</p></li>
<li><p>Offence time = sysdate time pokud status je Offence, jinak
null</p></li>
<li><p>Creation time = sysdate time</p></li>
<li><p>Agregation time = null</p></li>
<li><p>Discount applied = pokud Unpaid toll transaction status =
Offence, pak false, jinak true.</p></li>
<li><p>Transaction amount = suma (Rated Toll Event.Price
amount)</p></li>
<li><p>Transaction amount VAT = suma (Rated Toll Event.Price amount
VAT)</p></li>
<li><p>Transaction discount amount =</p>
<ul>
<li><p>pokud Discount applied = false a alespo≈à jeden Rated toll
event.Discount rate &lt;&gt;0, pak 0, jinak null.</p></li>
<li><p>pokud Discount applied = true, je to souƒçet slev (tj. suma (Rated
Toll Event.Discount amount))</p></li>
</ul></li>
<li><p>Transaction discount amount VAT =</p>
<ul>
<li><p>pokud Discount applied = false a alespo≈à jeden Rated toll
event.Discount rate &lt;&gt;0, pak 0, jinak null.</p></li>
<li><p>pokud Discount applied = true, je to souƒçet slev s dan√≠ (tj. suma
(Rated Toll Event.Discount amount VAT))</p></li>
</ul></li>
<li><p>Transaction discount rate = Rated Toll Event.Discount rate (z
prvn√≠ RTE)</p></li>
<li><p>Vehicle = ze vstupu</p></li>
<li><p>EETS vehicle = ze vstupu</p></li>
<li><p>Subject type = ze vstupu</p></li>
<li><p>Subject number = ze vstupu</p></li>
<li><p>Original toll transaction = ze vstupu</p></li>
<li><p>Cancelled = false</p></li>
<li><p>Registration type = ze vstupu</p>
<ul>
<li><p>Post-paid card</p></li>
<li><p>Pre-paid (v¬†p≈ô√≠padƒõ nedostateƒçn√©ho z≈Østatku)</p></li>
<li><p>Not registered</p></li>
</ul></li>
<li><p>Toll trip record = ze vstupu</p></li>
<li><p>Toll trip = ze vstupu</p></li>
<li><p>Bill issuer = ze vstupu (tj. System operator)</p></li>
</ul>


<p>Syst√©m pro ka≈ædou ocenƒõnou slo≈æku m√Ωta ud√°losti zpoplatnƒõn√≠ vytvo≈ô√≠
Rated toll event:</p>


<ul>
<li><p>Charge type = ze vstupu</p></li>
<li><p>Basic unit price = ze vstupu</p></li>
<li><p>Basic unit price definition method = ze vstupu</p></li>
<li><p>Unit price = ze vstupu</p></li>
<li><p>Unit price VAT = ze vstupu</p></li>
<li><p>Number of units = ze vstupu</p></li>
<li><p>Metric unit = ze vstupu</p></li>
<li><p>Price amount =</p>
<ul>
<li><p>pokud Discount applied = false, pak Price amount ze
vstupu,</p></li>
<li><p>jinak Price amount ze vstupu ‚Äì Discount amount</p></li>
</ul></li>
<li><p>Price amount VAT =</p>
<ul>
<li><p>pokud Discount applied = false, pak Price amount VAT ze
vstupu,</p></li>
<li><p>jinak Price amount VAT ze vstupu ‚Äì Discount amount VAT</p></li>
</ul></li>
<li><p>Tax rate = ze vstupu</p></li>
<li><p>Discount amount = ze vstupu</p></li>
<li><p>Discount amount VAT = ze vstupu</p></li>
<li><p>Discount rate = ze vstupu</p></li>
<li><p>Billing service = ze vstupu</p></li>
<li><p>Unpaid toll transaction = reference na Unpaid Toll
Transaction</p></li>
</ul>


<p>Vytvo≈ôen√≠ Card Payment Request,</p>


<p>pokud jde o Registration type = Post-paid card:</p>


<p>Syst√©m vytvo≈ô√≠ Card Payment request:</p>


<ul>
<li><p>Attempt count = 0</p></li>
<li><p>Created on = aktu√°ln√≠ datum a ƒças</p></li>
<li><p>Process on = budouc√≠ datum a ƒças, kdy se m√° z√°znam
zprocesovat</p></li>
<li><p>Unpaid toll transaction = reference na novƒõ vytvo≈ôen√Ω Unpaid toll
transaction</p></li>
</ul>


<p>Vytvo≈ôen√≠ a odesl√°n√≠ notifikace,</p>


<p>pokud jde o Registration type = Pre-paid v p≈ô√≠padƒõ nedostateƒçn√©ho
z≈Østatku.</p>


<p>Syst√©m zjist√≠ zda existuje vyplnƒõn√Ω kontakt (na VT Vehicle, pokud tam
nen√≠ tak na VT Account, pokud tam neni tak na VT Customer). Pokud je
vyplnƒõn:</p>


<ul>
<li><p>E-mail address, Syst√©m vygeneruje emailovou notifikaci
(NTF.BAR.13.HR) a ode≈°le ji.</p></li>
<li><p><mark>Phone number, Syst√©m vygeneruje SMS notifikaci
(NTF.BAR.14.HR) a ode≈°le ji.</mark></p></li>
</ul>


<p>P≈ôid√°n√≠ na Alert list,</p>


<p>pokud jde o Registration type = Pre-paid v p≈ô√≠padƒõ nedostateƒçn√©ho
z≈Østatku (tj. jakmile se UTT p≈ôenastav√≠ do stavu Offence).</p>


<p>Syst√©m na z√°kladƒõ nezaplacen√© m√Ωtn√© transakce vytvo≈ô√≠ nebo updatuje
z√°znam na Alert listu pro dan√© SPZ, nav√Ω≈°√≠ Total due amount o celkovou
nezaplacenou ƒç√°stku transakce a Offence count nav√Ω≈°√≠ o 1 p≈ôestupek, za
pou≈æit√≠ syst√©mov√© funkce Zaeviduj Offence na Alert list
(SYS.TDP.5.6):</p>


<ul>
<li><p>UTT.Registration number a UTT.Registration country</p></li>
<li><p>Bill.Bill issuer</p></li>
<li><p>Unpaid toll transaction.Transaction amount VAT</p></li>
<li><p>1 (tj. nav√Ω≈°√≠ poƒçet p≈ôestupk≈Ø +1)</p></li>
</ul>


<p>Vytvo≈ôen√≠ Toll Transaction a Rated Toll Event,</p>


<p>pokud jde o Registration type = EETS, Exempted, <mark>Exempted not
compliant,</mark> Exempted trip, Post-paid invoice nebo Pre-paid
s¬†dostateƒçn√Ωm z≈Østatkem:</p>


<p>Syst√©m na z√°kladƒõ √∫daj≈Ø ze vstupu vytvo≈ô√≠ Toll Transaction:</p>


<ul>
<li><p>Toll transaction type = ze vstupu</p>
<ul>
<li><p>0 = Rating (send)</p></li>
<li><p><mark>1 = Cancelling (revoke)</mark></p></li>
<li><p><mark>3 = Rerating (adjust)</mark></p></li>
</ul></li>
<li><p>Toll transaction status = Processed</p></li>
<li><p>Vehicle category = ze vstupu</p></li>
<li><p>Emission class = ze vstupu</p></li>
<li><p>Emission class CO2= ze vstupu</p></li>
<li><p>Registration number = ze vstupu</p></li>
<li><p>Registration country = ze vstupu</p></li>
<li><p>OBU serial number = ze vstupu</p></li>
<li><p>OBU assignment status = ze vstupu</p></li>
<li><p>Event time = ze vstupu</p></li>
<li><p>Creation time = sysdate time</p></li>
<li><p>Agregation time = null</p></li>
<li><p>Unpaid toll transaction creation time = null</p></li>
<li><p>Discount applied = true</p></li>
<li><p>Transaction amount = suma (Rated Toll Event.Price
amount)</p></li>
<li><p>Transaction amount VAT = suma (Rated Toll Event.Price amount
VAT)</p></li>
<li><p>Transaction discount amount = suma (Rated Toll Event.Discount
amount)</p></li>
<li><p>Transaction discount amount VAT = suma (Rated Toll Event.Discount
amount VAT)</p></li>
<li><p>Transaction discount rate = Rated Toll Event.Discount rate (z
prvn√≠ RTE)</p></li>
<li><p>Vehicle = ze vstupu</p></li>
<li><p>EETS vehicle = ze vstupu</p></li>
<li><p>Subject type = ze vstupu</p></li>
<li><p>Subject number = ze vstupu</p></li>
<li><p>Original toll transaction = ze vstupu</p></li>
<li><p>Cancelled = false</p></li>
<li><p>Registration type = ze vstupu</p>
<ul>
<li><p>EETS</p></li>
<li><p>Pre-paid (v¬†p≈ô√≠padƒõ dostateƒçn√©ho z≈Østatku)</p></li>
<li><p>Exempted</p></li>
<li><p><mark>Exempted not compliant</mark></p></li>
<li><p>Exempted trip</p></li>
</ul></li>
<li><p>Toll trip record = ze vstupu</p></li>
<li><p>Toll trip = ze vstupu</p></li>
<li><p>Bill issuer = ze vstupu (tj. System operator)</p></li>
<li></li>
</ul>


<p>Syst√©m pro ka≈ædou ocenƒõnou slo≈æku m√Ωta ud√°losti zpoplatnƒõn√≠ vytvo≈ô√≠
Rated toll event:</p>


<ul>
<li><p>Charge type = ze vstupu</p></li>
<li><p>Basic unit price = ze vstupu</p></li>
<li><p>Basic unit price definition method = ze vstupu</p></li>
<li><p>Unit price = ze vstupu</p></li>
<li><p>Unit price VAT = ze vstupu</p></li>
<li><p>Number of units = ze vstupu</p></li>
<li><p>Metric unit = ze vstupu</p></li>
<li><p>Price amount = Price amount ze vstupu ‚Äì Discount amount</p></li>
<li><p>Price amount VAT = Price amount VAT ze vstupu ‚Äì Discount amount
VAT</p></li>
<li><p>Tax rate = ze vstupu</p></li>
<li><p>Discount amount = ze vstupu</p></li>
<li><p>Discount amount VAT = ze vstupu</p></li>
<li><p>Discount rate = ze vstupu</p></li>
<li><p>Billing service = ze vstupu</p></li>
<li><p>Toll transaction = reference na Toll Transaction</p></li>
</ul>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-9">Alternativn√≠ postupy</h4>


<p><mark>P≈Øvodn√≠ z√°znamy pro re-rating nebo cancelling se
nena≈°ly</mark></p>


<p><mark>Pokud pro re-rating nebo cancelling ud√°losti Syst√©m nenajde
p≈Øvodn√≠ z√°znamy, tak se tyto z√°znamy odlo≈æ√≠.</mark></p>


<p>Nulov√© Rated Toll Events na faktur√°ch</p>


<p>Pokud jde o nulov√Ω Rated Toll Event (Price amount VAT = 0 a z√°rove≈à
Discount rate = null) a konfiguraƒçn√≠ kl√≠ƒç =
BE_AggregateZeroTollTransactions = false, RTE se neagreguje do Bill Item
a Bill session.</p>


<p>Postup konƒç√≠</p>


<h4 id="chybov√©-postupy-9">Chybov√© postupy</h4>


<p>Nejsou</p>


<h4 id="pozn√°mky-8">Pozn√°mky</h4>


<p>Nejsou.</p>


<h3 id="vytvo≈ô-billing-details-sys.bar.1.9.hr">Vytvo≈ô billing details
(SYS.BAR.1.9.HR)</h3>


<h4 id="c√≠l-10">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je na z√°kladƒõ vytvo≈ôen√Ωch Toll
Transactions a Rated toll events vytvo≈ôit Billing Details za ka≈æd√©ho
Bill issuer a zaslat je p≈ô√≠slu≈°n√Ωcm Poskytovatel≈Øm m√Ωtn√Ωch slu≈æeb.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-10">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>V¬†pravideln√Ωch intervalech na z√°kladƒõ napl√°novan√© operace
BEm.ExportBillingDetailsHr.</p>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-9">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Nejsou.</p>


<h4 id="popis-4">Popis</h4>


<p>Syst√©m pro ka≈æd√©ho Pokytovatele m√Ωtn√Ωch slu≈æeb najde v≈°echny Toll
Transaction, kter√© je≈°te nebyly zahrnuty do Billing Details a pak je pro
ka≈æd√©ho Poskytovatele m√Ωtn√Ωch slu≈æeb postupnƒõ zpracov√°v√°.</p>


<p>Syst√©m seskup√≠ Toll transactions podle Bill issuer, aby se vytvo≈ôily
Billing Details za ka≈æd√©ho Bill issuer zvl√°≈°≈• (= apduOriginator).</p>


<p>Jako informationSenderId bude uveden System operator s¬†p≈ô√≠znakem
System owner = true (tj. HAC).</p>


<p>Syst√©m pro apci sekci vygeneruje apduIdentifier ze sekvence
outgoingApduIdentifierSequence.</p>


<p>Syst√©m dohled√° odpov√≠daj√≠c√≠ Rated Toll Events k nalezen√Ωm Toll
Transactions.</p>


<p>Syst√©m pro ka≈ædou Toll Transaction vytvo≈ô√≠ jeden BillingDetailsAdu
element, pro kter√Ω vygeneruje aduIdentifier ze sekvence
outgoingAduIdentifierSequence.</p>


<p>Syst√©m spoƒç√≠t√° na z√°kladƒõ nalezen√Ωch ocenƒõn√Ωch ud√°lost√≠:</p>


<ul>
<li><p>billingDetailAmount.PaymentFeeAmount = SUM (Rated toll
events.price amount)</p></li>
<li><p>billingDetailAmount.VatRate = VAT rate z prvn√≠ RTE</p></li>
</ul>


<p>Pokud jde o Toll Transaction typu Rerating nebo Cancelling, Syst√©m do
sekce billingDetailsAdu/relatedBillingDetails uvede referenci na p≈Øvodn√≠
billing details (Toll Transaction.EETS Export Billing details pro Toll
Transaction number z Toll Transaction, kter√° je uvedena jako Toll
Transaction.Original toll transaction).</p>


<p>Syst√©m pro ka≈ædou Toll Transaction ze skupiny vytvo≈ô√≠ usageList,
kter√Ω vypln√≠ n√°sledovnƒõ:</p>


<ul>
<li><p>v sekci usageListEntry:</p></li>
</ul>


<ul>
<li><p>forSectionedRoads uvede:</p>
<ul>
<li><p>Toll Transaction.Invoice agregation number,</p></li>
<li><p>podsekci usedSections, kde ve uvede:</p>
<ul>
<li><p>tollContext = Bill issuer = VCM.System operator,</p></li>
<li><p>chargeObjectDesignation = Toll Transaction.Toll trip (ID podle
Context data zaslan√Ωch TSP),</p></li>
<li><p>appliedLocationClass = 0</p></li>
<li><p>tollEventTime = Toll Transaction.Event time</p></li>
<li><p>podsekci usedSectionFee, kde uvede Price amount a VAT rate z
Rated toll event s Charge type = Infrastructure nebo Toll.</p></li>
<li><p>podsekci usedSectionExternalCosts, kde uvede Price amount a VAT
rate z Rated toll event s:</p></li>
</ul>
<ul>
<li><p>Charge type = Pollution v podsekci externalCostsAir,</p></li>
<li><p>Charge type = Emission CO2 v podsekci externalCostsCo2.</p></li>
</ul></li>
<li><p>podsekci appliedTariffTableVersion = <mark>TBD</mark> <mark>(pro
zaƒç√°tek budeme plnit = 1)</mark></p></li>
<li><p>podsekci appliedLocalVehicleClass, kde uvede:</p>
<ul>
<li><p>appliedLocalVehicleClassId = Toll Transaction.Vehicle
category</p></li>
</ul></li>
<li><p>podsekci vehicleDescription, kde uvede:</p>
<ul>
<li></li>
<li></li>
<li><p>environmentalCharacteristics = Toll Transaction.Emission
class</p></li>
<li><p>futureCharacteristics = Toll Transaction.Emission class
CO2</p></li>
</ul></li>
<li><p>usageFee = usedSectionFee</p></li>
<li><p>usageExternalCosts = koresponduj√≠c√≠
usedSectionExternalCosts</p></li>
</ul></li>
<li><p>v sekci includedDiscounts uvede Discount rate, VAT rate a
Discount amount pro ostatn√≠ Rated toll events s nenulovou Discount
rate.</p></li>
</ul>


<p>Syst√©m vytvo≈ô√≠ zpr√°vu Billing details (DEX.BAR.29.HR).</p>


<p>Syst√©m vyexportuje Billing details za pou≈æit√≠ rozhran√≠
(INT.BAR.26.HR).</p>


<p>Syst√©m na p≈ô√≠slu≈°n√© Toll Transaction na z√°kladƒõ proveden√©ho exportu
updatuje atributy:</p>


<ul>
<li><p>EETS Export Billing details Toll transaction number = z
billingDetailsAdus.aduIdentifier</p></li>
<li><p>Export date</p></li>
<li><p>Export log</p></li>
<li><p>EETS Toll declaration ID = null</p></li>
</ul>


<p>Syst√©m pokraƒçuje se stejn√Ωm nebo dal≈°√≠m Poskytovatelem m√Ωtn√Ωch slu≈æeb
dokud existuj√≠ dal≈°√≠ Toll Transactions na zpracov√°n√≠.</p>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-10">Alternativn√≠ postupy</h4>


<p>Nejsou</p>


<h4 id="chybov√©-postupy-10">Chybov√© postupy</h4>


<p>Nejsou</p>


<h4 id="pozn√°mky-9">Pozn√°mky</h4>


<p>Pozn√°mka 1: Pokud jde o Rerating nebo Cancelling Toll transactions
(p≈ô√≠padnƒõ i p≈ôi soubƒõhu s p≈Øvodn√≠ Toll transaction), tak √∫daje Toll
transactions mus√≠ b√Ωt v Billing details uveden√© v po≈ôad√≠ Rating,
Cancelling a Rerating.</p>


<p>Pozn√°mka 2: Pr√°zd√Ω export Billing details teƒè nebude podporov√°n,
dokud se nezjist√≠ zp≈Øsob, jak takov√© BD vytv√°≈ôet.</p>


<h3 id="zapla≈•-m√Ωtnou-transakci-tokenem-sys.bar.1.10.hr">Zapla≈• m√Ωtnou
transakci tokenem (SYS.BAR.1.10.HR)</h3>


<h4 id="c√≠l-11">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je uhradit ulo≈æenou Unpaid Toll
Transaction.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-11">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>V¬†pravideln√Ωch intervalech na z√°kladƒõ <mark>napl√°novan√©
operace</mark> BEm.ExecuteTokenPaymentPolling.</p>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-10">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Syst√©m vytvo≈ôil Unpaid Toll Transaction ve stavu Ready for
processing, v r√°mci p≈ô√≠padu u≈æit√≠ Ulo≈æ ocenƒõnou m√Ωtnou transakci
(SYS.BAR.1.8.HR).</p>


<h4 id="section-1"></h4>


<h4 id="popis-5">Popis</h4>


<p>Syst√©m dohled√° Unpaid Toll Transactions ve stavu Ready for processing
a se≈ôad√≠ je podle podle poƒçtu ji≈æ proveden√Ωch pokus≈Ø o zaplacen√≠ (Card
Payment Request.Attempt count) od nejmen≈°√≠ho k nejvƒõt≈°√≠mu, a n√°slednƒõ je
se≈ôad√≠ podle UTT.Event time od nejstar≈°√≠ho k nejnovƒõj≈°√≠mu (budou se
zpracov√°vat prvnƒõ ty, kter√© je≈°tƒõ nemaj√≠ pokus o zaplacen√≠, pak ty kter√©
u≈æ pokus maj√≠, atd., v p≈ô√≠padƒõ shodn√©ho poƒçtu pokus≈Ø budou zpracov√°v√°ny
od nejstar≈°√≠ho).</p>


<p>Syst√©m pak zpracov√°v√° jeden Unpaid Toll Transaction po druh√©m.</p>


<p>Syst√©m zjist√≠ zda ji≈æ existuje Payment session pro Card Payment
Request pro zpracov√°van√Ω Unpaid Toll Transaction:</p>


<ul>
<li><ul>
<li><ul>
<li></li>
<li></li>
</ul></li>
<li></li>
<li><ul>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul></li>
<li><ul>
<li></li>
<li></li>
<li></li>
</ul></li>
<li></li>
</ul></li>
<li><p>Pokud aktivn√≠ Payment session ji≈æ existuje (tj. buƒè Payment
session existuje a je ve stavu New nebo In progress):</p>
<ul>
<li><p>a na Payment session nen√≠ vyplnƒõn Card token, Syst√©m jej prvnƒõ
z√≠sk√° ‚Äì postup pokraƒçuje od kroku z√≠sk√°n√≠ Tokenu v¬†postupu p≈ôi vytvo≈ôen√≠
nov√© Payment session,</p></li>
</ul>
<ul>
<li><p>a na Payment session je vyplnƒõn Card token, Syst√©m zjist√≠ stav
transakce na CorvusPay br√°nƒõ, a podle z√≠skan√©ho Response code a
konfigurace (CorvusPay Response Code a Process Step Scheduling) zjist√≠,
zda jde o:</p>
<ul>
<li><p>zam√≠tnutou transakci, pak postup pokraƒçuje Chybov√Ωm postupem =
Zam√≠tnut√≠ transakce,</p></li>
<li><p>transakce je≈°tƒõ nen√≠ zprocesov√°na, pak <mark>Syst√©m:</mark></p>
<ul>
<li><p><mark>na Payment session updatuje Transaction result podle
odpovƒõdi z br√°ny, Request time a Process count o 1</mark></p></li>
<li><p><mark>na Card payment request updatuje Process on podle
konfigurace Process step scheduling a aktu√°ln√≠ hodnoty Payment
session.Process count,</mark></p></li>
</ul></li>
<li><p>transakce je zam√≠tnuta, ale m≈Ø≈æe se zopakovat, pak postup
pokraƒçuje Alternativn√≠m postupem = Zam√≠tnut√° transakce s mo≈æn√Ωm
opakov√°n√≠m.</p></li>
</ul></li>
</ul>
<ul>
<li><ul>
<li><p>transakce je schv√°len√°, postup pokraƒçuje spoleƒçn√Ωm postupem, pro
p≈ô√≠pad √∫spƒõ≈°n√©ho dokonƒçen√≠ platebn√≠ transakce.</p></li>
</ul></li>
</ul></li>
<li><p>Pokud aktivn√≠ Payment session neexistuje (tj. buƒè Payment session
neexistuje nebo existuje a nen√≠ ve stavu New nebo In progress):</p>
<ul>
<li><p>Syst√©m vytvo≈ô√≠ Payment session:</p>
<ul>
<li><p>Online payment identifier =unik√°tn√≠ identifik√°tor platebn√≠
transakce p≈ôi≈ôazen√Ω Syst√©mem (guid generovan√Ω z CO)</p></li>
<li><p>Payment session type = Toll</p></li>
<li><p>Payment session status = New</p></li>
<li><p>Payment amount = ƒç√°stka platby</p></li>
<li><p>Variable symbol = vygenerovan√Ω ze sekvence pro variabiln√≠ symboly
(PNFVS)</p></li>
<li><p>Internet banking channel =</p>
<ul>
<li><p>pokud Card Payment Request.count = 0, pak Corvus System api
(synchro api pro prvn√≠ pokus)</p></li>
<li><p>pokud Card Payment Request.count &gt;0, pak Corvus Tokenize api
(asynchro api pro ka≈æd√Ω dal≈°√≠ pokus)</p></li>
</ul></li>
<li><p>Created on = aktu√°ln√≠ datum a ƒças</p></li>
<li><p>Card payment request = reference na odpov√≠daj√≠c√≠ Card Payment
Request</p></li>
</ul></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li><p>Syst√©m zjist√≠ Payment card, kterou m√° k¬†platbƒõ pou≈æ√≠t (prvn√≠
Payment card, kter√° existuje ve smƒõru od Vehicle k¬†Account).</p></li>
<li><p>Syst√©m updatuje na Payment session:</p>
<ul>
<li><p>Card number = z¬†VCM.Payment card.Masked card number (z prvn√≠
Payment card, kter√° existuje ve smƒõru od Vehicle k¬†Account)</p></li>
<li><p>Card token = z¬†VCM.Payment card.Payment card token (z prvn√≠
Payment card, kter√° existuje ve smƒõru od Vehicle k¬†Account)</p></li>
</ul></li>
<li><p>Syst√©m vyvol√° synchron√≠ (pokud jde o prvn√≠ pokus) nebo
asynchronn√≠ komunikaci s¬†CorvusPay platebn√≠ br√°nou (rozhran√≠
INT.BAR.27.HR), kdy inicializuje platebn√≠ transakci za pomoc√≠ tokenu a
identifikace c√≠lov√©ho p≈ô√≠jemce platby (tj. Unpaid Toll Transaction.Bill
issuer). Syst√©m do platebn√≠ br√°ny po≈°le ƒç√°stku platby, mƒõnu platby,
token, <mark>Bill issuer (jako store_id)?</mark>:</p>
<ul>
<li></li>
<li><p>Pokud jde o asynchronn√≠ komunikaci a Syst√©m obdr≈æel kladnou
odpovƒõƒè o p≈ôijet√≠ a za≈ôazen√≠ transakce do fronty na zpracov√°n√≠ na stranƒõ
CorvusPay, zmƒõn√≠ stav Payment session na In progress a nastav√≠ Process
count = 0 a postup konƒç√≠. Pozn√°mka: Syst√©m se n√°slednƒõ periodicky
dotazuje CorvusPay na stav transakce a n√°slednƒõ poka≈æd√© updatuje na
Payment session atribut Status request time a Process count dokud
nedostane fin√°ln√≠ Response code.</p></li>
<li><p>Jinak Syst√©m na z√°kladƒõ z√≠skan√©ho Response code z platebn√≠ br√°ny
a konfigurace (CorvusPay Response Code a Process Step Scheduling)
zjist√≠, zda jde o:</p>
<ul>
<li><p>zam√≠tnutou transakci, pak postup pokraƒçuje Chybov√Ωm postupem =
Zam√≠tnut√≠ transakce,</p></li>
</ul>
<ul>
<li><p>zam√≠tnutou transakci, ale m≈Ø≈æe se zopakovat, pak postup pokraƒçuje
Alternativn√≠m postupem = Zam√≠tnut√° transakce s mo≈æn√Ωm
opakov√°n√≠m.</p></li>
<li><p>schv√°lenou transakci, postup pokraƒçuje spoleƒçn√Ωm postupem, pro
p≈ô√≠pad √∫spƒõ≈°n√©ho dokonƒçen√≠ platebn√≠ transakce.</p></li>
</ul></li>
</ul></li>
</ul></li>
</ul>


<p>V¬†p≈ô√≠padƒõ √∫spƒõ≈°n√©ho dokonƒçen√≠ platebn√≠ transakce, Syst√©m:</p>


<ul>
<li><p>na¬†Payment session ulo≈æ√≠ do Result code n√°vratov√Ω k√≥d z platebn√≠
br√°ny,</p></li>
<li><p>zmƒõn√≠ Payment session status na Realized.</p></li>
</ul>


<p>Syst√©m vytvo≈ô√≠ Payment s¬†parametry:</p>


<ul>
<li><p>Payment number = Unik√°tn√≠ ƒç√≠slo platby podle ƒç√≠slovac√≠ho
sch√©matu.</p></li>
<li><p>Payment type = Toll payment</p></li>
<li><p>Payment method = Bank card payment</p></li>
<li><p>Payment category = Credit payment</p></li>
<li><p>Payment status = Realized</p></li>
<li><p>Matching status = Recognized ‚Äì matching not needed</p></li>
<li><p>Variable symbol = Variable symbol z Payment session</p></li>
<li><p>Specific symbol = Subject number z Unpaid Toll
Transaction</p></li>
<li><p>Payment amount = ƒç√°stka platby</p></li>
<li><p>Date of payment = aktu√°ln√≠ datum</p></li>
<li><p>Date of collection = aktu√°ln√≠ datum</p></li>
<li><p>Comment = null</p></li>
<li><p>Subject type = z Unpaid Toll Transaction (Account)</p></li>
<li><p>Subject number = z Unpaid Toll Transaction
(Account.number)</p></li>
<li><p>Bill issuer bank account = zji≈°tƒõn√© ƒç√≠slo bankovn√≠ho √∫ƒçtu Bill
issuera (BIBA) pro Reason = toll</p></li>
<li><p>Bill issuer = z Unpaid Toll Transaction</p></li>
</ul>


<p>Syst√©m na z√°kladƒõ Unpaid Toll Transaction vytvo≈ô√≠ odpov√≠daj√≠c√≠ Toll
Transaction ve stavu Processed, kdy se zkop√≠ruj√≠ hodnoty odpov√≠daj√≠c√≠ch
atribut≈Ø z Unpaid Toll Transaction.</p>


<p>Syst√©m p≈ôevƒõs√≠ na Toll Transaction odpov√≠daj√≠c√≠ Rated Toll
Events.</p>


<p>Syst√©m updatuje atributy Toll Transaction:</p>


<ul>
<li><p>Unpaid Toll Transaction creation time = z Unpaid Toll
Transaction.creation time</p></li>
<li><p>Payment = referenci na realizovanou platbu</p></li>
</ul>


<p>Syst√©m zru≈°√≠ Unapid Toll Transaction.</p>


<p>Syst√©m zagreguje Rated toll Event do Bill session, za pou≈æit√≠
syst√©mov√© Zagreguj ocenƒõn√© ud√°losti do fakturaƒçn√≠ d√°vky
(SYS.BAR.0.12.HR).</p>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-11">Alternativn√≠ postupy</h4>


<p>Zam√≠tnut√° transakce s mo≈æn√Ωm opakov√°n√≠m</p>


<p>Pokud Syst√©m p≈ôi zji≈°≈•ov√°n√≠ stavu transakce na CorvusPay br√°nƒõ dostal
Response code, kter√Ω podle konfigurace (CorvusPay Response Code a
Process Step Scheduling) znamen√°, ≈æe transakce je zam√≠tnuta, ale m≈Ø≈æe se
zopakovat, pak Syst√©m:</p>


<ul>
<li><p>na Payment session updatuje</p>
<ul>
<li><p>Status = Rejected by bank,</p></li>
<li><p>Result code podle odpovƒõdi z br√°ny,</p></li>
<li><p>Status request time podle posledn√≠ho dotazu</p></li>
<li><p>Process count nav√Ω≈°√≠ o 1,</p></li>
</ul></li>
<li><p>na Card payment request</p>
<ul>
<li><p>nav√Ω≈°√≠ Attempt count o 1,</p></li>
<li><p>Process on updatuje podle konfigurace Process step scheduling a
aktu√°ln√≠ hodnoty Attempt count,</p></li>
</ul></li>
<li><p>vyhodnot√≠, zda poƒçet platebn√≠ch pokus≈Ø dos√°hl nakonfigurovan√©ho
maxima (tj. Card Payment Request.attempt count &gt;
BE_maximalCountOfPaymentAttempts):</p>
<ul>
<li><p>Pokud maximum bylo dosa≈æeno:</p>
<ul>
<li><p>Syst√©m updatuje Card Payment Request:</p>
<ul>
<li><p>Deleted on = sysdate</p></li>
</ul></li>
<li><p>Syst√©m na Rated Toll event:</p>
<ul>
<li><p>z Rated Toll Event.Price amount VAT odeƒçte Discount amount
VAT,</p></li>
<li><p>z Rated Toll Event.Price amount odeƒçte Discount amount,</p></li>
</ul></li>
<li><p>Syst√©m na Unpaid Toll Transaction:</p>
<ul>
<li><p>zmƒõn√≠ stav na Offence</p></li>
<li><p>ulo≈æ√≠ datum Offence time</p></li>
<li><p>dopoƒç√≠t√° Transaction amount VAT = suma (Rated Toll Event.Price
amount VAT)</p></li>
<li><p>dopoƒç√≠t√° Transaction amount = suma (Rated Toll Event.Price
amount),</p></li>
</ul></li>
<li><p>Syst√©m informuje Alert list: Syst√©m na z√°kladƒõ nezaplacen√© m√Ωtn√©
transakce vytvo≈ô√≠ nebo updatuje z√°znam na Alert listu pro dan√© SPZ,
nav√Ω≈°√≠ Total due amount o celkovou nezaplacenou ƒç√°stku transakce a
Offence count nav√Ω≈°√≠ o 1 p≈ôestupek, za pou≈æit√≠ syst√©mov√© funkce Zaeviduj
Offence na Alert list (SYS.TDP.5.6):</p>
<ul>
<li><p>UTT.Registration number a UTT.Registration country</p></li>
<li><p>Bill.Bill issuer</p></li>
<li><p>+ Unpaid toll transaction.Transaction amount VAT</p></li>
<li><p>+ 1 offence (tj. nav√Ω≈°√≠ poƒçet p≈ôestupk≈Ø +1)</p></li>
</ul></li>
<li><p>Syst√©m zjist√≠ zda existuje vyplnƒõn√Ω kontakt (na VT Vehicle, pokud
tam nen√≠ tak na VT Account, pokud tam neni tak na VT Customer). Pokud je
vyplnƒõn:</p>
<ul>
<li><p>E-mail address, Syst√©m vygeneruje emailovou notifikaci
(NTF.BAR.13.HR) a ode≈°le ji.</p></li>
<li><p>Phone number, Syst√©m vygeneruje SMS notifikaci (NTF.BAR.14.HR) a
ode≈°le ji.</p></li>
</ul></li>
</ul></li>
<li><p>Pokud poƒçet platebn√≠ch pokus≈Ø nedos√°hl nakonfigurovan√©ho
maxima:</p>
<ul>
<li><p>Syst√©m vytvo≈ô√≠ novou Payment session:</p>
<ul>
<li><p>Online payment identifier =unik√°tn√≠ identifik√°tor platebn√≠
transakce p≈ôi≈ôazen√Ω Syst√©mem (guid generovan√Ω z CO)</p></li>
<li><p>Payment session type = Toll</p></li>
<li><p>Payment session status = New</p></li>
<li><p>Payment amount = ƒç√°stka platby</p></li>
<li><p>Variable symbol = vygenerovan√Ω ze sekvence pro variabiln√≠ symboly
(PNFVS)</p></li>
<li><p>Internet banking channel = CorvusPay Tokenize api (asynchro api
pro ka≈æd√Ω dal≈°√≠ pokus)</p></li>
<li><p>Created on = aktu√°ln√≠ datum a ƒças</p></li>
<li><p>Card payment request = reference na odpov√≠daj√≠c√≠ Card Payment
Request</p></li>
</ul></li>
<li><p>Syst√©m updatuje Card Payment Request.process on =
sysdate.</p></li>
</ul></li>
</ul></li>
</ul>


<h4 id="chybov√©-postupy-11">Chybov√© postupy</h4>


<p>Chybƒõj√≠c√≠ platn√° Payment card</p>


<p>Pokud se ≈æ√°dn√° platn√° Payment card na Vehicle nebo Account nena≈°la,
Syst√©m nastav√≠ Payment session status na Rejected a ulo≈æ√≠ do Result code
chybov√Ω k√≥d znaƒç√≠c√≠ chybƒõj√≠c√≠ kartu. Syst√©m na Card Payment Request
updatuje Attempt count o 1.</p>


<ul>
<li><ul>
<li></li>
<li><ul>
<li></li>
<li></li>
<li></li>
<li></li>
</ul></li>
<li><ul>
<li></li>
<li></li>
</ul></li>
</ul></li>
<li><ul>
<li></li>
<li></li>
</ul></li>
</ul>


<p>Postup postup pokraƒçuje Alternativn√≠m postupem a to krokem, kdy
Syst√©m zji≈°≈•uje, zda poƒçet platebn√≠ch pokus≈Ø dos√°hl nakonfigurovan√©ho
maxima.</p>


<p>Ne√∫spƒõ≈°n√© p≈ôijet√≠ transakce platebn√≠ branou p≈ôi asynchronn√≠
komunikaci (transakce nebyla za≈ôazena do fronty)</p>


<p>Pokud jde o asynchronn√≠ komunikaci a Syst√©m obdr≈æel negativn√≠ odpovƒõƒè
o p≈ôijet√≠ a za≈ôazen√≠ transakce do fronty na zpracov√°n√≠ na stranƒõ
CorvusPay, Syst√©m:</p>


<ul>
<li><p>na Payment session updatuje Process count o 1</p></li>
<li></li>
<li><p>na Card Payment Request updatuje Process on podle Process Step
Scheduling a attempt count. (Pozn√°mka: V¬†tomto p≈ô√≠padƒõ se nebude
updatovat Card Payment Request.Attemp count atribut, jeliko≈æ jde o
technick√© zam√≠tnut√≠ transakce) .</p></li>
</ul>


<p>Postup konƒç√≠</p>


<p>Zam√≠tnut√≠ transakce</p>


<p>Pokud transakce nebyla schv√°lena a nen√≠ mo≈æn√© opakov√°n√≠ podle
konfigurace (CorvusPay Response Code a Process Step Scheduling):</p>


<ul>
<li><p>Syst√©m na Payment session updatuje:</p>
<ul>
<li><p>Status = Rejected by bank,</p></li>
<li><p>Result code podle odpovƒõdi z br√°ny,</p></li>
<li><p>Status request time podle posledn√≠ho dotazu</p></li>
<li><p>Process count nav√Ω≈°√≠ o 1,</p></li>
</ul></li>
<li><p>Syst√©m na Card payment request:</p>
<ul>
<li><p>nav√Ω≈°√≠ Attempt count o 1,</p></li>
<li><p>Deleted on = sysdate,</p></li>
</ul></li>
<li></li>
<li><p>Syst√©m na Rated Toll event:</p>
<ul>
<li><p>z Rated Toll Event.Price amount VAT odeƒçte Discount amount
VAT,</p></li>
<li><p>z Rated Toll Event.Price amount odeƒçte Discount amount,</p></li>
</ul></li>
<li><p>Syst√©m na Unpaid Toll Transaction:</p>
<ul>
<li><p>zmƒõn√≠ stav na Offence</p></li>
<li><p>ulo≈æ√≠ datum Offence time</p></li>
<li><p>dopoƒç√≠t√° Transaction amount VAT = suma (Rated Toll Event.Price
amount VAT)</p></li>
<li><p>dopoƒç√≠t√° Transaction amount = suma (Rated Toll Event.Price
amount),</p></li>
</ul></li>
<li><p>Syst√©m informuje Alert list: Syst√©m na z√°kladƒõ nezaplacen√© m√Ωtn√©
transakce vytvo≈ô√≠ nebo updatuje z√°znam na Alert listu pro dan√© SPZ,
nav√Ω≈°√≠ Total due amount o celkovou nezaplacenou ƒç√°stku transakce a
Offence count nav√Ω≈°√≠ o 1 p≈ôestupek, za pou≈æit√≠ syst√©mov√© funkce Zaeviduj
Offence na Alert list (SYS.TDP.5.6):</p>
<ul>
<li><p>UTT.Registration number a UTT.Registration country</p></li>
<li><p>Bill.Bill issuer</p></li>
<li><p>+ Unpaid toll transaction.Transaction amount VAT</p></li>
<li><p>+ 1 offence (tj. nav√Ω≈°√≠ poƒçet p≈ôestupk≈Ø +1)</p></li>
</ul></li>
<li><p>Syst√©m zjist√≠ zda existuje vyplnƒõn√Ω kontakt (na VT Vehicle, pokud
tam nen√≠ tak na VT Account, pokud tam neni tak na VT Customer). Pokud je
vyplnƒõn:</p>
<ul>
<li><p>E-mail address, Syst√©m vygeneruje emailovou notifikaci
(NTF.BAR.13.HR) a ode≈°le ji.</p></li>
<li><p>Phone number, Syst√©m vygeneruje SMS notifikaci (NTF.BAR.14.HR) a
ode≈°le ji.</p></li>
</ul></li>
</ul>


<p>Postup konƒç√≠</p>


<h4 id="pozn√°mky-10">Pozn√°mky</h4>


<p>Nejsou</p>


<h2 id="operace-s-platbami-1">Operace s¬†platbami</h2>


<h3 id="zapla≈•-ud√°lost-online-p≈ôes-platebn√≠-br√°nu-sys.bar.2.15.hr">Zapla≈•
ud√°lost online p≈ôes platebn√≠ br√°nu (SYS.BAR.2.15.HR)</h3>


<h4 id="c√≠l-12">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je uhradit ocenƒõnou ud√°lost online p≈ôes
CorvusPay platebn√≠ br√°nu.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-12">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>P≈ô√≠pad u≈æit√≠ je vlo≈æenou souƒç√°st√≠ n√°sleduj√≠c√≠ch p≈ô√≠pad≈Ø u≈æit√≠:</p>


<ul>
<li><p>Zapla≈• p≈ôedplacen√Ω kredit ‚Äì Pre-paid in single domain
(UC.BAR.0.1.HR)</p>
<ul>
<li><p>online platba z¬†Web portalu nebo Mobile App</p></li>
</ul></li>
<li><p>Uhraƒè p≈ôestupek (UC.BAR.0.20.HR)</p>
<ul>
<li><p>online platba z Offence port√°lu</p></li>
<li><p>online platba z¬†Web portalu nebo Mobile App</p></li>
<li></li>
<li></li>
<li></li>
</ul></li>
</ul>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-11">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Je zn√°m Bill issuer, d≈Øvod platby, ƒç√°stka a Account.</p>


<p><mark>Account nen√≠ terminovan√Ω.</mark></p>


<p>≈Ω√°dost o platbu p≈ôi≈°la z:</p>


<ul>
<li><p>Rozhran√≠ Web Portal API (INT.BAR.33.HR) ‚Äì online platba.</p></li>
</ul>


<h4 id="popis-6">Popis</h4>


<p>Syst√©m na z√°kladƒõ vstupn√≠ch dat vytvo≈ô√≠ Payment Session:</p>


<ul>
<li><p>Online payment identifier =unik√°tn√≠ identifik√°tor platebn√≠
transakce p≈ôi≈ôazen√Ω Syst√©mem (guid generovan√Ω z CO)</p></li>
<li><p>Payment session type = podle d≈Øvodu ze vstupu:</p>
<ul>
<li><p>Top-up, pokud d≈Øvodem transakce je Top-up</p></li>
<li><p>Offence, pokud jde o placen√≠ p≈ôestupk≈Ø (placen√≠ UTT ve stavu
Offence),</p></li>
<li><p>Offence RfP payment, pokud jde o placen√≠ RfP za
p≈ôestupky,</p></li>
<li><p>jinak Services</p></li>
<li><p><mark>TBD</mark></p></li>
</ul></li>
<li><p>Payment session status = New</p></li>
<li><p>Payment amount = ƒç√°stka platby</p></li>
<li><p>Variable symbol = vygenerovan√Ω ze sekvence pro variabiln√≠ symboly
(PNFVS)</p></li>
<li><p>Internet banking channel = Online CorvusPay payment</p></li>
<li><p>Created on = aktu√°ln√≠ datum a ƒças</p></li>
<li><p>Card payment request = null</p></li>
<li><p>Selected payment method = null</p></li>
</ul>


<p>Syst√©m vyvol√° komunikaci s CorvusPay platebn√≠ br√°nou (rozhran√≠
INT.BAR.27.HR). Syst√©m do platebn√≠ br√°ny po≈°le ƒç√°stku platby, mƒõnu
platby, Online payment identifier (jako order_id), Bill issuer (jako
store_id), Variable symbol (jako additional_order_number), required
complete = false, subscription = false.</p>


<p>Platebn√≠ br√°na vr√°t√≠ redirect url.</p>


<p>Syst√©m p≈ôesmƒõruje Akt√©ra na str√°nku platebn√≠ br√°ny (pokud operace
byla inicializov√°na v¬†r√°mci Syst√©mu) nebo po≈°le redirect url extern√≠mu
syst√©mu,kter√Ω p≈ôesmƒõruje sv√©ho u≈æivatele.</p>


<p>Akt√©r na str√°nce platebn√≠ br√°ny zvol√≠ platebn√≠ metodu z¬†nab√≠zen√©ho
seznamu a n√°slednƒõ zad√° pat≈ôiƒçn√© platebn√≠ √∫daje a autorizuje
transakci.</p>


<p>V¬†p≈ô√≠padƒõ √∫spƒõ≈°n√©ho dokonƒçen√≠ platby, Syst√©m na¬†Payment session ulo≈æ√≠
do:</p>


<ul>
<li><p>Selected payment method = z√°kazn√≠kem vybran√° CorvusPay platebn√≠
metodu na br√°nƒõ</p></li>
<li><p>Card type = Typ karty zaslan√Ω z platebn√≠ br√°ny</p></li>
<li><p>Card expiry = Expirace karty zaslan√Ω z platebn√≠ br√°ny</p></li>
<li><p>Card number = ƒå√≠slo (maskovan√©) karty zaslan√Ω z platebn√≠
br√°ny</p></li>
<li><p>Card brand = Brand karty zaslan√Ω z platebn√≠ br√°ny</p></li>
<li><p>Result code n√°vratov√Ω k√≥d z platebn√≠ br√°ny</p></li>
<li><p>zmƒõn√≠ Payment session status na Realized.</p></li>
</ul>


<p>Syst√©m zjist√≠ BIBA pro fakturaci na z√°kladƒõ Bill issuer a Reason:</p>


<ul>
<li><p>Offence, pokud Payment session type = Offence</p></li>
<li><p>Top-up, pokud Payment session type = Top-up</p></li>
<li><p>jinak Services.</p></li>
</ul>


<p>Syst√©m vytvo≈ô√≠ Payment s¬†parametry:</p>


<ul>
<li><p>Payment number = Unik√°tn√≠ ƒç√≠slo platby podle ƒç√≠slovac√≠ho
sch√©matu.</p></li>
<li><p>Payment type =</p>
<ul>
<li><p>Top-up payment, pokud jde o Top-up,</p></li>
<li><p>jinak Bill payment.</p></li>
</ul></li>
<li><p>Payment method = pokud</p>
<ul>
<li><p>Payment Session.selected payment method = Card payment a Card
type m√° Card type.type = Bank card, pak Bank card payment</p></li>
<li><p>Payment Session.selected payment method = Card payment a Card
type m√° Card type.type = Bank card m√° Card type.type = Fleet card , pak
Fleet card payment</p></li>
<li><p><mark>Payment Session.selected payment method = Apple Pay, pak
Bank card payment</mark></p></li>
<li><p><mark>Payment Session.selected payment method = Google Pay, pak
Bank card payment</mark></p></li>
<li><p>Payment Session.selected payment method = Pay by IBAN, pak Bank
transfer payment</p></li>
<li><p><mark>Payment Session.selected payment method = Quick wallet
payment, pak Wallet payment</mark></p></li>
<li><p><mark>Payment Session.selected payment method = paysafecard, pak
Gift card payment</mark></p></li>
</ul></li>
<li><p>Payment category = Credit payment</p></li>
<li><p>Payment status = Realized</p></li>
<li><p>Matching status = Recognized ‚Äì not matched</p></li>
<li><p>Variable symbol = Variable symbol z¬†Payment session, pokud
existuje, jinak Null</p></li>
<li><p>Specific symbol = Subject number</p></li>
<li><p>Payment amount = ƒç√°stka platby</p></li>
<li><p>Matched amount = 0</p></li>
<li><p>Date of payment = aktu√°ln√≠ datum</p></li>
<li><p>Date of collection = aktu√°ln√≠ datum</p></li>
<li><p>Comment = null</p></li>
<li><p>Subject type = ze vstupu nebo podle Unpaid Toll
Transaction</p></li>
<li><p>Subject number = ze vstupu nebo podle Unpaid Toll
Transaction</p></li>
<li><p>FCI = FCI karty, v¬†p≈ô√≠padƒõ platby tankovac√≠ kartou</p></li>
<li><p>Bill issuer bank account = zji≈°tƒõn√Ω BIBA</p></li>
<li><p>Bill issuer = ze vstupu nebo podle Unpaid Toll
Transaction</p></li>
</ul>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-12">Alternativn√≠ postupy</h4>


<p>Nejsou</p>


<h4 id="chybov√©-postupy-12">Chybov√© postupy</h4>


<p>Ne√∫spƒõ≈°n√° transakce</p>


<p>Pokud dojde k¬†chybƒõ p≈ôi komunikaci s¬†platebn√≠ br√°nou (nap≈ô.
transakace nen√≠ dokonƒçena do lh≈Øty stanoven√© konfiguraƒçn√≠m kl√≠ƒçem
<mark><em>BE.PaymentReversalTimeout</em>)</mark> nebo platebn√≠ br√°na
vr√°t√≠ chybov√Ω n√°vratov√Ω k√≥d, Syst√©m:</p>


<ul>
<li><p>ulo≈æ√≠ do Selected payment method vybranou CorvusPay platebn√≠
methodu</p></li>
<li><p>nastav√≠ Payment session status na Rejected</p></li>
<li><p>ulo≈æ√≠ do Result code chybov√Ω k√≥d z¬†platebn√≠ br√°ny</p></li>
<li></li>
</ul>


<p>Postup konƒç√≠</p>


<h4 id="pozn√°mky-11">Pozn√°mky</h4>


<p>Nejsou</p>


<h3 id="zapla≈•-ud√°lost-platbou-z-extern√≠ho-syst√©mu-sys.bar.2.16.hr">Zapla≈•
ud√°lost platbou z extern√≠ho syst√©mu (SYS.BAR.2.16.HR)</h3>


<h4 id="c√≠l-13">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je uhradit ocenƒõnou ud√°lost platbou
realizovanou v¬†extern√≠m syst√©mu.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-13">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>P≈ô√≠pad u≈æit√≠ je vlo≈æenou souƒç√°st√≠ n√°sleduj√≠c√≠ch p≈ô√≠pad≈Ø u≈æit√≠:</p>


<ul>
<li><p>Zapla≈• p≈ôedplacen√Ω kredit ‚Äì Pre-paid in single domain
(UC.BAR.0.1.HR)</p>
<ul>
<li><p>jin√° ne≈æ online platba z¬†Web portalu nebo Mobile App</p></li>
<li><p>platba p≈ôes NexGo EFT na MEV</p></li>
<li><p>platba na extern√≠ POS</p></li>
</ul></li>
<li><p>Uhraƒè p≈ôestupek (UC.BAR.0.20.HR)</p>
<ul>
<li><p><mark>jin√° ne≈æ online platba z¬†Web portalu nebo Mobile
App</mark></p></li>
<li><p>platba p≈ôes NexGo EFT na MEV</p></li>
<li><p><mark>platba na extern√≠ POS</mark></p></li>
</ul></li>
<li></li>
</ul>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-12">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Je zn√°m Bill issuer, d≈Øvod platby, ƒç√°stka a Account.</p>


<p><mark>Account nen√≠ terminovan√Ω.</mark></p>


<p>Informace o platbƒõ p≈ôi≈°la z:</p>


<ul>
<li><p>Rozhran√≠ ERP Navision (INT.BAR.30.HR) ‚Äì platba bankovn√≠m
p≈ôevodem</p></li>
<li><p>Rozhran√≠ Web Portal API (INT.BAR.33.HR) ‚Äì jin√° platba ne≈æ online
(tj. platba SMS nebo Voucherem)</p></li>
<li><p>Rozhran√≠ Web Portal API (INT.BAR.33.HR) ‚Äì platba p≈ôes NextGo
EFT</p></li>
<li><p>Rozhran√≠ POS API (INT.BAR.34.HR) ‚Äì platba na extern√≠ POS p≈ôes
jej√≠ EFT nebo hotovost√≠</p></li>
</ul>


<h4 id="popis-7">Popis</h4>


<p>Syst√©m zjist√≠ BIBA pro fakturaci na z√°kladƒõ Bill issuer a Reason:</p>


<ul>
<li><p>Offence, pokud jde o Offence operaci</p></li>
<li><p>Top-up, pokud jde o Top-up</p></li>
<li><p>jinak Services.</p></li>
</ul>


<p>Syst√©m na z√°kladƒõ vstupn√≠ch dat vytvo≈ô√≠ Payment s¬†parametry:</p>


<ul>
<li><p>Payment number = Unik√°tn√≠ ƒç√≠slo platby podle ƒç√≠slovac√≠ho
sch√©matu.</p></li>
<li><p>Payment type =</p>
<ul>
<li><p>Top-up payment, pokud jde o Top-up,</p></li>
<li><p>jinak Bill payment.</p></li>
</ul></li>
<li><p>Payment method <mark>=</mark> <mark></mark></p>
<ul>
<li><p><mark>ze vstupu</mark></p></li>
<li><p><mark>jinak Bank transfer payment</mark></p></li>
</ul></li>
<li><p>Payment category = Credit payment</p></li>
<li><p>Payment status = Realized</p></li>
<li><p>Matching status = Recognized ‚Äì not matched</p></li>
<li><p>Variable symbol = <mark>Null</mark></p></li>
<li><p>Specific symbol = Subject number</p></li>
<li><p>Payment amount = ƒç√°stka platby</p></li>
<li><p>Matched amount = 0</p></li>
<li><p>Date of payment = ze vstupu</p></li>
<li><p>Date of collection = ze vstupu</p></li>
<li><p>Comment = null</p></li>
<li><p>Subject type = podle Subject number</p></li>
<li><p>Subject number = ze vstupu</p></li>
<li><p>FCI = FCI karty, v¬†p≈ô√≠padƒõ platby tankovac√≠ kartou</p></li>
<li><p>Bill issuer bank account = zji≈°tƒõn√Ω BIBA</p></li>
<li><p>Bill issuer = ze vstupu</p></li>
<li></li>
</ul>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-13">Alternativn√≠ postupy</h4>


<p>Nejsou</p>


<h4 id="chybov√©-postupy-13">Chybov√© postupy</h4>


<p>Nejsou</p>


<h4 id="pozn√°mky-12">Pozn√°mky</h4>


<p>Nejsou</p>


<h3 id="tokenizuj-kartu-p≈ôes-platebn√≠-br√°nu-sys.bar.2.17.hr">Tokenizuj
kartu p≈ôes platebn√≠ br√°nu (SYS.BAR.2.17.HR)</h3>


<h4 id="c√≠l-14">C√≠l</h4>


<p>C√≠lem tohoto p≈ô√≠padu u≈æit√≠ je tokenizovat bankovn√≠ nebo fleet kartu
p≈ôes CorvusPay platebn√≠ br√°nu.</p>


<h4 id="spu≈°tƒõn√≠-p≈ô√≠padu-14">Spu≈°tƒõn√≠ p≈ô√≠padu</h4>


<p>P≈ô√≠pad u≈æit√≠ je vlo≈æenou souƒç√°st√≠ n√°sleduj√≠c√≠ch p≈ô√≠pad≈Ø u≈æit√≠:</p>


<ul>
<li><p><mark>TBD</mark></p></li>
</ul>


<p>≈Ω√°dost o tokenizaci p≈ôi≈°la z:</p>


<ul>
<li><p>Rozhran√≠ Web Portal API (INT.BAR.33.HR) ‚Äì tokenizace.</p>
<ul>
<li></li>
</ul></li>
</ul>


<h4 id="podm√≠nky-spu≈°tƒõn√≠-13">Podm√≠nky spu≈°tƒõn√≠</h4>


<p>Je zn√°m Bill issuer, Account a p≈ô√≠padnƒõ Vozidlo.</p>


<p><mark>Account nen√≠ terminovan√Ω.</mark></p>


<h4 id="popis-8">Popis</h4>


<p>Syst√©m na z√°kladƒõ vstupn√≠ch dat vytvo≈ô√≠ Payment Session:</p>


<ul>
<li><p>Online payment identifier =unik√°tn√≠ identifik√°tor platebn√≠
transakce p≈ôi≈ôazen√Ω Syst√©mem (guid generovan√Ω z CO)</p></li>
<li><p>Payment session type = Subscription payment</p></li>
<li><p>Payment session status = New</p></li>
<li><p>Payment amount = 0,01</p></li>
<li><p>Variable symbol = vygenerovan√Ω ze sekvence pro variabiln√≠ symboly
(PNFVS)</p></li>
<li><p>Internet banking channel = Corvus System api nebo CorvusPay
Tokenize api, podle procesu</p></li>
<li><p>Created on = aktu√°ln√≠ datum a ƒças</p></li>
<li><p>Card payment request = null</p></li>
<li><p>Selected payment method = null</p></li>
<li><p>Required complete = true</p></li>
<li><p>Subscription required = true</p></li>
</ul>


<p>Syst√©m vyvol√° komunikaci s CorvusPay platebn√≠ br√°nou (rozhran√≠
INT.BAR.27.HR). Syst√©m do platebn√≠ br√°ny po≈°le ƒç√°stku platby 0,01 EUR,
Online payment identifier (jako order_id), Bill issuer (jako store_id),
Variable symbol (jako additional_order_number), required complete =
true, subscription required = true.</p>


<p>Platebn√≠ br√°na vr√°t√≠ redirect url.</p>


<p>Syst√©m p≈ôesmƒõruje Akt√©ra na str√°nku platebn√≠ br√°ny (pokud operace
byla inicializov√°na v¬†r√°mci Syst√©mu) nebo po≈°le redirect url extern√≠mu
syst√©mu,kter√Ω p≈ôesmƒõruje sv√©ho u≈æivatele.</p>


<p>Akt√©r na str√°nce platebn√≠ br√°ny zad√° pat≈ôiƒçn√© √∫daje karty a
autorizuje tokenizaci.</p>


<p>V¬†p≈ô√≠padƒõ √∫spƒõ≈°n√©ho dokonƒçen√≠ tokenizace, Syst√©m na¬†Payment session
ulo≈æ√≠ do:</p>


<ul>
<li><p>Selected payment method = card</p></li>
<li><p>Card type = Typ karty zaslan√Ω z platebn√≠ br√°ny</p></li>
<li><p>Card expiry = Expirace karty zaslan√° z platebn√≠ br√°ny</p></li>
<li><p>Card number = ƒå√≠slo (maskovan√©) karty zaslan√© z platebn√≠
br√°ny</p></li>
<li><p>Card brand = Brand karty zaslan√Ω z platebn√≠ br√°ny</p></li>
<li><p>Result code n√°vratov√Ω k√≥d z platebn√≠ br√°ny</p></li>
<li><p>zmƒõn√≠ Payment session status na Realized.</p></li>
</ul>


<p>Syst√©m ulo≈æ√≠ token a dal≈°√≠ relevantn√≠ √∫daje o platebn√≠ kartƒõ na
Vozidlo nebo Account, podle toho, pro kterou entitu byla tokenizace
inicializov√°na.</p>


<p>Syst√©m zjist√≠ BIBA na z√°kladƒõ Bill issuer a Reason Top-up.</p>


<p>Syst√©m vytvo≈ô√≠ credit Payment s¬†parametry:</p>


<ul>
<li><p>Payment number = Unik√°tn√≠ ƒç√≠slo platby podle ƒç√≠slovac√≠ho
sch√©matu.</p></li>
<li><p>Payment type = Tokenization reservation</p></li>
<li><p>Payment method = pokud</p>
<ul>
<li><p>Payment Session.selected payment method = Card payment a Card
type m√° Card type.type = Bank card, pak Bank card payment</p></li>
<li><p>Payment Session.selected payment method = Card payment a Card
type m√° Card type.type = Bank card m√° Card type.type = Fleet card , pak
Fleet card payment</p></li>
</ul></li>
<li><p>Payment category = Credit payment</p></li>
<li><p>Payment status = Realized</p></li>
<li><p>Matching status = Recognized ‚Äìmatched</p></li>
<li><p>Variable symbol = Variable symbol z¬†Payment session, pokud
existuje, jinak Null</p></li>
<li><p>Specific symbol = Subject number</p></li>
<li><p>Payment amount = ƒç√°stka platby</p></li>
<li><p>Matched amount = ƒç√°stka platby</p></li>
<li><p>Date of payment = aktu√°ln√≠ datum</p></li>
<li><p>Date of collection = aktu√°ln√≠ datum</p></li>
<li><p>Comment = null</p></li>
<li><p>Subject type = ze vstupu</p></li>
<li><p>Subject number = ze vstupu</p></li>
<li><p>FCI = FCI karty, v¬†p≈ô√≠padƒõ platby tankovac√≠ kartou</p></li>
<li><p>Bill issuer bank account = zji≈°tƒõn√Ω BIBA</p></li>
<li><p>Bill issuer = ze vstupu</p></li>
</ul>


<p>Syst√©m vytvo≈ô√≠ debit Payment jako kopii kreditn√≠ platby, s¬†vyj√≠mkou
parametr≈Ø:</p>


<ul>
<li><p>Payment number = Unik√°tn√≠ ƒç√≠slo platby podle ƒç√≠slovac√≠ho
sch√©matu.</p></li>
<li><p>Payment type = Tokenization reservation cancel</p></li>
<li><p>Payment category = Debit payment</p></li>
<li><p>Payment status = Registered</p></li>
<li><p>Matching status = Recognized ‚Äìmatched</p></li>
<li><p><mark>Date of collection =</mark> <mark>null</mark></p></li>
</ul>


<p>Syst√©m nap√°ruje kreditn√≠ platbu s debetn√≠ platbou, tj. vytvo≈ô√≠ pro nƒõ
Matching s n√°sleduj√≠c√≠mi parametry:</p>


<ul>
<li><p>Date of matching = Datum a ƒças, kdy bylo p√°rov√°n√≠
provedeno</p></li>
<li><p><mark>Effective date of matching = vy≈°≈°√≠ datum z datum≈Ø obou
p√°rovan√Ωch</mark> stran (tj. payment.date of collection)</p></li>
<li><p>Payment ‚Äì debit matching side = debit payment</p></li>
<li><p>Payment ‚Äì credit matching side = credit payment</p></li>
<li><p>Matched amount = ƒç√°stka platby</p></li>
<li><p>Matching method = Automatic</p></li>
<li><p>Disconnect allowed = False</p></li>
<li><p>BO Oper√°tor = System</p></li>
</ul>


<p>Syst√©m pro debetn√≠ platbu vytvo≈ô√≠ Payment session pro zru≈°en√≠
tokenizaƒçn√≠ transakce jako kopii p≈Øvodn√≠ Payment session, s¬†vyj√≠mkou
parametr≈Ø:</p>


<ul>
<li><p>Payment session type = Subscription payment cancel</p></li>
<li><p>Payment session status = New</p></li>
<li><p>Variable symbol = vygenerovan√Ω ze sekvence pro variabiln√≠ symboly
(PNFVS)</p></li>
<li><p>Created on = aktu√°ln√≠ datum a ƒças</p></li>
<li><p>Required complete = false,</p></li>
<li><p>Subscription required = false</p></li>
<li><p>Selected payment method = null</p></li>
<li><p>Result code = null</p></li>
<li><p>Payment session status = New</p></li>
<li><p>Authorisation code = null.</p></li>
<li></li>
</ul>


<p>Syst√©m vyvol√° komunikaci s CorvusPay platebn√≠ br√°nou (rozhran√≠
INT.BAR.27.HR). Syst√©m do platebn√≠ br√°ny po≈°le p≈Øvodn√≠ ƒç√°stku platby
(tj. 0,01 EUR), Online payment identifier, kter√Ω byl pou≈æit pro
tokenizaci karty (jako order_id), Bill issuer (jako store_id), Variable
symbol (jako additional_order_number), required complete = false,
subscription required = false.</p>


<p>V¬†p≈ô√≠padƒõ √∫spƒõ≈°n√©ho dokonƒçen√≠ zru≈°en√≠ tokenizaƒçn√≠ transakce, Syst√©m
na¬†Payment session ulo≈æ√≠ do:</p>


<ul>
<li><p>Selected payment method = card</p></li>
<li><p>Result code n√°vratov√Ω k√≥d z platebn√≠ br√°ny</p></li>
<li><p>zmƒõn√≠ Payment session status na Realized.</p></li>
</ul>


<p>Syst√©m na debetn√≠ platbƒõ zmƒõn√≠:</p>


<ul>
<li><p>Payment status = Realized</p></li>
<li><p><mark>Collection date =</mark> <mark>sysdate</mark></p></li>
</ul>


<p>Syst√©m na Matchingu plateb updatuje Effective date of matching.</p>


<p>Postup konƒç√≠.</p>


<h4 id="alternativn√≠-postupy-14">Alternativn√≠ postupy</h4>


<p>Nejsou</p>


<h4 id="chybov√©-postupy-14">Chybov√© postupy</h4>


<p>Ne√∫spƒõ≈°n√° transakce</p>


<p>Pokud platebn√≠ br√°na vr√°t√≠ chybov√Ω n√°vratov√Ω k√≥d
(TransactionRejected), Syst√©m:</p>


<ul>
<li><p>nastav√≠ Payment session status na Rejected by bank</p></li>
<li><p>ulo≈æ√≠ do Result code chybov√Ω k√≥d z¬†platebn√≠ br√°ny</p></li>
</ul>


<p>Postup konƒç√≠</p>


<h4 id="pozn√°mky-13">Pozn√°mky</h4>


<p>Nejsou</p>


<h3 id="section-2"></h3>


<h4 id="section-3"></h4>


<ul>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>


<h4 id="section-4"></h4>


<h4 id="section-5"></h4>


<ul>
<li><ul>
<li><ul>
<li></li>
<li></li>
</ul></li>
<li></li>
<li></li>
</ul></li>
<li></li>
<li></li>
</ul>


<h4 id="section-6"></h4>


<p> </p>


<h4 id="section-7"></h4>


<ul>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li><p> </p>
<ul>
<li></li>
<li><ul>
<li></li>
<li></li>
</ul></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li><p> </p></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>


        </main>

        <!-- Right Sidebar - Modern Minimap -->
        <aside class="minimap" id="minimap">
            <div class="minimap-header">
                <h4>Overview</h4>
            </div>
            <div class="minimap-content">
                <div class="minimap-viewport" id="minimapViewport"></div>
                <div class="change-indicator" id="changeIndicator" style="display: none;">
                    <!-- Change marks will be populated by JavaScript -->
                </div>
            </div>
        </aside>
    </div>
    
    <script>
        // Document metadata
        const documentMetadata = {
            baseName: "HR_FS_Billing_Accounts_Receivables_CZ",
            displayName: "Hr Fs Billing Accounts Receivables Cz",
            version: "v00_02",
            sectionNumber: 8,
            sectionTitle: "Syst√©mov√© funkce"
        };
        
        let originalContent = document.getElementById('mainContent').outerHTML;
        let comparisonContent = null;
        
        // Test diff library on load
        function initializeDiff() {
            if (typeof Diff === 'undefined') {
                console.error('Diff library failed to load from CDN');
                const warningDiv = document.createElement('div');
                warningDiv.style.cssText = 'background: #fff3cd; color: #856404; padding: 10px; margin: 10px 0; border: 1px solid #ffeaa7; border-radius: 4px;';
                warningDiv.innerHTML = '‚ö†Ô∏è Diff comparison library failed to load. The "Show changes" feature may not work properly.';
                document.querySelector('.version-bar').appendChild(warningDiv);
                return false;
            }
            console.log('Diff library loaded successfully');
            return true;
        }
        
        // Initialize on page load
        window.addEventListener('load', function() {
            initializeTheme();
            initializeDiff();
            initializeVersionControls();
            initializeNavigation();
            initializeScrollBehavior();
        });
        
        function initializeVersionControls() {
            console.log('Initializing version controls');
            const versionSelect = document.getElementById('versionSelect');
            const showChangesCheckbox = document.getElementById('showChanges');
            
            // Detect if running standalone (file:// protocol)
            const isStandalone = window.location.protocol === 'file:';
            const availableVersions = versionSelect.options.length;
            
            console.log('Protocol:', window.location.protocol);
            console.log('Is standalone:', isStandalone);
            console.log('Available versions:', availableVersions);
            
            if (isStandalone) {
                // Running standalone - disable comparison features
                console.log('Standalone mode detected, disabling comparison features');
                versionSelect.disabled = true;
                showChangesCheckbox.disabled = true;
                showChangesCheckbox.checked = false;
                
                // Add standalone notice
                const notice = document.createElement('div');
                notice.style.cssText = 'background: #e3f2fd; color: #1565c0; padding: 8px 12px; margin: 0 1rem; border-radius: 4px; font-size: 0.8rem;';
                notice.innerHTML = 'üìÑ Standalone mode - Version comparison disabled';
                document.querySelector('.top-bar .controls').appendChild(notice);
                
                // Hide version controls
                versionSelect.parentElement.style.display = 'none';
                showChangesCheckbox.parentElement.style.display = 'none';
            } else if (availableVersions === 0) {
                // Server mode but no versions to compare with - disable controls
                console.log('No comparison versions available, disabling controls');
                versionSelect.disabled = true;
                showChangesCheckbox.disabled = true;
                showChangesCheckbox.checked = false;
            } else {
                // At least one version available for comparison - enable controls
                console.log('Comparison versions available, enabling controls');
                versionSelect.disabled = false;
                showChangesCheckbox.disabled = false;
                showChangesCheckbox.checked = false; // Start unchecked
                
                // Pre-load the selected version for comparison
                loadVersionForComparison();
            }
        }
        
        function toggleDiff() {
            console.log('toggleDiff() called');
            const showChanges = document.getElementById('showChanges').checked;
            console.log('showChanges checkbox value:', showChanges);
            const contentDiv = document.getElementById('mainContent');
            console.log('comparisonContent exists:', !!comparisonContent);
            
            if (showChanges && comparisonContent) {
                console.log('Showing diff view');
                showDiffView(originalContent, comparisonContent);
                // Create change indicators after showing diff
                setTimeout(createChangeIndicators, 100);
            } else {
                console.log('Showing original content');
                contentDiv.innerHTML = originalContent;
                // Hide change indicators
                document.getElementById('changeIndicator').style.display = 'none';
            }
        }
        
        function loadVersionForComparison() {
            console.log('loadVersionForComparison() called');
            const selectedVersion = document.getElementById('versionSelect').value;
            console.log('Selected version:', selectedVersion);
            console.log('Current version:', documentMetadata.version);
            if (selectedVersion === documentMetadata.version) {
                console.log('Same version selected, clearing comparison');
                comparisonContent = null;
                toggleDiff();
                return;
            }
            
            // Generate the correct filename using the same sanitization logic as the backend
            function sanitizeFilename(text) {
                return text
                    .replace(/<[^>]+>/g, '') // Remove HTML tags
                    .replace(/[^\p{L}\p{N}\s\-_]/gu, '') // Remove non-letters/numbers but preserve Unicode letters
                    .replace(/[\s_]+/g, '_') // Replace spaces/underscores with single underscore
                    .toLowerCase()
                    .substring(0, 50) // Limit length
                    .replace(/^_+|_+$/g, ''); // Remove leading/trailing underscores
            }
            
            const sanitizedTitle = sanitizeFilename(documentMetadata.sectionTitle);
            const comparisonPath = `../${selectedVersion}/${documentMetadata.baseName}_${String(documentMetadata.sectionNumber).padStart(2, '0')}_${sanitizedTitle}.html`;
            
            console.log('Attempting to load:', comparisonPath);
            
            fetch(comparisonPath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const content = doc.getElementById('mainContent');
                    if (content) {
                        comparisonContent = content.outerHTML;
                        console.log('Comparison content loaded successfully');
                        toggleDiff();
                    } else {
                        console.error('No mainContent found in comparison file');
                        comparisonContent = null;
                    }
                })
                .catch(error => {
                    console.error('Error loading comparison version:', error);
                    console.error('Attempted path was:', comparisonPath);
                    comparisonContent = null;
                    
                    // Show user-friendly error
                    const errorMsg = `Could not load comparison version: ${error.message}\n\nPath: ${comparisonPath}\n\nNote: Make sure you're opening the HTML file directly in your browser, not through a web server.`;
                    alert(errorMsg);
                });
        }
        
        function showDiffView(original, comparison) {
            if (!comparison) return;
            
            const contentDiv = document.getElementById('mainContent');
            
            if (typeof Diff !== 'undefined') {
                console.log('Creating comprehensive diff view');
                try {
                    // First, show the original content
                    contentDiv.innerHTML = original;
                    
                    // Create temporary elements to parse the HTML
                    const tempOriginal = document.createElement('div');
                    const tempComparison = document.createElement('div');
                    tempOriginal.innerHTML = original;
                    tempComparison.innerHTML = comparison;
                    
                    // Apply table-specific highlighting
                    const originalRows = Array.from(tempOriginal.querySelectorAll('tbody tr'));
                    const comparisonRows = Array.from(tempComparison.querySelectorAll('tbody tr'));
                    
                    if (originalRows.length > 0 || comparisonRows.length > 0) {
                        console.log(`Comparing ${originalRows.length} vs ${comparisonRows.length} table rows`);
                        
                        if (originalRows.length !== comparisonRows.length) {
                            highlightTableDifferences(original, comparison, contentDiv);
                        } else {
                            highlightCellDifferences(originalRows, comparisonRows, contentDiv, original);
                        }
                    }
                    
                    // Apply line-by-line text highlighting
                    highlightTextDifferences(tempOriginal, tempComparison, contentDiv);
                    
                } catch (error) {
                    console.error('Error creating diff:', error);
                    contentDiv.innerHTML = original;
                }
            } else {
                console.warn('Diff library not loaded, using original content');
                contentDiv.innerHTML = original;
            }
        }
        
        function highlightTextDifferences(originalElement, comparisonElement, contentDiv) {
            console.log('Applying line-by-line text highlighting');
            
            // Only compare actual document content, not template elements  
            // Now that we preserve outerHTML, we can use the specific selector
            const contentSelector = '#mainContent p, #mainContent li, #mainContent h1, #mainContent h2, #mainContent h3, #mainContent h4, #mainContent h5, #mainContent h6, #mainContent blockquote';
            
            // Get text-containing elements from document content only
            const originalTextElements = originalElement.querySelectorAll(contentSelector);
            const comparisonTextElements = comparisonElement.querySelectorAll(contentSelector);
            
            console.log(`Comparing ${originalTextElements.length} original elements vs ${comparisonTextElements.length} comparison elements`);
            
            // Create maps for comparison
            const originalTexts = Array.from(originalTextElements).map(el => el.textContent.trim()).filter(text => text.length > 0);
            const comparisonTexts = Array.from(comparisonTextElements).map(el => el.textContent.trim()).filter(text => text.length > 0);
            
            console.log(`Filtered to ${originalTexts.length} original texts vs ${comparisonTexts.length} comparison texts`);
            
            // Find corresponding elements in the rendered content
            const renderedElements = contentDiv.querySelectorAll(contentSelector);
            
            let changeCount = { added: 0, modified: 0, removed: 0 };
            
            // Create a more sophisticated comparison
            const originalSet = new Set(originalTexts);
            const comparisonSet = new Set(comparisonTexts);
            
            // Find differences
            const addedTexts = originalTexts.filter(text => !comparisonSet.has(text));
            const removedTexts = comparisonTexts.filter(text => !originalSet.has(text));
            const commonTexts = originalTexts.filter(text => comparisonSet.has(text));
            
            // Apply highlighting to rendered elements
            Array.from(renderedElements).forEach(element => {
                const elementText = element.textContent.trim();
                
                if (addedTexts.includes(elementText)) {
                    // This content was added in the new version
                    element.classList.add('diff-line-added');
                    element.title = 'Added in this version';
                    changeCount.added++;
                } else if (removedTexts.includes(elementText)) {
                    // This shouldn't happen in original content, but for completeness
                    element.classList.add('diff-line-removed'); 
                    element.title = 'Removed in this version';
                    changeCount.removed++;
                } else if (commonTexts.includes(elementText)) {
                    // Check if position changed (simple heuristic for modification)
                    const originalIndex = originalTexts.indexOf(elementText);
                    const comparisonIndex = comparisonTexts.indexOf(elementText);
                    
                    if (Math.abs(originalIndex - comparisonIndex) > 2) {
                        // Content moved significantly - mark as modified
                        element.classList.add('diff-line-modified');
                        element.title = 'Position changed in this version';
                        changeCount.modified++;
                    }
                }
            });
            
            // Count removed items (for completeness in logging)
            changeCount.removed = removedTexts.length;
            
            console.log(`Text differences: ${changeCount.added} added, ${changeCount.modified} modified, ${changeCount.removed} removed`);
        }
        
        function highlightTableDifferences(original, comparison, contentDiv) {
            console.log('Highlighting table row differences');
            contentDiv.innerHTML = original;
            
            // Parse both versions to find the differences
            const tempOriginal = document.createElement('div');
            const tempComparison = document.createElement('div');
            tempOriginal.innerHTML = original;
            tempComparison.innerHTML = comparison;
            
            const originalRows = Array.from(tempOriginal.querySelectorAll('tbody tr'));
            const comparisonRows = Array.from(tempComparison.querySelectorAll('tbody tr'));
            
            console.log(`v${documentMetadata.version} has ${originalRows.length} rows vs comparison with ${comparisonRows.length} rows - ${originalRows.length - comparisonRows.length} new rows`);
            
            // Highlight the new rows (if there are more in original than comparison)
            if (originalRows.length > comparisonRows.length) {
                const tableRows = contentDiv.querySelectorAll('tbody tr');
                const newRowsCount = originalRows.length - comparisonRows.length;
                console.log(`Highlighting ${newRowsCount} new rows (${comparisonRows.length} to ${originalRows.length - 1})`);
                
                for (let i = comparisonRows.length; i < originalRows.length; i++) {
                    if (tableRows[i]) {
                        tableRows[i].style.setProperty('background-color', '#d4edda', 'important');
                        tableRows[i].style.border = '3px solid #28a745';
                        tableRows[i].title = 'New row added in this version';
                        
                        // Apply background to all cells in the row
                        const cells = tableRows[i].querySelectorAll('td');
                        cells.forEach(cell => {
                            cell.style.setProperty('background-color', '#d4edda', 'important');
                        });
                    }
                }
            }
        }
        
        function highlightCellDifferences(originalRows, comparisonRows, contentDiv, originalHtml) {
            console.log('Highlighting cell-level differences');
            contentDiv.innerHTML = originalHtml;
            
            // Find and highlight specific cell differences
            let differencesFound = false;
            const tableRows = contentDiv.querySelectorAll('tbody tr');
            
            originalRows.forEach((originalRow, rowIndex) => {
                if (rowIndex < comparisonRows.length) {
                    const comparisonRow = comparisonRows[rowIndex];
                    const originalCells = Array.from(originalRow.querySelectorAll('td'));
                    const comparisonCells = Array.from(comparisonRow.querySelectorAll('td'));
                    
                    originalCells.forEach((originalCell, cellIndex) => {
                        if (cellIndex < comparisonCells.length) {
                            const originalText = originalCell.textContent.trim();
                            const comparisonText = comparisonCells[cellIndex].textContent.trim();
                            
                            if (originalText !== comparisonText) {
                                console.log(`Row ${rowIndex}, Cell ${cellIndex} differs`);
                                const actualCell = tableRows[rowIndex]?.querySelectorAll('td')[cellIndex];
                                if (actualCell) {
                                    actualCell.style.backgroundColor = '#fff3cd';
                                    actualCell.style.border = '2px solid #ffc107';
                                    actualCell.title = `Changed from: "${comparisonText}"`;
                                    differencesFound = true;
                                }
                            }
                        }
                    });
                }
            });
            
            if (!differencesFound) {
                const indicator = document.createElement('div');
                indicator.style.cssText = 'background: #d1ecf1; color: #0c5460; padding: 10px; margin: 10px 0; border: 1px solid #bee5eb; border-radius: 4px;';
                indicator.innerHTML = '‚ÑπÔ∏è No significant content differences found between versions';
                contentDiv.insertBefore(indicator, contentDiv.firstChild);
            }
        }
        
        function changeWidth() {
            const widthSelect = document.getElementById('widthSelect');
            const contentDiv = document.getElementById('mainContent');
            const selectedWidth = widthSelect.value;
            
            // Remove all width classes
            contentDiv.classList.remove('narrow', 'wide', 'full-width', 'standard');
            
            // Add the selected width class
            contentDiv.classList.add(selectedWidth);
            
            console.log('Width changed to:', selectedWidth);
        }
        
        // Theme Toggle Functions
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const themeButton = document.getElementById('themeToggle');
            themeButton.innerHTML = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            
            console.log('Theme changed to:', newTheme);
        }
        
        function initializeTheme() {
            // Check for saved theme preference or default to system preference
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            let theme;
            if (savedTheme) {
                theme = savedTheme;
            } else {
                theme = systemPrefersDark ? 'dark' : 'light';
            }
            
            document.documentElement.setAttribute('data-theme', theme);
            const themeButton = document.getElementById('themeToggle');
            themeButton.innerHTML = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            
            console.log('Theme initialized:', theme);
        }
        
        // Navigation Functions
        function goBack() {
            window.history.back();
        }
        
        function goToIndex() {
            window.location.href = 'index.html';
        }
        
        // Modern Navigation System with Search
        function initializeNavigation() {
            const nav = document.getElementById('sectionNav');
            const searchInput = document.getElementById('navSearch');
            const noResults = document.getElementById('navNoResults');
            const headers = document.querySelectorAll('#mainContent h1, #mainContent h2, #mainContent h3');
            
            let navigationData = [];
            let currentH1 = null;
            let currentH2 = null;
            
            // Build navigation data structure
            headers.forEach((header, index) => {
                // Create anchor ID if it doesn't exist
                if (!header.id) {
                    header.id = `section-${index}`;
                }
                
                const level = parseInt(header.tagName.charAt(1));
                const navItem = {
                    id: header.id,
                    text: header.textContent.trim(),
                    level: level,
                    element: header,
                    searchText: header.textContent.toLowerCase().trim()
                };
                
                navigationData.push(navItem);
            });
            
            // Render navigation tree
            function renderNavigation(items = navigationData) {
                nav.innerHTML = '';
                noResults.style.display = items.length === 0 ? 'block' : 'none';
                
                let currentH1Container = null;
                let currentH2Container = null;
                
                items.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.className = 'nav-item';
                    
                    // Create item header container
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'nav-item-header';
                    
                    if (item.level === 1) {
                        const hasChildren = items.some((child, childIndex) => 
                            childIndex > index && child.level === 2);
                        
                        if (hasChildren) {
                            const toggle = document.createElement('div');
                            toggle.className = 'nav-toggle';
                            toggle.innerHTML = '‚ñ∂';
                            toggle.onclick = (e) => {
                                e.stopPropagation();
                                toggleNavSection(toggle, li);
                            };
                            headerDiv.appendChild(toggle);
                        } else {
                            const spacer = document.createElement('div');
                            spacer.style.width = '24px';
                            headerDiv.appendChild(spacer);
                        }
                        
                        const a = document.createElement('a');
                        a.href = `#${item.id}`;
                        a.textContent = item.text;
                        a.className = `nav-link h1`;
                        a.onclick = (e) => navigateToSection(e, item.element, a);
                        headerDiv.appendChild(a);
                        
                        li.appendChild(headerDiv);
                        
                        if (hasChildren) {
                            const childrenContainer = document.createElement('div');
                            childrenContainer.className = 'nav-children';
                            li.appendChild(childrenContainer);
                            currentH2Container = childrenContainer;
                        }
                        
                        nav.appendChild(li);
                        currentH1Container = li;
                        
                    } else if (item.level === 2 && currentH2Container) {
                        const h2Li = document.createElement('li');
                        h2Li.className = 'nav-item';
                        
                        const h2Header = document.createElement('div');
                        h2Header.className = 'nav-item-header';
                        
                        const spacer = document.createElement('div');
                        spacer.style.width = '24px';
                        h2Header.appendChild(spacer);
                        
                        const a = document.createElement('a');
                        a.href = `#${item.id}`;
                        a.textContent = item.text;
                        a.className = `nav-link h2`;
                        a.onclick = (e) => navigateToSection(e, item.element, a);
                        h2Header.appendChild(a);
                        
                        h2Li.appendChild(h2Header);
                        currentH2Container.appendChild(h2Li);
                        
                    } else if (item.level === 3 && currentH2Container) {
                        const h3Li = document.createElement('li');
                        h3Li.className = 'nav-item';
                        
                        const h3Header = document.createElement('div');
                        h3Header.className = 'nav-item-header';
                        
                        const spacer = document.createElement('div');
                        spacer.style.width = '24px';
                        h3Header.appendChild(spacer);
                        
                        const a = document.createElement('a');
                        a.href = `#${item.id}`;
                        a.textContent = item.text;
                        a.className = `nav-link h3`;
                        a.onclick = (e) => navigateToSection(e, item.element, a);
                        h3Header.appendChild(a);
                        
                        h3Li.appendChild(h3Header);
                        currentH2Container.appendChild(h3Li);
                    }
                });
                
                // Auto-expand first level
                const firstExpandable = nav.querySelector('.nav-toggle');
                if (firstExpandable) {
                    const firstContainer = firstExpandable.parentElement.parentElement;
                    toggleNavSection(firstExpandable, firstContainer);
                }
            }
            
            // Search functionality
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                
                if (query === '') {
                    renderNavigation(navigationData);
                } else {
                    const filtered = navigationData.filter(item => 
                        item.searchText.includes(query));
                    renderNavigation(filtered);
                }
            });
            
            // Initial render
            renderNavigation();
            
            // Update active nav item on scroll
            window.addEventListener('scroll', updateActiveNavOnScroll);
            
            // Initialize minimap
            initializeMinimap();
        }
        
        function checkForChildren(headers, currentIndex, targetLevel = null) {
            const currentLevel = parseInt(headers[currentIndex].tagName.charAt(1));
            const checkLevel = targetLevel || (currentLevel + 1);
            
            for (let i = currentIndex + 1; i < headers.length; i++) {
                const nextLevel = parseInt(headers[i].tagName.charAt(1));
                if (nextLevel <= currentLevel) break;
                if (nextLevel === checkLevel) return true;
            }
            return false;
        }
        
        function toggleNavSection(toggle, container) {
            const childrenContainer = container.querySelector('.nav-children');
            if (!childrenContainer) return;
            
            const isExpanded = childrenContainer.classList.contains('expanded');
            
            if (isExpanded) {
                childrenContainer.classList.remove('expanded');
                toggle.classList.remove('expanded');
                toggle.innerHTML = '‚ñ∂';
            } else {
                childrenContainer.classList.add('expanded');
                toggle.classList.add('expanded');
                toggle.innerHTML = '‚ñº';
            }
        }
        
        // Modern Minimap Implementation
        function initializeMinimap() {
            const minimap = document.getElementById('minimap');
            const minimapViewport = document.getElementById('minimapViewport');
            const mainContent = document.getElementById('mainContent');
            
            if (!minimap || !minimapViewport || !mainContent) return;
            
            function updateMinimapViewport() {
                const docHeight = document.documentElement.scrollHeight;
                const viewHeight = window.innerHeight;
                const scrollTop = window.pageYOffset;
                const minimapHeight = minimap.clientHeight - 100; // Account for header
                
                // Calculate viewport position and size
                const viewportTop = (scrollTop / docHeight) * minimapHeight;
                const viewportHeight = Math.max(20, (viewHeight / docHeight) * minimapHeight);
                
                minimapViewport.style.top = `${viewportTop}px`;
                minimapViewport.style.height = `${viewportHeight}px`;
            }
            
            // Update on scroll and resize
            window.addEventListener('scroll', updateMinimapViewport);
            window.addEventListener('resize', updateMinimapViewport);
            
            // Click to navigate
            const minimapContent = minimap.querySelector('.minimap-content');
            minimapContent.addEventListener('click', (e) => {
                const rect = minimapContent.getBoundingClientRect();
                const clickY = e.clientY - rect.top;
                const minimapHeight = minimapContent.clientHeight;
                const scrollPercent = clickY / minimapHeight;
                const targetScroll = scrollPercent * (document.documentElement.scrollHeight - window.innerHeight);
                
                window.scrollTo({ top: Math.max(0, targetScroll), behavior: 'smooth' });
            });
            
            // Initial update
            updateMinimapViewport();
        }
        
        function navigateToSection(e, header, link) {
            e.preventDefault();
            header.scrollIntoView({ behavior: 'smooth' });
            updateActiveNavItem(link);
        }
        
        function updateActiveNavItem(activeLink) {
            document.querySelectorAll('#sectionNav a').forEach(link => {
                link.classList.remove('active');
            });
            activeLink.classList.add('active');
        }
        
        function updateActiveNavOnScroll() {
            const headers = document.querySelectorAll('#mainContent h1, #mainContent h2, #mainContent h3');
            const navLinks = document.querySelectorAll('#sectionNav a');
            
            let current = '';
            headers.forEach(header => {
                const rect = header.getBoundingClientRect();
                if (rect.top <= 100) {
                    current = header.id;
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        }
        
        // Floating Top Bar Scroll Behavior
        let lastScrollTop = 0;
        let scrollTimeout;
        
        function initializeScrollBehavior() {
            const topBar = document.getElementById('topBar');
            
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                // Clear any existing timeout
                clearTimeout(scrollTimeout);
                
                // Hide/show logic
                if (scrollTop > lastScrollTop && scrollTop > 60) {
                    // Scrolling down & past header height
                    topBar.classList.add('hidden');
                } else {
                    // Scrolling up or at top
                    topBar.classList.remove('hidden');
                }
                
                lastScrollTop = scrollTop;
                
                // Update change indicators if visible
                updateChangeIndicators();
            }, { passive: true });
        }
        
        // Change Indicator Functions
        function updateChangeIndicators() {
            const indicator = document.getElementById('changeIndicator');
            if (!indicator.style.display || indicator.style.display === 'none') return;
            
            // Get document dimensions
            const docHeight = document.documentElement.scrollHeight;
            const viewHeight = window.innerHeight;
            const scrollTop = window.pageYOffset;
            
            // Update existing change marks
            const marks = indicator.querySelectorAll('.change-mark');
            marks.forEach(mark => {
                const targetId = mark.dataset.target;
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    const elementTop = targetElement.offsetTop;
                    const percentage = (elementTop / docHeight) * 100;
                    mark.style.top = `${percentage}%`;
                }
            });
        }
        
        function createChangeIndicators() {
            const indicator = document.getElementById('changeIndicator');
            const minimapContent = document.querySelector('.minimap-content');
            
            if (!indicator || !minimapContent) return;
            
            indicator.innerHTML = ''; // Clear existing marks
            
            // Find all changed elements
            const addedElements = document.querySelectorAll('.diff-line-added, tr[style*="background-color: #d4edda"]');
            const modifiedElements = document.querySelectorAll('.diff-line-modified, td[style*="background-color: #fff3cd"]');
            const removedElements = document.querySelectorAll('.diff-line-removed');
            
            const docHeight = document.documentElement.scrollHeight;
            const minimapHeight = minimapContent.clientHeight;
            
            // Helper function to create change marks
            function createChangeMark(element, type, index) {
                const mark = document.createElement('div');
                mark.className = `change-mark ${type}`;
                mark.dataset.target = element.id || `${type}-${index}`;
                
                if (!element.id) {
                    element.id = `${type}-${index}`;
                }
                
                const elementTop = element.offsetTop;
                const percentage = (elementTop / docHeight) * minimapHeight;
                mark.style.top = `${Math.max(0, Math.min(minimapHeight - 3, percentage))}px`;
                
                // Set titles
                const titles = {
                    added: 'Added content',
                    modified: 'Modified content', 
                    removed: 'Removed content'
                };
                mark.title = titles[type] || element.title || `${type} content`;
                
                // Click to scroll to element
                mark.addEventListener('click', (e) => {
                    e.stopPropagation();
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
                
                return mark;
            }
            
            // Create marks for added elements
            addedElements.forEach((element, index) => {
                const mark = createChangeMark(element, 'added', index);
                indicator.appendChild(mark);
            });
            
            // Create marks for modified elements
            modifiedElements.forEach((element, index) => {
                const mark = createChangeMark(element, 'modified', index);
                indicator.appendChild(mark);
            });
            
            // Create marks for removed elements
            removedElements.forEach((element, index) => {
                const mark = createChangeMark(element, 'removed', index);
                indicator.appendChild(mark);
            });
            
            const totalChanges = addedElements.length + modifiedElements.length + removedElements.length;
            
            // Show indicator if there are changes
            if (totalChanges > 0) {
                indicator.style.display = 'block';
                console.log(`Created ${totalChanges} change indicators (${addedElements.length} added, ${modifiedElements.length} modified, ${removedElements.length} removed)`);
            } else {
                indicator.style.display = 'none';
            }
        }
    </script>
</body>
</html>